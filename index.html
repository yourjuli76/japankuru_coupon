<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japankuru ã‚¯ãƒ¼ãƒãƒ³ãƒšãƒ¼ã‚¸ (æœ€çµ‚çµ±åˆç‰ˆ)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <style>
    /* --- ê¸°ë³¸ & í…Œë§ˆ ì„¤ì • --- */
    :root {
  --primary-color: #007bff;
  --danger-color: #d90429;
  --save-color: #ffc107;
  --dark-blue: #1a2c4e;
  --card-bg: #fff;
  --light-gray: #f0f2f5;
  --border-color: #d1d9e6;
  --tag-bg: #e7f1ff;
  --tag-color: #004aad;
  --tag-border: #b3d4ff;
  --subtle-text: #666;
  --flip-btn-bg: #e9ecef;
  --flip-btn-color: #555;
}
body.dark-mode {
  --light-gray: #121212;
  --card-bg: #1e1e1e;
  --dark-blue: #2c3e50;
  --border-color: #444;
  --tag-bg: #2a3a5e;
  --tag-color: #a7c5ff;
  --tag-border: #3f517a;
  --subtle-text: #aaa;
  --flip-btn-bg: #343a40;
  --flip-btn-color: #f1f3f5;
}

/* --------------------------------------------------
   RESET & BASE TYPOGRAPHY
-------------------------------------------------- */
body {
  background: #f5f6fa;
  color: #222;
  font-family: 'SF Pro Display', 'Noto Sans JP', 'Helvetica Neue', Arial, sans-serif;
  letter-spacing: 0.02em;
  font-size: 17px;
}
a { color: inherit; text-decoration: none; }
a:hover { text-decoration: underline; }

/* --------------------------------------------------
   HEADER / HERO SECTION
-------------------------------------------------- */
.site-header-hero {
  position: relative;
  background-image: linear-gradient(rgba(26,44,78,0.68), rgba(26,44,78,0.75)), url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?auto=format&fit=crop&w=2070&q=80');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  color: #fff;
  text-align: center;
  padding: 28px 10px 96px 10px;
  box-shadow: 0 2px 28px 0 rgba(30,50,90,0.04);
  overflow: hidden;
}
.nav-row, .nav-container {
  max-width: 1200px; margin: 0 auto; display: flex;
  justify-content: space-between; align-items: center; position: relative; z-index: 2;
}
.nav-logo-link img { height: 35px; display: block; filter: brightness(0) invert(1);}
.theme-switcher { display: flex; align-items: center; gap: 8px; color: white;}
.theme-toggle { width: 40px; height: 20px; background:rgba(255,255,255,0.4); border-radius: 10px; position: relative; cursor:pointer;}
.theme-toggle::before { content: ''; position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top:2px; left:2px; transition:transform 0.3s;}
body.dark-mode .theme-toggle::before { transform: translateX(20px);}
.hero-content {
  margin-top: 60px;
  background: rgba(255,255,255,0.11);
  border-radius: 32px;
  padding: 34px 34px 30px 34px;
  box-shadow: 0 8px 28px rgba(0,20,60,0.10);
  display: inline-block;
  position: relative;
  z-index: 2;
  animation: fadeInUp .9s cubic-bezier(.22,.68,.38,1.08);
}
.hero-content h1 {
  font-family: 'SF Pro Display', 'Noto Serif JP', serif;
  font-size: 2.9em; font-weight: 900; margin: 24px 0 10px 0;
  letter-spacing: 0.05em; line-height: 1.12; color: #fff;
  text-shadow: 0 3px 18px rgba(24, 24, 48, 0.24);
  animation: heroPop .8s .13s cubic-bezier(.27,.95,.51,1.3) backwards;
}
.hero-content b { color: #ffc107; }
.hero-sub { font-size: 1.15em; margin-top: 10px; opacity:.98; }
.hero-sub .sparkle { animation: sparkleAnim 2.3s infinite; display:inline-block; }
@keyframes sparkleAnim { 0%{opacity:0.2} 48%{opacity:1;} 100%{opacity:0.2;} }
@keyframes heroPop {
  from { opacity:.3; transform: scale(.95);}
  to { opacity:1; transform: scale(1);}
}
@keyframes fadeInUp { 0%{opacity:0;transform:translateY(22px);} 100%{opacity:1;transform:translateY(0);} }
.hero-content .hero-coupon-badge {
  display: inline-block;
  background: linear-gradient(90deg,#ffc107 0%,#ff5858 100%);
  color: #fff; border-radius: 16px; padding: 5px 22px; margin-bottom: 8px;
  font-size: 19px; font-weight: 800; letter-spacing: .02em;
  box-shadow: 0 2px 12px rgba(255,96,40,0.15);
  transform: rotate(-4deg); margin-right: 12px;
  animation: badgeSlide .7s .15s cubic-bezier(.5,1.7,.7,1.1) backwards;
}
@keyframes badgeSlide {
  from { transform: translateX(-120px) scale(.98) rotate(-7deg); opacity: 0;}
  to   { transform: translateX(0) scale(1) rotate(-4deg); opacity: 1;}
}
.hero-search-form {
  margin-top: 25px;
  position: relative;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.hero-search-form input {
  width: 100%;
  padding: 20px 60px 20px 25px;
  font-size: 18px;
  border-radius: 50px;
  border: 1px solid rgba(255,255,255,0.2);
  background-color: rgba(255, 255, 255, 0.95);
  color: #333;
  box-sizing: border-box;
  box-shadow: 0 1.5px 10px rgba(20,50,100,0.10);
}
.hero-search-form .search-icon {
  position: absolute;
  right: 25px;
  top:50%;
  transform:translateY(-50%);
  font-size: 20px;
  color: #888;
}
body.dark-mode {
  --light-gray: #121212;
  --card-bg: #1e1e1e;
  --dark-blue: #e1e9f4; /* ë” ë°ì€ ìƒ‰ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ëŒ€ë¹„ í™•ë³´ */
  /* ... ë‚˜ë¨¸ì§€ ë³€ìˆ˜ ... */
}
/* --------------------------------------------------
   PICKUP SPECIAL COUPON AREA
-------------------------------------------------- */
.pickup-special-section {
  padding: 60px 20px;
  max-width: 1200px;
  margin: 0 auto;
}
.pickup-title-wrapper {
  text-align: center;
  margin-bottom: 40px;
}
.pickup-title {
  font-family: 'Noto Serif JP', serif;
  font-size: 2.5em;
  font-weight: 900;
  color: var(--dark-blue);
  margin: 0 0 10px 0;
  letter-spacing: 0.02em;
  position: relative;
  padding-bottom: 20px;
}
.pickup-title::after {
  content: '';
  position: absolute;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  width: 70px;
  height: 4px;
  background: linear-gradient(90deg, #ffc107, #ff8c2f);
  border-radius: 2px;
}
body.dark-mode .pickup-title { color: #fff; }
.pickup-subtitle {
  font-size: 1.1em;
  color: var(--subtle-text);
  max-width: 600px;
  margin: 0 auto;
}
.pickup-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  grid-template-rows: auto auto;
  gap: 25px;
}
.pickup-card {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  color: #fff;
  box-shadow: 0 8px 28px rgba(30, 50, 90, 0.18);
  transition: transform 0.3s cubic-bezier(.22,.68,.38,1.08), box-shadow 0.3s ease;
  cursor: pointer;
}
.pickup-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 14px 36px rgba(40, 60, 120, 0.22);
}
.pickup-card img {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; object-fit: cover;
  transition: transform 0.4s ease;
}
.pickup-card:hover img { transform: scale(1.05); }
.pickup-overlay {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  background: linear-gradient(180deg, rgba(0,0,0,0) 20%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.8) 100%);
  z-index: 1;
}
.pickup-card:hover .pickup-overlay {
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.5) 40%, rgba(0, 0, 0, 0.9) 100%);
}
.pickup-content {
  position: relative; z-index: 2;
  padding: 25px; display: flex; flex-direction: column;
  justify-content: flex-end; height: 100%;
  box-sizing: border-box; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}
.pickup-badge {
  display: inline-block; align-self: flex-start;
  padding: 6px 14px; border-radius: 14px;
  font-size: 13px; font-weight: 700; margin-bottom: 12px;
  background-color: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
  background: #f7f8fa;
  color: #0066ff;
  border: 1.2px solid #d0e2ff;
  border-radius: 30px;
  font-weight: 700;
}
.pickup-badge.best-pick { background: linear-gradient(90deg, #ffc107, #ff8c2f); color: #fff; }
.pickup-badge.hot-pick { background: linear-gradient(90deg,#ff2f63 0%,#ff8c2f 100%); color: #fff; }
.pickup-card h3, .pickup-card h4 { margin: 0 0 5px 0; font-weight: 800; line-height: 1.3; }
.main-pick .pickup-content h3 { font-size: 2em; }
.sub-pick .pickup-content h4 { font-size: 1.4em; }
.pickup-offer { margin: 0 0 15px 0; font-size: 1.1em; opacity: 0.9; }
.pickup-btn {
  color: #fff; text-decoration: none; font-weight: 700;
  align-self: flex-start; background: rgba(255,255,255,0.25);
  padding: 8px 18px; border-radius: 20px; transition: background-color 0.2s;
}
.pickup-btn:hover { background: rgba(255,255,255,0.4); }
.main-pick { grid-column: 1 / 2; grid-row: 1 / 3; min-height: 500px; }
.sub-pick { grid-column: 2 / 3; }
@media (max-width: 900px) {
  .pickup-grid { grid-template-columns: 1fr; }
  .main-pick, .sub-pick { grid-column: 1 / -1; }
  .main-pick { min-height: 400px; }
  .sub-pick { min-height: 250px; }
}
@media (max-width: 600px) { .pickup-title { font-size: 2em; } }

/* --------------------------------------------------
   ì¹´ë“œ/ì¿ í° ê³µí†µ (ë¦¬ìŠ¤íŠ¸/ìƒì„¸/í”Œë¦½)
-------------------------------------------------- */
.coupon-card-scene { width: 320px; max-width:100vw; aspect-ratio: 2/3.7; perspective: 1000px; border-radius: 20px; border: 1.5px solid #e5eaf2;}
body.dark-mode .coupon-card-scene { border: 1.5px solid #364366; }
.coupon-card { width: 100%; height: 100%; position: relative; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; box-shadow: 0 8px 24px rgba(30,40,90,0.14), 0 1.5px 8px rgba(30,40,90,0.07);}
.coupon-card:hover {
  box-shadow: 0 14px 36px rgba(40,60,120,0.18), 0 2px 12px rgba(40,60,120,0.10);
  transform: translateY(-2px) scale(1.025);
}
.coupon-card {
  transform-style: preserve-3d;
}
.card-face--front,
.card-face--back {
  backface-visibility: hidden;
}
.coupon-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 32px 24px;
}
.filter-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
}

.coupon-card:active { filter: brightness(.95); }
.coupon-card-scene.is-flipped .coupon-card { transform: rotateY(180deg); box-shadow: 0 14px 48px rgba(60,100,220,0.16);}
.coupon-card-scene.is-expired { opacity: 0.6; filter: grayscale(80%);}
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: linear-gradient(135deg, var(--card-bg) 85%, #f5f7fa 100%); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); display: flex; flex-direction: column; overflow: hidden; transition: box-shadow .5s cubic-bezier(.22,.61,.36,1);}
body.dark-mode .card-face { background: linear-gradient(135deg, var(--card-bg) 85%, #22262d 100%);}
.card-face--back { transform: rotateY(180deg); padding: 20px; justify-content: space-between;}
.card-face--front:hover .card-image-wrapper img { transform: scale(1.05); }
.card-face--back, .card-face--front { transition: filter .6s cubic-bezier(.44,1.42,.58,1);}
.card-image-wrapper { width: 100%; aspect-ratio: 4/3; position: relative; overflow: hidden; background: #eee; flex-shrink: 0;}
.card-image-wrapper img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; transition: transform 0.4s ease;}
.card-image-wrapper::after {
  content: "";
  position: absolute; left: 0; top: 0; width: 100%; height: 100%;
  background: linear-gradient(120deg, rgba(0,0,0,0.12) 20%, rgba(20,100,220,0.13) 100%);
  opacity: .72; pointer-events: none; transition: opacity .3s;
}
.card-face--front:hover .card-image-wrapper::after { opacity: .32; }
.card-content { padding: 20px; text-align: center; flex-grow:1; display:flex; flex-direction:column;}
.card-store-name { font-size: 20px; font-weight: bold; margin: 0 0 10px 0; }
.card-offer { font-size: 32px; font-weight: 800; color: var(--danger-color); margin: 0 0 15px 0; }
.card-description { font-size: 15px; color: var(--subtle-text); margin: 0 0 15px 0; flex-grow: 1;}
.card-tags { margin-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;}
.tag {
  background: var(--tag-bg); color: var(--tag-color); border: 1px solid var(--tag-border); font-size: 13px;
  font-weight: 600; padding: 4px 10px; border-radius: 12px; border-width: 2px; letter-spacing: .01em;
}
.expiring-badge { position: absolute; top: 15px; right: -15px; background-color: #e74c3c; color: white; padding: 5px 30px; font-size: 14px; font-weight: bold; transform: rotate(45deg); z-index: 6; opacity: 0; transition: opacity .3s; pointer-events: none;
  background: linear-gradient(90deg, #ff2f63 0%, #ff8c2f 100%);
  box-shadow: 0 2px 8px rgba(255,30,70,0.14);
  animation: badgeShake .6s infinite alternate;
}
.coupon-card-scene.is-expiring .expiring-badge { opacity: 1; }
@keyframes badgeShake { 0% { transform: rotate(42deg) scale(1);} 70% { transform: rotate(48deg) scale(1.08);} 100% { transform: rotate(45deg) scale(1);} }
.card-expiry { font-size: 14px; font-weight: 600; color: var(--subtle-text); margin-top: 10px;}
.card-cta-button {
  border-radius: 18px;
  background: linear-gradient(90deg, #278cff 0%, #004aad 100%);
  box-shadow: 0 2px 6px rgba(40,80,220,0.12);
  font-size: 20px;
  font-weight: 900;
  padding: 17px 0;
  letter-spacing: 0.01em;
  transition: background .18s;
  display: flex; align-items: center; justify-content: center; gap: 10px; color: #fff; text-align: center; text-decoration: none; margin-top: auto;
}
.card-cta-button:hover { background: linear-gradient(90deg, #185abc 0%, #278cff 100%); opacity: .93; }
.save-btn { position: absolute; top: 10px; right: 10px; z-index: 5; background: rgba(0,0,0,0.4); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;}
.save-btn.is-saved { background: var(--save-color); color: white;}
.coupon-card-scene .save-btn.is-saved ~ .coupon-card { box-shadow: 0 0 0 3px #ffd75699; }
.distance-badge {
  position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
  z-index: 10; background: rgba(0,0,0,0.7); color: #fff; border-radius: 20px;
  padding: 6px 18px; font-size: 15px; font-weight: 700; box-shadow: 0 2px 8px rgba(0,0,0,0.1); letter-spacing: 0.02em;
}
.card-category-icon { position: absolute; top: 10px; left: 10px; z-index: 5; background: rgba(0,0,0,0.4); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; }
.back-qr-code { text-align: center; margin-bottom: 10px;}
.back-qr-code img { max-width: 120px; border-radius: 8px;}
.back-map-wrapper { width: 100%; aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; margin-bottom: 10px;}
.back-map-wrapper iframe { width: 100%; height: 100%; border: 0;}
body.dark-mode .back-map-wrapper iframe { filter: invert(1) hue-rotate(200deg) brightness(0.9) contrast(1.2);}
.back-section { margin-bottom: 10px; text-align: left;}
.back-section h4 { font-size: 13px; color: #999; margin: 0 0 5px 0; text-transform: uppercase; border-bottom: 1px solid var(--border-color); padding-bottom: 3px;}
.back-info-list { list-style: none; padding: 0; margin: 0; font-size: 14px; color: var(--subtle-text);}
.back-info-list li { margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; }
.back-info-list a { color: var(--primary-color); text-decoration: none; font-weight: bold; margin-left: 5px; white-space: nowrap; }
.details-link-wrapper { margin-top: 15px; text-align: right;}
.details-link { font-size: 14px; font-weight: bold; color: var(--primary-color); text-decoration: none; }
.back-actions { display: flex; gap: 10px; margin-top: auto; }
.action-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer;}
.share-btn { background: #ffc107; color: #333;}
.flip-back-btn { background: var(--flip-btn-bg); color: var(--flip-btn-color);}
body.dark-mode { background: linear-gradient(135deg, #181c27 0%, #27324a 100%);}
@media (max-width: 600px) {
  .coupon-card-scene { margin-bottom: 24px; }

  .list-title { font-size: 1.5em; }
}
.coupon-card {
  width: 100%; height: 100%;
  position: relative;
  cursor: pointer;
  transition: transform 0.8s;
  transform-style: preserve-3d;
  box-shadow: 0 8px 24px rgba(30,40,90,0.14), 0 1.5px 8px rgba(30,40,90,0.07);
}
/* hover, is-flipped ë“±ì€ ë³„ë„ */
.coupon-card:hover { /* â€¦ */ }
.coupon-card-scene.is-flipped .coupon-card {
  transform: rotateY(180deg);
}
.card-face {
  position: absolute;
  width: 100%; height: 100%;
  backface-visibility: hidden;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  display: flex; flex-direction: column;
  overflow: hidden;
  transition: box-shadow .5s cubic-bezier(.22,.61,.36,1);
  /* background ëŠ” ë³€ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ í•˜ë‚˜ë§Œ */
  background: linear-gradient(135deg, var(--card-bg) 85%, #f5f7fa 100%);
}
.card-face--back { transform: rotateY(180deg); }

/* ã™ã¹ã¦ã®ç”»é¢å¹…ã§ã‚«ãƒ†ã‚´ãƒªã‚¨ãƒªã‚¢ã‚’ä¸­å¤®å¯„ã›ã« */
.filter-sort-wrapper {
  display: flex;           /* æ¨ªä¸¦ã³ */
  flex-wrap: wrap;         /* è¤‡æ•°è¡Œã«æŠ˜ã‚Šè¿”ã— */
  justify-content: center; /* ä¸­å¤®å¯„ã› */
  gap: 10px 16px;          /* ãƒœã‚¿ãƒ³é–“ã®ä½™ç™½ï¼ˆãŠå¥½ã¿ã§èª¿æ•´ï¼‰ */
  margin-top: 12px;        /* ä¸Šæ®µï¼ˆå‘¨è¾ºï¼ä¿å­˜æ¸ˆã¿ï¼‰ã¨ã®éš™é–“ */
  align-self: stretch;
    /* 1) ë¶€ëª¨ ë„ˆë¹„ ê½‰ ì±„ìš°ê¸° */
    width: 100% !important;
  /* 2) flex ì•„ì´í…œìœ¼ë¡œ ëŠ˜ì–´ë‚˜ê¸° */
  flex: 1 1 auto !important;
  /* 3) ë¶€ëª¨ì˜ align-items:center ì—ë„ ê°€ë¡œ í­ì„ ìœ ì§€í•˜ê²Œ */
  align-self: stretch !important;
}

/* ä¸Šæ®µã®ãƒœã‚¿ãƒ³ç¾¤ã¨åˆ†é›¢ã™ã‚‹ãŸã‚ã€controls-container ã®è¨­å®šã¯ãã®ã¾ã¾æ®‹ã—ã¤ã¤â€¦ */
.controls-container {
  display: flex;
  flex-direction: column;  /* ä¸Šæ®µã¨ä¸‹æ®µã‚’ç¸¦ç©ã¿ã« */
  align-items: stretch;     /* å­è¦ç´ (filter-sort-wrapper)ã‚’æ¨ªã„ã£ã±ã„ã«åºƒã’ã‚‹ */
  gap: 16px;               /* ä¸Šæ®µâ‡”ä¸‹æ®µã®è·é›¢ */
  margin-bottom: 40px;
}

/* --------------------------------------------------
   CONDITION BAR & FILTER/SORT
-------------------------------------------------- */
.cond-bar {
  display: flex; flex-wrap: wrap; gap: 15px;
  background: #f8fafc; color: #31547e;
  border-radius: 10px; padding: 10px 24px;
  margin: 20px 0 18px 0; font-size: 15px; align-items: center;
}
.cond-bar b, .cond-bar .active { color: var(--primary-color);}
.cond-bar .reset-btn { margin-left: 10px; background: var(--primary-color); color: #fff; border: none; border-radius: 20px; padding: 5px 18px; font-size: 15px; cursor: pointer;}

.filter-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: center;}
.filter-group + .filter-group::before { content: '|'; color: #d1d9e6; margin-right: 10px; }
.filter-btn {
  background-color: var(--card-bg); border: 1px solid var(--border-color);
  border-radius: 20px; padding: 10px 20px; font-size: 16px; font-weight: 600;
  color: var(--text-color); cursor: pointer; transition: all 0.3s ease; display: flex; gap: 8px; align-items: center;
}
.filter-btn .count { font-size: 14px; color: #888; }
.filter-btn.active {
  background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color);
}
.filter-btn.active .count { color: rgba(255,255,255,0.8); }
body.dark-mode .filter-btn { color: #eee; background: var(--card-bg); border-color: var(--border-color);}
body.dark-mode .filter-btn.active { color: #fff; background: var(--primary-color); border-color: var(--primary-color);}
.sort-controls select {
  padding: 10px 15px; border-radius: 20px; border: 1px solid var(--border-color);
  background: var(--card-bg); color: var(--text-color); font-size: 16px; font-weight: 600; cursor: pointer;
}
.view-switcher { display: flex; background-color: var(--border-color); border-radius: 20px; padding: 4px; align-self: center;}
.view-btn {
  border: none; background-color: transparent; padding: 6px 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer;
  display: flex; align-items: center; gap: 8px; color: var(--subtle-text); transition: all 0.3s;
}
.view-btn.active {
  background-color: var(--card-bg); color: var(--primary-color);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
/* --- SWIPER SLIDE ë„ˆë¹„/íŒ¨ë”©/ì˜¤ë²„í”Œë¡œìš° --- */
.coupon-container {
  overflow-x: auto;
  padding-bottom: 90px;
}
.swiper {
  width: 100% !important;
  padding-bottom: 50px !important;
  overflow: visible !important;
  /*display: flex;*/
  justify-content: center;
  touch-action: pan-y;
}
.swiper-wrapper {
  padding: 0 !important;
}
.swiper-slide {
  flex-shrink: 0;
  width: 300px;
  display: flex;
  justify-content: center;
}

body {
  margin-bottom: 100px;
}
.site-footer {
  margin-top: 70px;
}
.swiper-button-prev, .swiper-button-next {
  z-index: 10;
  top: 45%;
  transform: translateY(-50%);
}
/* Swiper invisible */
.swiper-slide.swiper-slide-invisible {
  visibility: hidden !important;
  pointer-events: none !important;
  opacity: 0 !important;
  width: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
}
html, body {
  overflow-x: hidden;
}

/* --------------------------------------------------
   LIST TITLE
-------------------------------------------------- */
.list-title-wrapper { text-align: center; margin-bottom: 30px; }
.list-title {
  display: inline-block; padding: 12px 30px; background-color: var(--card-bg);
  color: var(--dark-blue); font-size: 1.8em; font-weight: 800; border-radius: 30px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); letter-spacing: 0.03em;
}
body.dark-mode .list-title { color: var(--dark-blue);}
@media (max-width: 600px) { .list-title { font-size: 1.5em; } }

/* --------------------------------------------------
   MINI FEATURE (THEMED) SECTION
-------------------------------------------------- */
.themed-feature-section { max-width: 1200px; margin: 40px auto; padding: 40px 20px; background-color: var(--card-bg); border-radius: 20px;}
body.dark-mode .themed-feature-section { background-color: #272e3a; }
.themed-title { text-align: center; margin-bottom: 30px; }
.themed-title h4 {
  font-family: 'Noto Serif JP', serif;
  font-size: 2em; font-weight: 700; color: var(--dark-blue); margin: 0 0 10px 0;
}
.themed-title h4 span {
  font-size: 0.6em; font-weight: 700; color: #fff;
  background: var(--danger-color); padding: 4px 10px; border-radius: 12px; margin-right: 10px; vertical-align: middle;
}
.themed-title p { font-size: 1.1em; color: var(--subtle-text);}
.themed-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
.themed-card {
  display: block; text-decoration: none; border-radius: 15px; overflow: hidden;
  position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.themed-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
.themed-card img { width: 100%; height: 200px; object-fit: cover; }
.themed-card-content {
  position: absolute; bottom: 0; left: 0; right: 0; padding: 15px; color: #fff;
  background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
}
.themed-card-content h5 { margin: 0 0 2px 0; font-size: 1.2em; font-weight: 700; }
.themed-card-content p { margin: 0; font-size: 0.9em; opacity: 0.9; }
.themed-article-link {
  display: inline-block; margin-top: 15px; font-size: 1em; font-weight: 700; color: var(--primary-color); text-decoration: none;
  background-color: var(--tag-bg); padding: 8px 18px; border-radius: 20px; border: 1px solid var(--tag-border); transition: all 0.2s ease;
}
.themed-article-link:hover { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }

/* --------------------------------------------------
   ì—ë””í„° ì½”ë©˜íŠ¸
-------------------------------------------------- */
.editor-comment {
  background-color: rgba(0, 0, 0, 0.2); border-left: 4px solid var(--save-color);
  padding: 12px 15px; margin: 5px 0 20px 0; border-radius: 0 8px 8px 0; text-align: left;
}
.editor-comment i { margin-right: 8px; color: var(--save-color);}
.editor-comment span { font-size: 14px; line-height: 1.6; opacity: 0.95;}
.editor-comment b { font-weight: 800; }

/* --------------------------------------------------
   MAP / LEAFLET STYLE
-------------------------------------------------- */
#map-container { width: 100%; height: 600px; border-radius: 15px; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);}
.leaflet-popup-content-wrapper { border-radius: 8px; }
.leaflet-popup-content { margin: 10px; text-align: center;}
.leaflet-popup-content h4 { margin: 0 0 5px 0; font-size: 16px;}
.leaflet-popup-content p { margin: 0; color: var(--danger-color); font-weight: bold; }
body.dark-mode .back-map-wrapper iframe { filter: invert(1) hue-rotate(200deg) brightness(0.9) contrast(1.2);}

/* --------------------------------------------------
   FOOTER
-------------------------------------------------- */
.site-footer { background-color: var(--dark-blue); color: rgba(255, 255, 255, 0.7); padding: 50px 20px;}
.footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
.footer-logo img { filter: brightness(0) invert(1) opacity(0.7); height: 30px;}
.footer-about { max-width: 600px; margin: 20px auto; line-height: 1.6; }
.footer-links { margin: 20px 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; list-style: none; padding: 0;}
.footer-links a { color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 14px;}
.footer-links a:hover { color: #fff; }
.footer-copyright { font-size: 13px; margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 30px; }

/* --------------------------------------------------
   EMPTY STATE, TOAST NOTIFY, ê¸°íƒ€
-------------------------------------------------- */
.empty-state { width: 100%; text-align: center; padding: 80px 20px; background: var(--card-bg); border-radius: 15px; margin-top:20px; display: none;}
.empty-state.show { display: block;}
.empty-state .fa-ghost { font-size: 48px; margin-bottom: 20px; color: #999;}
.empty-state h3 { font-size: 24px; color: var(--text-color);}
.empty-state p { font-size: 16px; color: var(--subtle-text); margin-bottom: 25px;}
.empty-state .reset-btn { background: var(--primary-color); color: #fff; border: none; border-radius: 20px; padding: 10px 25px; font-size: 16px; cursor: pointer;}
.toast-notification {
  position: fixed; bottom: 20px; right: 20px; background: var(--dark-blue); color: white; padding: 15px 25px;
  border-radius: 8px; z-index: 1001; opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(20px);
  display: flex; align-items: center; gap: 10px;
}
.toast-notification.show { opacity: 1; transform: translateY(0);}


/* ë§Œì•½ ì¢Œ/ìš°ì— ê¸°ë³¸ íŒ¨ë”©ì´ ìˆë‹¤ë©´ ì œê±° */
.swiper {
  padding-left: 0 !important;
  padding-right: 0 !important;
}


  </style>
</head>
<body>
    <header class="site-header-hero">
        <div class="nav-row">
            <a href="#" class="nav-logo-link">
              <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru Logo">
            </a>
            <div class="theme-switcher">
              <i class="fa-solid fa-sun"></i>
              <div class="theme-toggle"></div>
              <i class="fa-solid fa-moon"></i>
            </div>
          </div>

     
  <div class="hero-content">
    <h1>JAPANKURU <b>Special Coupon</b></h1>
    <div class="hero-search-form">
      <input type="search" id="coupon-search" placeholder="åº—åã€åœ°åŸŸã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ (ä¾‹: æ–°å®¿ã€ãƒ©ãƒ¼ãƒ¡ãƒ³)">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
    </div>
    <div class="hero-sub">
      <span>è¨ªæ—¥è¦³å…‰ã®æœ€æ–°ã‚¯ãƒ¼ãƒãƒ³æƒ…å ±ã¾ã¨ã‚ <span class="sparkle">âœ¨</span></span>
    </div>
  </div>
</header>

      
    <div class="list-title-wrapper">
      <h2 class="list-title">ğŸŸï¸ å…¨ã‚¯ãƒ¼ãƒãƒ³ãƒªã‚¹ãƒˆã‹ã‚‰æ¢ã™</h2>
    </div>
    <div class="interaction-notice">ğŸ’¡ <b>ãƒ’ãƒ³ãƒˆ:</b> å„ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è£é¢ã®è©³ç´°æƒ…å ±ã¨Googleãƒãƒƒãƒ—ãŒç¢ºèªã§ãã¾ã™ï¼</div>
      <!-- [NEW] ì¡°ê±´ë°”(í•„í„°/ê²€ìƒ‰/ì •ë ¬ ìƒíƒœí‘œì‹œ) -->
      <div class="cond-bar" id="cond-bar" style="display:none;"></div>
      <div class="controls-container">
        <div class="view-switcher">
          <button class="view-btn active" data-view="list"><i class="fa-solid fa-list"></i> ãƒªã‚¹ãƒˆ</button>
          <button class="view-btn" data-view="map"><i class="fa-solid fa-map-location-dot"></i> åœ°å›³</button>
        </div>
      
        <div class="filter-sort-wrapper">
          <div class="filter-group">
            <button class="filter-btn" data-filter="nearby"><i class="fa-solid fa-location-arrow"></i> å‘¨è¾º</button>
            <button class="filter-btn" data-filter="saved"><i class="fa-solid fa-star"></i> ä¿å­˜æ¸ˆã¿ <span class="count"></span></button>
          </div>
          <div class="filter-group">
            <button class="filter-btn active" data-filter="all"><i class="fa-solid fa-border-all"></i> ã™ã¹ã¦è¡¨ç¤º <span class="count"></span></button>
            <button class="filter-btn" data-filter="electronics"><i class="fa-solid fa-laptop"></i> å®¶é›» <span class="count"></span></button>
            <button class="filter-btn" data-filter="fashion"><i class="fa-solid fa-shirt"></i> ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ <span class="count"></span></button>
            <button class="filter-btn" data-filter="dining"><i class="fa-solid fa-utensils"></i> ã‚°ãƒ«ãƒ¡ <span class="count"></span></button>
            <button class="filter-btn" data-filter="transport"><i class="fa-solid fa-train-subway"></i> äº¤é€š <span class="count"></span></button>
          </div>
          <div class="sort-controls">
            <select id="sort-select">
              <option value="default">æ¨™æº–ã®ä¸¦ã³é †</option>
              <option value="expiry">æœ‰åŠ¹æœŸé™ãŒè¿‘ã„é †</option>
              <option value="discount">å‰²å¼•ç‡ã®é«˜ã„é †</option>
            </select>
          </div>
        </div>
      </div>
      <div class="empty-state">
        <i class="fa-solid fa-ghost"></i>
        <h3>è©²å½“ã™ã‚‹ã‚¯ãƒ¼ãƒãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</h3>
        <p>ä»–ã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„æ¡ä»¶ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
        <button class="reset-btn">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆæœŸåŒ–</button>
      </div>
      <div id="map-container" style="display: none;"></div>
    <div class="swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide" data-original-order="1">
          <div class="coupon-card-scene" data-coupon-id="1" data-category="electronics" data-expiry="2025-12-31" data-lat="35.6908" data-lon="139.7028">
            <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
            <div class="card-category-icon"></div>
            <div class="distance-badge" style="display: none;"></div>
            <button class="save-btn"><i class="fa-regular fa-star"></i></button>
            <div class="coupon-card">
              <div class="card-face card-face--front">
                <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="KOJIMA Coupon"></div>
                <div class="card-content">
                  <h3 class="card-store-name">ã‚³ã‚¸ãƒ x ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©</h3>
                  <p class="card-offer">æœ€å¤§ 17% OFF</p>
                  <p class="card-description">å…ç¨10% + è¿½åŠ 7%å‰²å¼•ï¼æœ€æ–°ã®é›»å­è£½å“ã‚’å®‰ãæ‰‹ã«å…¥ã‚Œã‚ˆã†ã€‚</p>
                  <div class="card-tags"><span class="tag">#æ–°å®¿</span> <span class="tag">#å…ç¨</span> <span class="tag">#å®¶é›»</span></div>
                  <p class="card-expiry">ğŸ•’ æœ‰åŠ¹æœŸé–“: 2025.12.31</p>
                </div>
                <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
              </div>
              <div class="card-face card-face--back">
                <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BIC2025" alt="QR Code"></div>
                <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T92"></iframe></div>
                <div class="back-section">
                  <h4>é–¢é€£æƒ…å ±</h4>
                  <ul class="back-info-list">
                    <li><span>ğŸ“ ä½æ‰€: æ±äº¬éƒ½æ–°å®¿åŒºæ–°å®¿3-29-1</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T93" target="_blank" rel="noopener noreferrer">çµŒè·¯æ¡ˆå†…</a></li>
                    <li><span>â° å–¶æ¥­æ™‚é–“: æ¯æ—¥ 10:00 - 22:00</span></li>
                    <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: 8éšã®ã‚²ãƒ¼ãƒ ã‚³ãƒ¼ãƒŠãƒ¼ã¯äººæ°—ï¼</span></li>
                  </ul>
                </div>
                <div class="details-link-wrapper"><a href="https://www.japankuru.com/en/shopping/e4200/" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                <div class="back-actions">
                  <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                  <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" data-original-order="2">
          <div class="coupon-card-scene" data-coupon-id="2" data-category="fashion" data-expiry="2025-07-30" data-lat="35.6603" data-lon="139.6983">
             <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
            <div class="card-category-icon"></div>
            <div class="distance-badge" style="display: none;"></div>
            <button class="save-btn"><i class="fa-regular fa-star"></i></button>
            <div class="coupon-card">
              <div class="card-face card-face--front">
                <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="JINS Coupon"></div>
                <div class="card-content">
                  <h3 class="card-store-name">JINS</h3>
                  <p class="card-offer">10% OFF</p>
                  <p class="card-description">æ—¥æœ¬ã®ä»£è¡¨çš„ãªãƒ¡ã‚¬ãƒãƒ–ãƒ©ãƒ³ãƒ‰JINSï¼ãŠã—ã‚ƒã‚Œãªãƒ¡ã‚¬ãƒã‚’å…ç¨+å‰²å¼•ã§ã€‚</p>
                  <div class="card-tags"><span class="tag">#æ¸‹è°·</span> <span class="tag">#ãƒ¡ã‚¬ãƒ</span></div>
                  <p class="card-expiry">ğŸ•’ æœ‰åŠ¹æœŸé–“: 2025.07.30</p>
                </div>
                <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
              </div>
              <div class="card-face card-face--back">
                <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-JINS2025" alt="QR Code"></div>
                <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T94"></iframe></div>
                <div class="back-section">
                  <h4>é–¢é€£æƒ…å ±</h4>
                  <ul class="back-info-list">
                    <li><span>ğŸ“ ä½æ‰€: æ±äº¬éƒ½æ¸‹è°·åŒºå®‡ç”°å·ç”º31-1</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T95" target="_blank" rel="noopener noreferrer">çµŒè·¯æ¡ˆå†…</a></li>
                    <li><span>â° å–¶æ¥­æ™‚é–“: æ¯æ—¥ 11:00 - 21:00</span></li>
                    <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: æœ€çŸ­30åˆ†ã§å®Œæˆï¼</span></li>
                  </ul>
                </div>
                <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                <div class="back-actions">
                  <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                  <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" data-original-order="3">
            <div class="coupon-card-scene" data-coupon-id="3" data-category="fashion" data-expiry="2025-09-30" data-lat="35.6705" data-lon="139.7073">
                <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg" alt="BEAMS Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">BEAMS JAPAN</h3>
                            <p class="card-offer">5% è¿½åŠ å‰²å¼•</p>
                            <p class="card-description">æ—¥æœ¬ã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç™ºä¿¡ã™ã‚‹ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—BEAMSã§ç‰¹åˆ¥ãªã‚¢ã‚¤ãƒ†ãƒ ã‚’ã€‚</p>
                            <div class="card-tags"><span class="tag">#åŸå®¿</span><span class="tag">#ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</span></div>
                            <p class="card-expiry">ğŸ•’ æœ‰åŠ¹æœŸé–“: 2025.09.30</p>
                        </div>
                        <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
                    </div>
                    <div class="card-face card-face--back">
                       <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BEAMS25" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T96"></iframe></div>
                        <div class="back-section">
                          <h4>é–¢é€£æƒ…å ±</h4>
                          <ul class="back-info-list">
                            <li><span>ğŸ“ ä½æ‰€: æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰3-24-7</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T97" target="_blank" rel="noopener noreferrer">çµŒè·¯æ¡ˆå†…</a></li>
                            <li><span>â° å–¶æ¥­æ™‚é–“: æ¯æ—¥ 11:00 - 20:00</span></li>
                            <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: æ—¥æœ¬é™å®šã‚³ãƒ©ãƒœå•†å“ã‚’æ¢ã—ã¦ã¿ã¦ã€‚</span></li>
                          </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="4">
            <div class="coupon-card-scene" data-coupon-id="4" data-category="dining" data-expiry="2026-03-31" data-lat="35.6970" data-lon="139.7001">
                <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="Samurai Restaurant Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">ã‚µãƒ ãƒ©ã‚¤ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</h3>
                            <p class="card-offer">ãƒ‰ãƒªãƒ³ã‚¯1æ¯ç„¡æ–™</p>
                            <p class="card-description">è¯éº—ãªã‚·ãƒ§ãƒ¼ã¨å…±ã«æ¥½ã—ã‚€ç‰¹åˆ¥ãªé£Ÿäº‹ï¼ã‚¯ãƒ¼ãƒãƒ³æç¤ºã§ãƒ‰ãƒªãƒ³ã‚¯ã‚’ã‚²ãƒƒãƒˆã€‚</p>
                            <div class="card-tags"><span class="tag">#æ–°å®¿</span><span class="tag">#ã‚¨ãƒ³ã‚¿ãƒ¡</span></div>
                            <p class="card-expiry">ğŸ•’ æœ‰åŠ¹æœŸé–“: 2026.03.31</p>
                        </div>
                        <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
                    </div>
                    <div class="card-face card-face--back">
                       <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-SAMURAI" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T98"></iframe></div>
                        <div class="back-section">
                            <h4>é–¢é€£æƒ…å ±</h4>
                            <ul class="back-info-list">
                                <li><span>ğŸ“ ä½æ‰€: æ±äº¬éƒ½æ–°å®¿åŒºæ­Œèˆä¼ç”º2-45-8</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T99" target="_blank" rel="noopener noreferrer">çµŒè·¯æ¡ˆå†…</a></li>
                                <li><span>â° å–¶æ¥­æ™‚é–“: æ¯æ—¥ 18:00 - 23:30</span></li>
                                <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: å…¬æ¼”æ™‚é–“ã®30åˆ†å‰ã«åˆ°ç€ãŒãŠã™ã™ã‚ï¼</span></li>
                            </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="5">
            <div class="coupon-card-scene" data-coupon-id="5" data-category="transport" data-expiry="9999-12-31" data-lat="35.6580" data-lon="139.7016">
                <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png" alt="Tokyu Line Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">æ±æ€¥ç·š</h3>
                            <p class="card-offer">1æ—¥ä¹—è»Šåˆ¸</p>
                            <p class="card-description">æ±äº¬æ—…è¡Œã®å¿…é ˆã‚¢ã‚¤ãƒ†ãƒ ï¼æ¸‹è°·ã€è‡ªç”±ãŒä¸˜ãªã©ã‚’å·¡ã‚‹æ±æ€¥ç·šã®1æ—¥ä¹—è»Šåˆ¸ã€‚</p>
                            <div class="card-tags"><span class="tag">#æ¸‹è°·</span><span class="tag">#äº¤é€š</span><span class="tag">#ä¹—ã‚Šæ”¾é¡Œ</span></div>
                            <p class="card-expiry">âœ… å¸¸æ™‚ã‚¤ãƒ™ãƒ³ãƒˆ</p>
                        </div>
                        <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-TOKYU" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp0"></iframe></div>
                        <div class="back-section">
                            <h4>é–¢é€£æƒ…å ±</h4>
                            <ul class="back-info-list">
                                <li><span>ğŸ“ äº¤æ›å ´æ‰€: æ¸‹è°·é§…ãªã©æ±æ€¥ç·šã®ä¸»è¦é§…çª“å£</span></li>
                                <li><span>â° åˆ©ç”¨æ™‚é–“: å§‹ç™ºã‹ã‚‰çµ‚é›»ã¾ã§</span></li>
                                <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: ä¸‹åŒ—æ²¢ã€è‡ªç”±ãŒä¸˜ã¸ã®æ—…è¡Œæ™‚ã«ç‰¹ã«ä¾¿åˆ©ï¼</span></li>
                            </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="6">
            <div class="coupon-card-scene" data-coupon-id="6" data-category="electronics" data-expiry="2025-11-30" data-lat="35.6984" data-lon="139.7745">
                <div class="expiring-badge">é–“ã‚‚ãªãçµ‚äº†</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png" alt="Yodobashi Camera Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">ãƒ¨ãƒ‰ãƒã‚·ã‚«ãƒ¡ãƒ©</h3>
                            <p class="card-offer">æœ€å¤§ 15% OFF</p>
                            <p class="card-description">å…ç¨10% + VISAã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã§5%è¿½åŠ å‰²å¼•ï¼ã‚«ãƒ¡ãƒ©ã€å®¶é›»ã€ã‚²ãƒ¼ãƒ ã¾ã§ã€‚</p>
                            <div class="card-tags"><span class="tag">#ç§‹è‘‰åŸ</span><span class="tag">#å…ç¨</span><span class="tag">#ã‚²ãƒ¼ãƒ </span></div>
                            <p class="card-expiry">ğŸ•’ æœ‰åŠ¹æœŸé–“: 2025.11.30</p>
                        </div>
                        <div class="card-cta-button">âœ‚ï¸ ã‚¯ãƒ¼ãƒãƒ³è£é¢ã‚’è¦‹ã‚‹</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-Yodobashi" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp1"></iframe></div>
                        <div class="back-section">
                          <h4>é–¢é€£æƒ…å ±</h4>
                          <ul class="back-info-list">
                            <li><span>ğŸ“ ä½æ‰€: æ±äº¬éƒ½åƒä»£ç”°åŒºç¥ç”°èŠ±å²¡ç”º1-1</span><a href="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp2" target="_blank" rel="noopener noreferrer">çµŒè·¯æ¡ˆå†…</a></li>
                            <li><span>â° å–¶æ¥­æ™‚é–“: æ¯æ—¥ 09:30 - 22:00</span></li>
                            <li><span>âœ¨ ãƒ’ãƒ³ãƒˆ: ãƒ•ã‚£ã‚®ãƒ¥ã‚¢ã‚„ã‚¢ãƒ‹ãƒ¡ã‚°ãƒƒã‚ºã¯6éšã«é›†çµï¼</span></li>
                          </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">è©³ç´°æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> å…±æœ‰</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> è¡¨é¢ã¸</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>

  <section class="pickup-special-section">
    <div class="pickup-title-wrapper">
      <h2 class="pickup-title">ğŸ”¥ Editor's Pick / ä»Šé€±ã®ç‰¹åˆ¥ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
      <p class="pickup-subtitle">ã‚¸ãƒ£ãƒ‘ãƒ³ã‚°ãƒ«ç·¨é›†éƒ¨ãŒå³é¸ã—ãŸã€ä»Šé€±æœ€é«˜ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ãŠè¦‹é€ƒã—ãªãï¼</p>
    </div>
    <div class="pickup-grid">
      <div class="pickup-card main-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="ãƒ¡ã‚¤ãƒ³æ¨è–¦ã‚¯ãƒ¼ãƒãƒ³ã‚¤ãƒ¡ãƒ¼ã‚¸" loading="eager" 
        fetchpriority="high">>
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge best-pick">ğŸŒŸ BEST PICK</span>
          <h3>ã‚³ã‚¸ãƒ x ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©</h3>
          <p class="pickup-offer">ç¨æŠœä¾¡æ ¼ã‹ã‚‰æœ€å¤§7%è¿½åŠ å‰²å¼•</p>
          <div class="editor-comment">
            <i class="fa-solid fa-pen-nib"></i>
            <span><b>Editor's Tip:</b> æœ€æ–°ã®ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã¯ã€æ—¥æœ¬ã®åº—èˆ—ãŒä¸–ç•Œã§æœ€ã‚‚æ—©ãã€ãã—ã¦å®‰ãæ‰‹ã«å…¥ã‚‹ãƒãƒ£ãƒ³ã‚¹ã§ã™ï¼</span>
          </div>
          <a href="#coupon-1" class="pickup-btn">ä»Šã™ããƒã‚§ãƒƒã‚¯ &rarr;</a>
        </div>
      </div>
  
      <div class="pickup-card sub-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="ã‚µãƒ–æ¨è–¦1ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge">ğŸ”¥ HOT</span>
          <h4>ã‚µãƒ ãƒ©ã‚¤ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</h4>
          <p class="pickup-offer">ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ‰ãƒªãƒ³ã‚¯1æ¯ç„¡æ–™</p>
          <a href="#coupon-4" class="pickup-btn">è©³ã—ãè¦‹ã‚‹ &rarr;</a>
        </div>
      </div>
  
      <div class="pickup-card sub-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="ã‚µãƒ–æ¨è–¦2ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge">âœ… MUST-HAVE</span>
          <h4>JINS ãƒ¡ã‚¬ãƒ</h4>
          <p class="pickup-offer">å…ç¨ + 10%è¿½åŠ å‰²å¼•</p>
          <a href="#coupon-2" class="pickup-btn">è©³ã—ãè¦‹ã‚‹ &rarr;</a>
        </div>
      </div>
    </div>
  </section>


  <section class="themed-feature-section">
    <div class="themed-title">
      <h4><span>SPECIAL</span>å¤ã®çµ‚ã‚ã‚Šã®ãƒã‚¹ãƒˆãƒã‚¤</h4>
      <p>ç§‹ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å…ˆå–ã‚Šã™ã‚‹ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ï¼</p>
      <a href="/articles/summer-end-must-buy" class="themed-article-link">ç‰¹é›†è¨˜äº‹å…¨ä½“ã‚’è¦‹ã‚‹ &rarr;</a>
    </div>
    <div class="themed-grid">
      <a href="#coupon-id-for-item1" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2025/06/Canmake_Summer_Thumbnail02-1536x864.jpg" alt="ì•„ì´í…œ 1">
        <div class="themed-card-content">
          <h5>ç§‹è‰²ã‚³ã‚¹ãƒ¡</h5>
          <p>ä»Šã ã‘ã®é™å®šã‚«ãƒ©ãƒ¼</p>
        </div>
      </a>
      <a href="#coupon-id-for-item2" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2025/05/Vivienne-Westwood_CC32-800x533.jpg" alt="ì•„ì´í…œ 2">
        <div class="themed-card-content">
          <h5>è»½é‡ã‚¸ãƒ£ã‚±ãƒƒãƒˆ</h5>
          <p>æœæ™©ã®æ°—æ¸©å·®ã«</p>
        </div>
      </a>
      <a href="https://www.japankuru.com/ko/shopping/108691/" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/08/CONVERSE_CC08-1536x1024.jpg" alt="ì•„ì´í…œ 3">
        <div class="themed-card-content">
          <h5>æ–°ä½œã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼</h5>
          <p>æ—…ã®å¿…é ˆã‚¢ã‚¤ãƒ†ãƒ </p>
        </div>
      </a>
    </div>
  </section>

  <footer class="site-footer">
    <div class="footer-content">
      <a href="#" class="footer-logo">
        <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru Logo">
      </a>
      <p class="footer-about">æ—¥æœ¬ã®ã™ã¹ã¦ã‚’æ·±ãã€é¢ç™½ãã€‚Japankuruã¨å…±ã«ã™ã‚‹ç‰¹åˆ¥ãªæ—…è¡Œã€‚</p>
      <ul class="footer-links">
        <li><a href="#">ä¼šç¤¾ç´¹ä»‹</a></li>
        <li><a href="#">ã™ã¹ã¦ã®ã‚¯ãƒ¼ãƒãƒ³</a></li>
        <li><a href="#">ãŠå•ã„åˆã‚ã›</a></li>
        <li><a href="#">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
      </ul>
      <div style="margin-top:22px;">
        <a href="#"><img src="https://scdn.line-apps.com/n/line_add_friends/btn/ja.png" alt="Line" style="height:30px;vertical-align:middle;"></a>
        <span style="font-size:15px;margin-left:10px;">å…¬å¼LINEã§æœ€æ–°ã‚¯ãƒ¼ãƒãƒ³é…ä¿¡ä¸­ï¼</span>
      </div>
      <div class="footer-copyright">Â© 2025 Japankuru. All Rights Reserved.</div>
    </div>
  </footer>
  <div id="toast" class="toast-notification"></div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- DOM ê°ì²´ ---
    const dom = {
      swiper: document.querySelector('.swiper'),
      swiperWrapper: document.querySelector('.swiper-wrapper'),
      controlsContainer: document.querySelector('.controls-container'),
      sortSelect: document.getElementById('sort-select'),
      searchInput: document.getElementById('coupon-search'),
      condBar: document.getElementById('cond-bar'),
      emptyState: document.querySelector('.empty-state'),
      themeToggle: document.querySelector('.theme-toggle'),
      allSlides: Array.from(document.querySelectorAll('.swiper-slide')),
      resetBtn: document.querySelector('.empty-state .reset-btn'),
      viewSwitcher: document.querySelector('.view-switcher'),
      mapContainer: document.getElementById('map-container'),
      swiperPagination: document.querySelector('.swiper-pagination'),
      swiperPrev: document.querySelector('.swiper-button-prev'),
      swiperNext: document.querySelector('.swiper-button-next'),
    };
    const state = {
      swiper: null,
      savedCouponIds: [],
      userLocation: null,
      map: null,
      mapMarkers: [],
      currentView: 'list',
      categoryIcons: {
        electronics: 'fa-solid fa-laptop',
        fashion: 'fa-solid fa-shirt',
        dining: 'fa-solid fa-utensils',
        transport: 'fa-solid fa-train-subway',
        default: 'fa-solid fa-tags'
      }
    };
  
// --- Swiper ì´ˆê¸°í™” ---
function initSwiper() {
// initSwiper() ì•ˆì—ì„œ
state.swiper = new Swiper(dom.swiper, {
  // â‘  centeredSlides: true ìœ ì§€
  centeredSlides: true,
  // â‘¡ slidesPerView: ê¸°ë³¸ê°’ 1
  slidesPerView: 1,
  spaceBetween: 20,
  grabCursor: true,
  watchOverflow: true,
  pagination: { el: '.swiper-pagination', clickable: true },
  navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
  breakpoints: {
    // ëª¨ë°”ì¼/íƒœë¸”ë¦¿ì—ì„œë„ í•œ ì¥ì”©
    768: {
      slidesPerView: 1,
      spaceBetween: 20,
      centeredSlides: true,
    },
    // ë°ìŠ¤í¬íƒ‘ì€ í•œ ë²ˆì— ì„¸ ì¥ì”©
    1024: {
      slidesPerView: 3,
      spaceBetween: 24,
      centeredSlides: true,
    }
  }
});
}

  
    // --- ì§€ë„ ì´ˆê¸°í™” ---
    function initMap() {
      if (!dom.mapContainer) return;
      state.map = L.map(dom.mapContainer).setView([35.6895, 139.6917], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19, attribution: 'Â© OpenStreetMap'
      }).addTo(state.map);
    }
  
    // --- ë§ˆì»¤ ë™ê¸°í™” ---
    function updateMapMarkers(visibleCards) {
      if (!state.map) return;
      state.mapMarkers.forEach(marker => marker.remove());
      state.mapMarkers = [];
      if (visibleCards.length === 0) return;
      const bounds = [];
      visibleCards.forEach(card => {
        const lat = card.dataset.lat, lon = card.dataset.lon;
        if (!lat || !lon) return;
        const marker = L.marker([parseFloat(lat), parseFloat(lon)]).addTo(state.map);
        bounds.push([parseFloat(lat), parseFloat(lon)]);
        const popupContent = `<h4>${card.querySelector('.card-store-name').textContent}</h4><p>${card.querySelector('.card-offer').textContent}</p>`;
        marker.bindPopup(popupContent);
        state.mapMarkers.push(marker);
      });
      if (bounds.length > 0) state.map.fitBounds(bounds, { padding: [50, 50] });
    }
  
    // --- ì¹´ë“œ ì„¸íŒ…(ì €ì¥, í”Œë¦½, ê³µìœ , ì•„ì´ì½˜) ---
    function setupCards() {
  dom.allSlides.forEach(slide => {
    const card = slide.querySelector('.coupon-card-scene');
    const cardElem = slide.querySelector('.coupon-card');
    // â€¦saveBtn, shareBtn ì„¤ì • ìƒëµâ€¦

    // ì¹´ë“œ í”Œë¦½ (ë‹¨, ë’¤ì§‘ê¸° í•´ì œ ë²„íŠ¼/ì €ì¥/ê³µìœ ëŠ” ì œì™¸)
    cardElem.onclick = e => {
      // 1) ì €ì¥ ë²„íŠ¼, 2) í‘œë©´ìœ¼ë¡œ ë²„íŠ¼, 3) ê³µìœ  ë²„íŠ¼ í´ë¦­ ì‹œì—” ë¬´ì‹œ
      if (
           e.target.closest('.save-btn')   ||
           e.target.closest('.flip-back-btn') ||
           e.target.closest('.share-btn')
         ) {
        return;
      }
      card.classList.toggle('is-flipped');
    };

    // ë’·ë©´ 'í‘œë©´ìœ¼ë¡œ' ë²„íŠ¼
    const flipBackBtn = slide.querySelector('.flip-back-btn');
    if (flipBackBtn) {
      flipBackBtn.innerHTML = '<i class="fa-solid fa-arrow-left"></i> è¡¨é¢ã¸';
      flipBackBtn.onclick = e => {
        e.stopPropagation();
        card.classList.remove('is-flipped');
      }
    }
  
        // ê³µìœ  ë²„íŠ¼
        const shareBtn = slide.querySelector('.share-btn');
        if (shareBtn) {
          shareBtn.innerHTML = '<i class="fa-solid fa-share-nodes"></i> å…±æœ‰';
          shareBtn.onclick = async e => {
            e.stopPropagation();
            const title = card.querySelector('.card-store-name').textContent;
            const text = card.querySelector('.card-offer').textContent + ' ' + card.querySelector('.card-description').textContent;
            const url = location.href.split('#')[0] + '#coupon-' + card.dataset.couponId;
            if (navigator.share) {
              try {
                await navigator.share({ title, text, url });
                showToast('å…±æœ‰ã—ã¾ã—ãŸï¼');
              } catch {
                showToast('å…±æœ‰ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚');
              }
            } else {
              try {
                await navigator.clipboard.writeText(url);
                showToast('ã‚¯ãƒ¼ãƒãƒ³URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
              } catch {
                prompt('ã“ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å…±æœ‰ã—ã¦ãã ã•ã„:', url);
              }
            }
          };
        }
  
        // ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜
        const categoryIcon = slide.querySelector('.card-category-icon');
        if (categoryIcon) {
          const category = card.dataset.category;
          const iconClass = state.categoryIcons[category] || state.categoryIcons.default;
          categoryIcon.innerHTML = `<i class="${iconClass}"></i>`;
        }
      });
      updateSaveButtonsVisuals();
    }
  
    // ì €ì¥ ë²„íŠ¼ ì‹œê°í™”
    function updateSaveButtonsVisuals() {
      dom.allSlides.forEach(slide => {
        const card = slide.querySelector('.coupon-card-scene');
        const saveBtn = slide.querySelector('.save-btn');
        const couponId = card.dataset.couponId;
        if (state.savedCouponIds.includes(couponId)) {
          saveBtn.classList.add('is-saved');
          saveBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
        } else {
          saveBtn.classList.remove('is-saved');
          saveBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
        }
      });
    }
  
    // ì €ì¥/í•´ì œ
    function toggleSaveCoupon(couponId) {
      const idx = state.savedCouponIds.indexOf(couponId);
      let msg = '';
      if (idx === -1) {
        state.savedCouponIds.push(couponId);
        msg = 'ä¿å­˜æ¸ˆã¿ã«è¿½åŠ ã—ã¾ã—ãŸï¼';
      } else {
        state.savedCouponIds.splice(idx, 1);
        msg = 'ä¿å­˜æ¸ˆã¿ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸã€‚';
      }
      localStorage.setItem('japankuruSavedCoupons', JSON.stringify(state.savedCouponIds));
      updateSaveButtonsVisuals();
      updateFilterCounts();
      showToast(msg);
      updateView();
      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ã‚½ãƒ¼ãƒˆâ†’å†æç”»éƒ¨åˆ†ã®æœ€å¾Œã«å…¥ã‚Œã‚‹
state.swiper.update();
state.swiper.slideTo(0, 0);
    }
  
    // --- ì£¼ë³€(ê±°ë¦¬ìˆœ) ì •ë ¬ + ê±°ë¦¬ ë±ƒì§€ ---
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180, dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    function filterNearby() {
      if (!navigator.geolocation) {
        alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
        return;
      }
      navigator.geolocation.getCurrentPosition(position => {
        const userLat = position.coords.latitude, userLon = position.coords.longitude;
        state.userLocation = [userLat, userLon];
        dom.allSlides.forEach(slide => {
          const card = slide.querySelector('.coupon-card-scene');
          const lat = parseFloat(card.dataset.lat), lon = parseFloat(card.dataset.lon);
          let distance = lat && lon ? calculateDistance(userLat, userLon, lat, lon) : 9999;
          card.dataset.distance = distance;
          // ê±°ë¦¬ ë±ƒì§€
          let distBadge = slide.querySelector('.distance-badge');
          if (!distBadge) {
            distBadge = document.createElement('div');
            distBadge.className = 'distance-badge';
            card.querySelector('.card-image-wrapper').appendChild(distBadge);
          }
          distBadge.textContent = `ç´„${distance.toFixed(1)}km`;
          distBadge.style.display = '';
        });
        // ê±°ë¦¬ìˆœ ì •ë ¬
        dom.allSlides.sort((a, b) => {
          return (parseFloat(a.querySelector('.coupon-card-scene').dataset.distance) -
                  parseFloat(b.querySelector('.coupon-card-scene').dataset.distance));
        }).forEach(slide => dom.swiperWrapper.appendChild(slide));
        updateView();
      }, () => {
        alert('ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      });
    }
  
    // --- í•„í„° ì¹´ìš´íŠ¸ ---
// --- í•„í„° ì¹´ìš´íŠ¸ í•¨ìˆ˜ êµì²´
function updateFilterCounts() {
  dom.controlsContainer.querySelectorAll('.filter-btn').forEach(btn => {
    const filter = btn.dataset.filter;
    let count = 0;
    if (filter === 'all') {
      count = dom.allSlides.length;
    } else if (filter === 'saved') {
      count = dom.allSlides.filter(slide =>
        state.savedCouponIds.includes(slide.querySelector('.coupon-card-scene').dataset.couponId)
      ).length;
    } else if (filter === 'nearby') {
      count = dom.allSlides.length;
    } else {
      // ì¹´í…Œê³ ë¦¬ í•„í„°ì¼ ë•Œ
      count = dom.allSlides.filter(slide =>
        slide.querySelector('.coupon-card-scene').dataset.category === filter
      ).length;
    }
    let cnt = btn.querySelector('.count');
    if (!cnt) {
      cnt = document.createElement('span');
      cnt.className = 'count';
      btn.appendChild(cnt);
    }
    cnt.textContent = ` (${count})`;
  });
}

    // --- ê²€ìƒ‰ì°½: input/ì—”í„°/ë²„íŠ¼ ---
    function setupSearchInput() {
      dom.searchInput.addEventListener('input', updateView);
      dom.searchInput.addEventListener('keydown', e => {
        if (e.key === 'Enter') updateView();
      });
      const searchBtn = document.querySelector('.hero-search-form button,.hero-search-form .search-icon');
      if (searchBtn) searchBtn.onclick = () => updateView();
    }
  
// --- ì¹´ë“œ ëª©ë¡/ì§€ë„ í•„í„°ë§ & ì •ë ¬ ---
  function updateView() {
  const allSlides  = state.masterSlides;
  const activeBtn  = dom.controlsContainer.querySelector('.filter-btn.active');
  if (!activeBtn) return;
  const filter     = activeBtn.dataset.filter;
  const term       = dom.searchInput.value.trim().toLowerCase();
  const sortBy     = dom.sortSelect.value;

  // 1) í•„í„°ë§
  let filtered = allSlides.filter(slide => {
    const c = slide.querySelector('.coupon-card-scene');
    if (term && !c.textContent.toLowerCase().includes(term)) return false;
    if (filter === 'saved'   && !state.savedCouponIds.includes(c.dataset.couponId)) return false;
    if (filter !== 'all' &&
        filter !== 'saved' &&
        filter !== 'nearby' &&
        c.dataset.category !== filter) return false;
    return true;
  });

  // 2) ì •ë ¬
  if (sortBy === 'expiry') {
    filtered.sort((a,b) =>
      a.querySelector('.coupon-card-scene').dataset.expiry
        .localeCompare(b.querySelector('.coupon-card-scene').dataset.expiry)
    );
  } else if (sortBy === 'discount') {
    const num = el => +(el.querySelector('.card-offer').textContent.match(/(\d+)/)||[0,0])[1];
    filtered.sort((a,b)=> num(b)-num(a));
  } else if (filter === 'nearby') {
    filtered.sort((a,b)=>{
      const da = +a.querySelector('.coupon-card-scene').dataset.distance||0;
      const db = +b.querySelector('.coupon-card-scene').dataset.distance||0;
      return da - db;
    });
  } else {
    filtered.sort((a,b)=> a.dataset.originalOrder - b.dataset.originalOrder);
  }

  // 3) Swiper êµì²´
  state.swiper.removeAllSlides();
  filtered.forEach(slide => {
    state.swiper.appendSlide(slide);
  });
  state.swiper.update();
  if (filtered.length) {
    state.swiper.slideTo(0, 0);
  }

  // 4) ë¹ˆ ìƒíƒœ, ì¹´ìš´íŠ¸, ì§€ë„ ë§ˆì»¤
  dom.emptyState.classList.toggle('show', filtered.length === 0);
  updateFilterCounts();
  if (state.currentView === 'map') {
    const cards = filtered.map(s => s.querySelector('.coupon-card-scene'));
    updateMapMarkers(cards);
  }
  // 5) ì¹´ë“œ ë‚´ ë²„íŠ¼(ì €ì¥/í”Œë¦½/ê³µìœ ) ì´ë²¤íŠ¸ ì¬ì„¤ì •
  setupCards();
}


    // --- ê¸°íƒ€ ìœ í‹¸ ---
    function showToast(message) {
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.className = 'toast-notification';
        document.body.appendChild(toast);
      }
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1600);
    }
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('japankuruTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }
  
    // --- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---
    function bindEventListeners() {
      // ë·° ì „í™˜
      dom.viewSwitcher.addEventListener('click', (e) => {
        const target = e.target.closest('.view-btn');
        if (!target || target.classList.contains('active')) return;
        dom.viewSwitcher.querySelector('.active').classList.remove('active');
        target.classList.add('active');
        state.currentView = target.dataset.view;
        const isMapView = state.currentView === 'map';
        dom.swiper.style.display = isMapView ? 'none' : 'block';
        dom.mapContainer.style.display = isMapView ? 'block' : 'none';
        dom.controlsContainer.style.marginBottom = isMapView ? '20px' : '40px';
        if (isMapView) {
          state.map.invalidateSize();
          updateView();
        }
      });
  
      // í•„í„° ë²„íŠ¼
      
dom.controlsContainer.addEventListener('click', e => {
  const target = e.target.closest('.filter-btn');
  if (target && !target.classList.contains('active')) {
    // ê¸°ì¡´ active í•´ì œ (ëª¨ë“  í•„í„°)
    dom.controlsContainer.querySelectorAll('.filter-btn.active').forEach(btn => btn.classList.remove('active'));
    // ì„ íƒëœ ê²ƒë§Œ active
    target.classList.add('active');
    // ì£¼ë³€í•„í„°ëŠ” ë³„ë„
    if (target.dataset.filter === 'nearby') filterNearby();
    else updateView();
  }
});

  
      setupSearchInput();
  
      dom.sortSelect.addEventListener('change', updateView);
      dom.themeToggle.addEventListener('click', toggleTheme);
  
      // ì¡°ê±´ ë¦¬ì…‹
      const resetLogic = () => {
  dom.searchInput.value = '';
  dom.controlsContainer.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  dom.controlsContainer.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
  dom.sortSelect.value = 'default';
  updateView();
};

      dom.condBar && dom.condBar.addEventListener('click', e => { if (e.target.classList.contains('reset-btn')) resetLogic(); });
      dom.resetBtn && dom.resetBtn.addEventListener('click', resetLogic);
    }
  
    // --- ì´ˆê¸°í™” ---
    function init() {
      state.masterSlides = Array.from(document.querySelectorAll('.swiper-slide'));
      state.savedCouponIds = JSON.parse(localStorage.getItem('japankuruSavedCoupons') || '[]');
      if (localStorage.getItem('japankuruTheme') === 'dark') document.body.classList.add('dark-mode');
      initSwiper();
      initMap();
      updateFilterCounts();
      bindEventListeners();
      updateView();
      // distance-badgeë¥¼ card-image-wrapperë¡œ ì´ë™(ìµœì´ˆ 1íšŒ)
      document.querySelectorAll('.coupon-card-scene').forEach(card => {
        const imgWrap = card.querySelector('.card-image-wrapper');
        const dist = card.querySelector('.distance-badge');
        if (imgWrap && dist && dist.parentNode !== imgWrap) {
          imgWrap.appendChild(dist);
        }
      });
    }

// 2, 3ë²ˆì„ í•œ ë²ˆì—!
function scrollToCouponList() {
  document.querySelector('.coupon-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
}
function hideSpecialSections() {
  document.querySelector('.pickup-special-section').style.display = 'none';
  document.querySelector('.themed-feature-section').style.display = 'none';
}
function showSpecialSections() {
  document.querySelector('.pickup-special-section').style.display = '';
  document.querySelector('.themed-feature-section').style.display = '';
}
function onSearchInputChange() {
  const searchTerm = dom.searchInput.value.trim();
  if (searchTerm) {
    hideSpecialSections();
    scrollToCouponList();
  } else {
    showSpecialSections();
  }
  updateView();
}
dom.searchInput.addEventListener('input', onSearchInputChange);


    init();
  });
  </script>
  
</body>
</html>
