<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="theme-color" content="#2563eb">
  <title>JAPANKURU Coupon Wallet</title>
  <style>
    :root {
      --primary:#2563eb;
      --bg:#f3f4f6;
      --card:#ffffff;
      --radius:.75rem;
      --shadow:0 4px 12px rgba(0,0,0,0.08);
      --text:#111827;
      --muted:#6b7280;
      --border:#d1d5db;
      --gray-100:#f3f4f6;
      --gray-700:#374151;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
    }
    .dark-mode {
      --bg:#0f172a;
      --card:#1e293b;
      --text:#f1f5f9;
      --muted:#94a3b8;
      --border:#334155;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    
    /* ì–¸ì–´ë³„ í°íŠ¸ ìµœì í™” */
    body.lang-zh { font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif; }
    body.lang-zh-TW { font-family: -apple-system, "PingFang TC", "Microsoft JhengHei", sans-serif; }
    body.lang-ko { font-family: -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.4;min-height:100vh;padding-bottom:80px;transition:background .3s,color .3s;}
    
    .container{max-width:1000px;margin:0 auto;padding:0 0.75rem;}
    
    /* í—¤ë” */
    .header{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;background:var(--bg);transition:transform .3s;}
    .header.hidden{transform:translateY(-100%);}
    
    /* ===== ìƒˆë¡œìš´ ëª¨ë°”ì¼ í•„í„° ìƒíƒœë°” (í´ë¦­ ê°€ëŠ¥) ===== */
    .filter-status-bar {
      display: none;
      background: var(--card);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 12px 16px;
      align-items: center;
      justify-content: space-between;
    }
    
    @media (max-width: 768px) {
      .filter-status-bar {
        display: flex;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ ê¸°ì¡´ search-filter-bar ìˆ¨ê¹€ */
      .search-filter-bar {
        display: none !important;
      }
    }
    
    .filter-current {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      cursor: pointer;
      flex: 1;
    }
    
    .filter-chip {
      background: var(--gray-100);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 4px;
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .filter-chip:hover {
      transform: scale(1.02);
    }
    
    .filter-chip.active {
      background: var(--primary);
      color: white;
    }
    
    .filter-edit-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .filter-edit-btn:hover {
      transform: scale(1.1);
    }
    
    .dark-mode .filter-edit-btn {
      background: var(--primary);
    }
    
    /* ===== í•„í„° íŒ¨ë„ (ë°”í…€ì‹œíŠ¸) ===== */
    .filter-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      border-radius: 24px 24px 0 0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
      padding: 20px 20px calc(env(safe-area-inset-bottom) + 20px);
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 300;
      max-height: 75vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .filter-panel.show {
      transform: translateY(0);
    }
    
    .panel-handle {
      width: 40px;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin: 0 auto 16px;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .panel-close {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--gray-100);
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s;
    }
    
    .dark-mode .panel-close {
      background: var(--gray-700);
    }
    
    .panel-section {
      margin-bottom: 24px;
    }
    
    .panel-section h4 {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .filter-option {
      padding: 10px 16px;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: var(--card);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .filter-option:hover {
      border-color: var(--primary);
    }
    
    .filter-option.selected {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .filter-count {
      background: rgba(0,0,0,0.1);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
      margin-left: 4px;
    }
    
    .filter-option.selected .filter-count {
      background: rgba(255,255,255,0.3);
    }
    
    /* ===== ìƒì„¸ì •ë³´ ì‹œíŠ¸ ===== */
    .detail-sheet {
      position: fixed;
      background: var(--card);
      z-index: 400;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
    }
    
    /* ëª¨ë°”ì¼: ë°”í…€ì‹œíŠ¸ */
    @media (max-width: 768px) {
      .detail-sheet {
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: 24px 24px 0 0;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        max-height: 85vh;
        transform: translateY(100%);
      }
      
      .detail-sheet.show {
        transform: translateY(0);
      }
    }
    
    /* PC: ëª¨ë‹¬ */
    @media (min-width: 769px) {
      .detail-sheet {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        opacity: 0;
      }
      
      .detail-sheet.show {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }
    
    .detail-content {
      padding: 20px;
    }
    
    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }
    
    .detail-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0;
    }
    
    .action-btn {
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .action-btn.primary {
      background: var(--primary);
      color: white;
    }
    
    .action-btn.secondary {
      background: var(--gray-100);
      color: var(--text);
    }
    
    .dark-mode .action-btn.secondary {
      background: var(--gray-700);
    }
    
    /* ===== í”Œë¡œíŒ… ì¶”ì²œ (ìŠ¤ë§ˆíŠ¸ ê°œì„ ) ===== */
    @media (max-width: 768px) {
      .float-suggest {
        position: fixed;
        bottom: 90px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--card);
        padding: 10px 16px;
        border-radius: 24px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s;
        z-index: 90;
        max-width: 280px;
        border: 1px solid var(--border);
      }
      
      .float-suggest.show {
        display: flex;
      }
      
      .float-suggest:active {
        transform: translateX(-50%) scale(0.95);
      }
      
      .suggest-icon {
        font-size: 16px;
        flex-shrink: 0;
      }
      
      .suggest-text {
        font-size: 13px;
        font-weight: 500;
        flex: 1;
        text-align: center;
      }
      
      .suggest-count {
        background: var(--primary);
        color: white;
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 600;
        min-width: 20px;
        text-align: center;
      }
    }
    
    @media (min-width: 769px) {
      .float-suggest {
        display: none;
      }
    }
    
    /* ===== ê¸°ì¡´ ìŠ¤íƒ€ì¼ ëª¨ë‘ ìœ ì§€ ===== */
    .search-filter-bar{position:sticky;top:0;background:var(--bg);z-index:1000;padding:0.5rem 1rem 0.75rem 1rem;display:flex;flex-direction:column;gap:0.5rem;border-bottom:1px solid var(--border);}
    .logo{font-weight:700;display:flex;align-items:center;gap:.5rem;font-size:1.1rem;color:var(--primary);text-decoration: none;}
    .btn{padding:.5rem 1rem;border:none;border-radius:.5rem;cursor:pointer;font-size:.9rem;display:inline-flex;align-items:center;gap:.25rem;transition:all .2s;-webkit-tap-highlight-color:transparent;}
    .btn:hover{transform:scale(1.02);}
    .btn:active{transform:scale(0.98);}
    .btn:focus{outline:2px solid var(--primary);outline-offset:2px;}
    .btn-primary{background:var(--primary);color:#fff;}
    .btn-primary:hover{background:#1d4ed8;}

    /* ì–¸ì–´ ì„ íƒê¸° ê°œì„  (ì ‘ê·¼ì„± ê°•í™”) */
    .lang-toggle{position:relative;z-index:1001;}
    .lang-btn{background:var(--card);border:1px solid var(--border);display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:14px;transition:all .2s;aria-haspopup:true;aria-expanded:false;}
    .lang-btn:hover{border-color:var(--primary);box-shadow:0 2px 4px rgba(0,0,0,.1);}
    .lang-flag{font-size:18px;}
    .lang-name{font-size:13px;font-weight:500;}
    .lang-menu{position:absolute;right:0;top:calc(100% + 4px);background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,.1);display:none;flex-direction:column;min-width:160px;z-index:1002;overflow:hidden;}
    .lang-menu.show{display:flex;}
    .lang-menu button{background:none;border:none;padding:10px 16px;font-size:14px;text-align:left;cursor:pointer;color:var(--text);transition:background .2s;display:flex;align-items:center;gap:10px;}
    .lang-menu button:hover,.lang-menu button:focus{background:var(--gray-100);outline:none;}
    .dark-mode .lang-menu button:hover,.dark-mode .lang-menu button:focus{background:var(--gray-700);}
    .lang-menu button[aria-selected="true"]{background:#eff6ff;color:var(--primary);font-weight:600;}
    .dark-mode .lang-menu button[aria-selected="true"]{background:rgba(59,130,246,.15);}

    /* ê²€ìƒ‰ ê°œì„  */
    .search{margin:0.5rem 0;position:relative;}
    .search-wrapper{position:relative;display:flex;align-items:center;}
    .search-icon{position:absolute;left:12px;color:var(--muted);pointer-events:none;font-size:16px;}
    .search input{width:100%;padding:.75rem 1rem .75rem 2.5rem;border:1px solid var(--border);border-radius:.5rem;font-size:1rem;outline:none;background:var(--card);color:var(--text);transition:border-color .2s;}
    .search input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1);}
    .search-clear{position:absolute;right:12px;background:none;border:none;color:var(--muted);cursor:pointer;padding:6px;font-size:16px;display:none;transition:color .2s;}
    .search-clear:hover{color:var(--text);}
    .search-clear.show{display:block;}

    /* PCìš© ì§€ì—­ í•„í„° (ìƒë‹¨) */
    .region-filters {
      display: flex;
      gap: .5rem;
      overflow-x: auto;
      margin-bottom: 0.5rem;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 6px;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--gray-100);
      position: relative;
      scroll-behavior: smooth;
    }

    .region-filters::-webkit-scrollbar {
      height: 4px;
    }

    .region-filters::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 2px;
    }

    .region-filters::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 2px;
      opacity: 0.6;
    }

    .region-filters::-webkit-scrollbar-thumb:hover {
      opacity: 1;
    }

    /* ëª¨ë°”ì¼ì—ì„œ ì§€ì—­ í•„í„° ìˆ¨ê¸°ê¸° */
    @media (max-width: 768px) {
      .region-filters {
        display: none;
      }
    }

    /* í•„í„° ê°œì„  (ì¹´í…Œê³ ë¦¬ìš©) */
    .filters {
      display: flex;
      gap: .5rem;
      overflow-x: auto;
      margin-bottom: 0.5rem;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 6px;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) var(--gray-100);
      position: relative;
      scroll-behavior: smooth;
      overflow-x: scroll !important;
    }

    /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” - PCì—ì„œ ë³´ì„ */
    .filters::-webkit-scrollbar {
      height: 4px;
    }

    .filters::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 2px;
    }

    .filters::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 2px;
      opacity: 0.6;
    }

    .filters::-webkit-scrollbar-thumb:hover {
      opacity: 1;
    }

    /* ì¢Œìš° ê·¸ë¼ë°ì´ì…˜ */
    .filters::before,
    .filters::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 6px;
      width: 20px;
      pointer-events: none;
      z-index: 10;
    }

    .filters::before {
      left: 0;
      background: linear-gradient(to right, var(--bg), transparent);
    }

    .filters::after {
      right: 0;
      background: linear-gradient(to left, var(--bg), transparent);
    }

    /* ëª¨ë°”ì¼ì—ì„œë§Œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° - 768px ì´í•˜ì—ì„œë§Œ ì ìš© */
    @media (max-width: 768px) {
      .filters {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      .filters::-webkit-scrollbar {
        display: none;
      }
    }
    
    .pill{padding:.5rem .75rem;border-radius:9999px;border:1px solid var(--border);background:var(--card);cursor:pointer;font-size:.75rem;display:flex;align-items:center;gap:4px;transition:all .3s;white-space:nowrap;position:relative;overflow:hidden;flex-shrink: 0;min-width: fit-content;}
    .pill::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:var(--primary);border-radius:50%;transform:translate(-50%,-50%);transition:all .4s;}
    .pill:hover{transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1);}
    .pill:focus{outline:2px solid var(--primary);outline-offset:2px;}
    .pill[aria-selected="true"]{color:#fff;border-color:var(--primary);}
    .pill[aria-selected="true"]::before{width:200%;height:200%;}
    .pill span{position:relative;z-index:1;}
    .saved-count{background:var(--danger);color:#fff;font-size:10px;padding:1px 5px;border-radius:10px;min-width:16px;text-align:center;font-weight:600;display:none;}
    .saved-count.show{display:inline-block;}

    /* íˆì–´ë¡œ ì„¹ì…˜ */
    .hero-section{text-align:center;padding:1.5rem 1rem;background:linear-gradient(135deg,#4f46e5,#2563eb);color:#ffffff;margin-bottom:1rem;border-radius:var(--radius);box-shadow:var(--shadow);}
    .hero-section h1{font-size:1.5rem;font-weight:700;margin:0 0 0.5rem 0;}
    .hero-section p{font-size:0.9rem;margin:0 0 0.75rem 0;opacity:0.9;}
    .hero-section .cta-button{background-color:#ffffff;color:var(--primary);font-size:0.9rem;font-weight:700;padding:0.6rem 1.2rem;border-radius:9999px;text-decoration:none;transition:all 0.2s ease-in-out;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:inline-block;}
    .hero-section .cta-button:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 6px 16px rgba(0,0,0,0.2);}

    /* ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© */
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;}
    .dark-mode .skeleton{background:linear-gradient(90deg,#334155 25%,#475569 50%,#334155 75%);background-size:200% 100%;}
    .skeleton-card{background:var(--card);border-radius:var(--radius);overflow:hidden;height:300px;box-shadow:var(--shadow);}
    .skeleton-img{height:160px;}
    .skeleton-body{padding:16px;}
    .skeleton-line{height:16px;border-radius:4px;margin-bottom:12px;}
    .skeleton-line.title{width:60%;height:20px;}
    .skeleton-line.desc{width:100%;height:14px;}
    .skeleton-line.short{width:80%;}

    /* ì¿ í° ê·¸ë¦¬ë“œ */
    .coupon-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem;margin-top:0.5rem;}
    .loading .coupon-grid{position:relative;min-height:400px;}

    /* ===== ì¹´ë“œ ìŠ¤íƒ€ì¼ ì •ë¦¬ ===== */
    
    /* ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      position: relative;
      cursor: pointer;
      transition: transform .2s, box-shadow .2s;
      perspective: 1000px;
      min-height: 340px;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,.12);
    }
    
    .card:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    
    /* ì¹´ë“œ ë‚´ë¶€ ì»¨í…Œì´ë„ˆ (3D í”Œë¦½) */
    .card-inner {
      position: relative;
      display: grid;
      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;
      transition: transform .6s;
    }
    
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    
    /* ì¹´ë“œ ë©´ ê³µí†µ - ê°™ì€ ê·¸ë¦¬ë“œ ì…€ì— ê²¹ì¹˜ê¸° */
    .card-face {
      grid-area: 1 / 1 / 2 / 2;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      background: var(--card);
      border-radius: var(--radius);
      width: 100%;
      position: relative;
      /* ëª¨ë°”ì¼ ë Œë”ë§ ìµœì í™” */
     -webkit-transform: translateZ(0);
     transform: translateZ(0);
     -webkit-perspective: 1000;
     perspective: 1000;
    }
    
    /* ì•ë©´ */
    .card-front {
      position: relative;
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 340px;
      z-index: 2;
    }
    
    /* ë’·ë©´ */
    .card-back {
      transform: rotateY(180deg);
      padding: 1rem;
      z-index: 1;
    }
    
    /* í”Œë¦½ëœ ìƒíƒœì—ì„œ ì•ë©´ ìš”ì†Œë“¤ ìˆ¨ê¸°ê¸° (ì¤‘ìš”!) */
    .card.flipped .card-front {
      visibility: hidden;
      pointer-events: none;
    }

    .card.flipped .card-back {
      visibility: visible;
      pointer-events: auto;
    }

    /* ëª¨ë°”ì¼ ì „ìš© ìµœì í™” */
    @media (max-width: 768px) {
      .card {
        /* í•˜ë“œì›¨ì–´ ê°€ì† í™œì„±í™” */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }
      
      /* í”Œë¦½ ì‹œ ì•ë©´ ì™„ì „ ìˆ¨ê¹€ */
      .card.flipped .recommendation-wrapper,
      .card.flipped .btn-show-detail,
      .card.flipped .save {
        display: none !important;
      }
    }

    /* ì¶”ê°€ ì•ˆì „ì¥ì¹˜ - íŠ¹ì • ìš”ì†Œë“¤ ê°•ì œ ìˆ¨ê¹€ */
    .card.flipped .speech-bubble {
      display: none !important;
    }

    /* ===== ì•ë©´ ìŠ¤íƒ€ì¼ (ê°„ê²°í•˜ê²Œ) ===== */
    
    /* ì´ë¯¸ì§€ */
    .card-front img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    
    /* í• ì¸ ë°°ì§€ */
    .offer-badge {
      position: absolute;
      top: 175px;
      left: 0;
      background: var(--danger);
      color: #fff;
      padding: 6px 14px;
      font-size: 1rem;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(0,0,0,.2);
      z-index: 10;
      border-radius: 0 8px 8px 0;
    }
    
    /* ì•ë©´ ë³¸ë¬¸ (ì»´íŒ©íŠ¸) */
    .card-body {
      padding: 0.6rem;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      flex: 1;
      min-height: 140px;
    }
    
    .title {
      font-weight: 700;
      font-size: 1rem;
      line-height: 1.2;
    }
    
    .desc {
      font-size: 0.8rem;
      color: var(--muted);
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .area {
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* ì§€ì—­ íƒœê·¸ */
    .area-tags {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
      margin-top: 0.25rem;
    }

    .area-tag {
      font-size: 0.65rem;
      background: var(--gray-100);
      color: var(--muted);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .dark-mode .area-tag {
      background: var(--gray-700);
    }
    
    /* ìƒì„¸ë³´ê¸° ë²„íŠ¼ */
    .btn-show-detail {
      width: auto !important;
      padding: 0.3rem 0.8rem !important;
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      border-radius: 0.5rem;
      font-size: 0.75rem !important;
      margin-top: auto;
      transition: all .2s;
      align-self: flex-end;
    }
    
    .btn-show-detail:hover {
      background: var(--primary);
      color: #fff;
    }

    /* ì´ìš©ì¡°ê±´ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .terms-text {
      background: #f8f9fa;
      border-left: 3px solid var(--primary);
      padding: 0.4rem 0.6rem;
      margin: 0.5rem 0;
      font-size: 0.7rem;
      line-height: 1.4;
      color: var(--text);
      border-radius: 0 0.3rem 0.3rem 0;
    }

    .dark-mode .terms-text {
      background: var(--gray-700);
    }

    .terms-text ul {
      margin: 0;
      padding-left: 1.2rem;
      list-style: none;
    }

    .terms-text li {
      position: relative;
      margin-bottom: 0.2rem;
    }

    .terms-text li::before {
      content: "â€¢";
      color: var(--primary);
      font-weight: bold;
      position: absolute;
      left: -1rem;
    }

    /* ===== ë’·ë©´ ìŠ¤íƒ€ì¼ (ì»´íŒ©íŠ¸) ===== */
    
    /* ë’·ë©´ í—¤ë” */
    .back-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    
    .back-header h3 {
      font-size: 1rem;
      font-weight: 700;
      margin: 0;
    }
    
    /* ë‹«ê¸° ë²„íŠ¼ */
    .close-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: var(--gray-100);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s;
      font-size: 14px;
      color: var(--muted);
    }
    
    .close-btn:hover {
      background: var(--border);
      transform: scale(1.1);
    }
    
    .dark-mode .close-btn {
      background: var(--gray-700);
    }
    
    /* ë°”ì½”ë“œ ì„¹ì…˜ */
    .barcode-section {
      background: #fff;
      padding: 0.75rem;
      border-radius: 6px;
      text-align: center;
      border: 1px solid var(--border);
      margin-bottom: 0.75rem;
    }
    
    .dark-mode .barcode-section {
      background: var(--gray-700);
    }
    
    .barcode-section img {
      max-height: 80px;
      width: auto;
      max-width: 100%;
      object-fit: contain;
    }
    
    /* ë’·ë©´ ì •ë³´ (ì»´íŒ©íŠ¸) */
    .info-grid {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .info-item {
      display: flex;
      gap: 0.5rem;
      font-size: 0.8rem;
      line-height: 1.3;
    }
    
    .info-label {
      font-weight: 600;
      min-width: 70px;
      flex-shrink: 0;
      color: var(--text);
    }
    
    .info-value {
      color: var(--muted);
    }
    
    /* ë§í¬ ìŠ¤íƒ€ì¼ */
    .info-item a {
      color: var(--primary);
      text-decoration: none;
      font-size: 0.8rem;
    }
    
    .info-item a:hover {
      text-decoration: underline;
    }
    
    /* ë³µì‚¬ ë²„íŠ¼ (ì»´íŒ©íŠ¸) */
    .copy-btn,.share-btn {
      width: 100%;
      padding: 0.5rem;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      margin-top: 0.75rem;
      position: relative;
      overflow: hidden;
    }
    
    .copy-btn:hover, .share-btn:hover {
      background: #1d4ed8;
    }
    
    .copy-btn.success span {
      opacity: 0;
    }
    
    /* ì €ì¥ ë²„íŠ¼ */
    .save {
      position: absolute !important;
      top: 12px !important;
      right: 12px !important;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
      transition: all .2s;
      z-index: 30;
      font-size: 1.2rem;
      backface-visibility: visible !important;
      -webkit-backface-visibility: visible !important;
    }
    
    .save:hover {
      transform: scale(1.1);
    }
    
    .save.saved {
      background: var(--success);
      color: #fff;
    }
    
    .dark-mode .save {
      background: var(--card);
      color: var(--text);
    }
    
    .dark-mode .save.saved {
      background: var(--success);
      color: #fff;
    }

    /* ì¶”ì²œ ë§í’ì„  */
    .recommendation-wrapper {
      position: relative;
      z-index: 40;
      margin-top: 0.25rem;
    }

    .recommendation-btn {
      font-size: 0.7rem;
      padding: 3px 6px;
      margin-top: 4px;
    }

    .speech-bubble {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-8px);
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 0.75rem;
      font-size: 0.75rem;
      line-height: 1.4;
      color: var(--text);
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
      max-width: 280px;
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: all 0.3s ease;
      z-index: 1001;
    }

    .speech-bubble.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateX(-50%) translateY(-12px);
    }

    /* ë§í’ì„  í™”ì‚´í‘œ */
    .speech-bubble::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 8px 8px 0 8px;
      border-style: solid;
      border-color: #f9fafb transparent transparent transparent;
    }

    /* ë‹¤í¬ëª¨ë“œ */
    .dark-mode .speech-bubble {
      background: var(--gray-700);
      border-color: var(--border);
    }

    .dark-mode .speech-bubble::after {
      border-color: var(--gray-700) transparent transparent transparent;
    }

    /* ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
      .speech-bubble.show {
        position: fixed;
        bottom: auto;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 85vw;
        max-width: 320px;
        z-index: 1001;
        padding: 1rem;
        font-size: 0.85rem;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œëŠ” í™”ì‚´í‘œ ìˆ¨ê¸°ê¸° */
      .speech-bubble.show::after {
        display: none;
      }
      
      /* ë‹«ê¸° ë²„íŠ¼ ì¶”ê°€ */
      .speech-bubble.show::before {
        content: 'âœ•';
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.1);
        border-radius: 50%;
        cursor: pointer;
        font-size: 14px;
        color: var(--muted);
      }
    }

    /* ë°°ê²½ ì˜¤ë²„ë ˆì´ */
    .speech-bubble-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 1000;
      animation: fadeIn 0.3s;
      display: none;
    }

    .speech-bubble-overlay.show {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* ë²„íŠ¼ í™œì„± ìƒíƒœ */
    .recommendation-btn:active {
      transform: scale(0.95);
    }

    /* ë²„íŠ¼ê³¼ ë§í¬ëŠ” ì˜¤ë²„ë ˆì´ ìœ„ì— - z-index ìˆ˜ì • */
    .card .save,
    .card .btn,
    .card a {
      position: relative;
      z-index: 25;
    }

    /* í”Œë¦½ëœ ìƒíƒœì—ì„œëŠ” ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€ */
    .card.flipped .card-flip-overlay {
      display: none;
    }

    /* ì¹´ë“œ í”Œë¦½ ì‹œ ë°°ì§€ ìˆ¨ê¹€ ì²˜ë¦¬ */
    .card.flipped .offer-badge {
      display: none;
    }

    /* ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ ê°œì„  */
    .no-results{grid-column:1/-1;text-align:center;padding:60px 20px;}
    .no-results-icon{font-size:64px;opacity:.3;margin-bottom:16px;}
    .no-results-title{font-size:20px;font-weight:600;margin-bottom:8px;color:var(--text);}
    .no-results-desc{color:var(--muted);margin-bottom:20px;}
    .suggestion-chips{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
    .suggestion-chip{background:#eff6ff;color:var(--primary);padding:8px 16px;border-radius:20px;border:none;cursor:pointer;font-size:14px;transition:all .2s;}
    .suggestion-chip:hover{background:var(--primary);color:#fff;transform:translateY(-2px);}
    .dark-mode .suggestion-chip{background:rgba(59,130,246,.15);}
    .dark-mode .suggestion-chip:hover{background:var(--primary);}

    /* ì§€ë„ */
    #map{width:100%;height:260px;border-radius:12px;margin:1rem 0;overflow:hidden;position:relative;background:var(--card);border:1px solid var(--border);display:none;}
    #map.show{display:block;}
    #mapError{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:1000;}

    /* í† ìŠ¤íŠ¸ ê°œì„  */
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:#111827;color:#fff;padding:12px 20px;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,.2);opacity:0;pointer-events:none;transition:all .3s;max-width:90vw;z-index:1000;font-size:14px;}
    .toast.show{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(0);}
    .dark-mode .toast{background:#fff;color:#111827;}

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ê°œì„  */
    .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);display:flex;justify-content:space-around;padding:0.5rem;border-top:1px solid var(--border);box-shadow:0 -2px 10px rgba(0,0,0,.05);z-index:1000;}
    .dark-mode .bottom-nav{box-shadow:0 -2px 10px rgba(0,0,0,.2);}
    .nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;color:var(--muted);text-decoration:none;cursor:pointer;padding:6px 12px;border-radius:12px;transition:all 0.2s;flex:1;text-align:center;position:relative;}
    .nav-icon-wrapper{position:relative;width:24px;height:24px;margin-bottom:2px;}
    .nav-icon-wrapper svg{position:absolute;top:0;left:0;width:100%;height:100%;transition:opacity 0.2s;}
    .nav-item .icon-filled{opacity:0;color:var(--primary);}
    .nav-item .icon-outline{opacity:1;}
    .nav-text{font-size:0.7rem;font-weight:500;}
    .nav-item[aria-selected="true"] .icon-filled{opacity:1;}
    .nav-item[aria-selected="true"] .icon-outline{opacity:0;}
    .nav-item[aria-selected="true"] .nav-text{color:var(--primary);font-weight:600;}
    .nav-item[aria-selected="true"]{background-color:rgba(37,99,235,.1);}
    .dark-mode .nav-item[aria-selected="true"]{background-color:rgba(59,130,246,.15);}
    .nav-item:not([aria-selected="true"]):hover{color:var(--primary);}
    .nav-badge{position:absolute;top:2px;right:12px;background:var(--danger);color:#fff;font-size:10px;padding:1px 5px;border-radius:10px;min-width:16px;text-align:center;font-weight:600;display:none;}
    .nav-badge.show{display:block;}

    /* ìœ„ì¹˜ ì—ëŸ¬ */
    .location-error{background:#fee;color:#dc2626;padding:.75rem;border-radius:.5rem;margin:1rem 0;font-size:.8rem;display:none;}
    .location-error.show{display:block;}
    .location-error p{margin-top:.25rem;font-size:.75rem;color:#991b1b;}
    .nearby-hint{margin-top:.5rem;font-size:.75rem;color:var(--muted);display:none;}
    .nearby-hint.show{display:block;}

    /* ìœ í‹¸ë¦¬í‹° */
    .toggle-theme{background:none;border:none;cursor:pointer;font-size:1rem;padding:4px;transition:transform .2s;}
    .toggle-theme:hover{transform:scale(1.1);}
    .toggle-theme:focus{outline:2px solid var(--primary);outline-offset:2px;}
    .retry-btn{background:#ef4444;color:#fff;padding:.25rem .5rem;border:none;border-radius:.25rem;cursor:pointer;font-size:.75rem;margin-top:.5rem;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    
    /* Settings ë·° */
    .settings-view{display:none;padding:1rem;max-width:600px;margin:0 auto;}
    .settings-view.show{display:block;}
    .settings-section{background:var(--card);border-radius:var(--radius);padding:1.5rem;margin-bottom:1rem;box-shadow:var(--shadow);}
    .settings-section h3{margin:0 0 1rem 0;font-size:1.1rem;color:var(--text);}
    .settings-item{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;border-bottom:1px solid var(--border);}
    .settings-item:last-child{border-bottom:none;}
    .settings-label{font-size:0.9rem;color:var(--text);}
    .settings-value{font-size:0.85rem;color:var(--muted);}
    .settings-btn{padding:0.5rem 1rem;background:var(--gray-100);border:none;border-radius:0.5rem;font-size:0.85rem;cursor:pointer;transition:all .2s;}
    .settings-btn:hover{background:var(--border);}
    .dark-mode .settings-btn{background:var(--gray-700);}
    .dark-mode .settings-btn:hover{background:var(--border);}
    .settings-btn.danger{background:#fee;color:var(--danger);}
    .settings-btn.danger:hover{background:#fdd;}
    .dark-mode .settings-btn.danger{background:rgba(239,68,68,.1);color:var(--danger);}
    
    /* ë ˆì´ì§€ ë¡œë”© */
    .lazy{opacity:0;transition:opacity .3s;}
    .lazy.loaded{opacity:1;}

    /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ ì¶”ê°€ */
    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .btn-xs {
      padding: 0.125rem 0.375rem;
      font-size: 0.7rem;
    }

    /* ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ëŒ€ì²´ */
    .recommendation-btn {
      font-size: 0.7rem;
      padding: 3px 6px;
      margin-top: 4px;
    }

    .recommendation-wrapper {
      margin-top: 0.25rem;
    }

    .expiry-line {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: var(--muted);
      margin: 0.3rem 0;
    }

    .expiry-danger {
      color: var(--danger);
      font-weight: 600;
    }

    /* ì˜¤ë²„ë ˆì´ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 250;
    }
    
    .overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* ì •ë ¬ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .sort-select {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--card);
      color: var(--text);
      font-size: 0.85rem;
      cursor: pointer;
      width: auto;
      min-width: 150px;
    }

    .sort-select:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
    .dark-mode .sort-select {
      background: var(--card);
      color: var(--text);
    }

    /* ë¡œê³  ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .logo-img {
      height: 28px;
      width: auto;
      object-fit: contain;
    }

    /* Wallet í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .logo-text {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text);
      margin-left: 0.25rem;
    }

    /* ë‹¤í¬ëª¨ë“œì—ì„œ ë¡œê³  ë°°ê²½ (í•„ìš”í•œ ê²½ìš°) */
    .dark-mode .logo-img {
      filter: brightness(0) invert(1);
    }

    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 480px) {
      .logo-img {
        height: 24px;
      }
      
      .logo-text {
        font-size: 1rem;
      }
      
      .pill {
        font-size: .7rem;
        padding: .4rem .6rem;
      }
    }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 800px){
      .coupon-grid{grid-template-columns:1fr;}
    }
    @media (max-width: 768px){
      .hero-section{padding:1rem;}
      .hero-section h1{font-size:1.3rem;}
      .hero-section p{font-size:.85rem;}
      .hero-section .cta-button{font-size:0.85rem;padding:0.5rem 1rem;}
    }

    /* í•„í„° ì—´ê¸° ë²„íŠ¼ ì˜ì—­ */
    .filter-controls {
      padding: 0.5rem 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- í—¤ë” (ê¸°ì¡´ ìœ ì§€) -->
    <header class="header" aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼">
        <a href="https://www.japankuru.com/" class="logo" aria-label="Japankuru Wallet">
            <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru" class="logo-img">
            <span class="logo-text">Wallet</span>
        </a>
      
      <!-- ê°œì„ ëœ ì–¸ì–´ ì„ íƒê¸° (ì ‘ê·¼ì„± ê°•í™”) -->
      <div class="lang-toggle">
        <button class="lang-btn" id="langBtn" aria-label="è¨€èªé¸æŠ" aria-haspopup="true" aria-expanded="false">
          <span class="lang-flag">ğŸ‡ºğŸ‡¸</span>
          <span class="lang-name">English</span>
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M3 5L6 8L9 5" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </button>
        <div id="langMenu" class="lang-menu" role="menu" aria-labelledby="langBtn">
          <button role="menuitem" data-lang="zh" aria-selected="false">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</button>
          <button role="menuitem" data-lang="zh-TW" aria-selected="false">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</button>
          <button role="menuitem" data-lang="ko" aria-selected="false">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
          <button role="menuitem" data-lang="en" aria-selected="false">ğŸ‡ºğŸ‡¸ English</button>
          <button role="menuitem" data-lang="th" aria-selected="false">ğŸ‡¹ğŸ‡­ à¸ à¸²à¸©à¸²à¹„à¸—à¸¢</button>
        </div>
      </div>

      <div class="flex-center">
        <button class="toggle-theme" id="themeToggle" aria-label="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">ğŸŒ“</button>
      </div>
    </header>
    
    <!-- ëª¨ë°”ì¼ í•„í„° ìƒíƒœë°” (í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ ) -->
    <div class="filter-status-bar">
      <div class="filter-current" id="filterCurrentArea">
        <span class="filter-chip active" id="mobileRegionChip">ğŸ“ All</span>
        <span>â€¢</span>
        <span class="filter-chip" id="mobileCategoryChip">ğŸ·ï¸ All</span>
      </div>
      <button class="filter-edit-btn" id="filterEditBtn" title="í•„í„° ì„¤ì •">âš™ï¸</button>
    </div>
    
    <!-- PC ê²€ìƒ‰+í•„í„° ê³ ì • ë°” (êµ¬ì¡° ê°œì„ ) -->
    <div class="search-filter-bar">
      <!-- ê°œì„ ëœ ê²€ìƒ‰ -->
      <div class="search" aria-label="ê²€ìƒ‰ê³¼ í•„í„°">
        <div class="search-wrapper">
          <span class="search-icon">ğŸ”</span>
          <input type="search" id="searchInput" placeholder="Search by store name or area..." aria-label="Search coupons" autocomplete="off" />
          <button class="search-clear" id="searchClear" aria-label="ê²€ìƒ‰ ì§€ìš°ê¸°">âœ•</button>
        </div>
      </div>

      <div class="filter-controls">
        <!-- ì§€ì—­ í•„í„° (PC ìƒë‹¨) -->
        <div class="region-filters" id="regionContainer">
          <button class="pill" data-filter="all" data-type="region" aria-selected="true">
            <span>ğŸ“ All Regions</span>
          </button>
          <button class="pill" data-filter="tokyo" data-type="region">
            <span>ğŸ—¼ Tokyo</span>
          </button>
          <button class="pill" data-filter="osaka" data-type="region">
            <span>ğŸ¯ Osaka</span>
          </button>
          <button class="pill" data-filter="fukuoka" data-type="region">
            <span>ğŸŒŠ Fukuoka</span>
          </button>
          <button class="pill" data-filter="sapporo" data-type="region">
            <span>â„ï¸ Sapporo</span>
          </button>
          <button class="pill" data-filter="okinawa" data-type="region">
            <span>ğŸï¸ Okinawa</span>
          </button>
          <button class="pill" data-filter="others" data-type="region">
            <span>ğŸ“Œ Others</span>
          </button>
        </div>
        
        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° (PC í•˜ë‹¨) -->
        <div class="filters" id="filterContainer">
            <button class="pill" data-filter="all" aria-selected="true">
              <span>All</span>
            </button>
            <button class="pill" data-filter="saved">
              <span>â­ Saved</span>
              <span class="saved-count" id="savedCount">0</span>
            </button>
            <button class="pill" data-filter="electronics">
              <span>ğŸ”Œ Electronics</span>
            </button>
            <button class="pill" data-filter="fashion">
              <span>ğŸ‘• Fashion</span>
            </button>
            <button class="pill" data-filter="dining">
              <span>ğŸ½ï¸ Dining</span>
            </button>
            <button class="pill" data-filter="transport">
              <span>ğŸš‡ Transport</span>
            </button>
            <button class="pill" data-filter="nearby">
              <span>ğŸ“ Nearby</span>
            </button>
          </div>
          
          <!-- ì •ë ¬ë§Œ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ -->
          <select class="sort-select" id="sortSelect">
            <option value="latest">âœ¨ Latest</option>
            <option value="high_discount">ğŸ’° High Discount</option>
            <option value="by_area">ğŸ—ºï¸ By Area</option>
          </select>
        </div>
    </div>

    <!-- Settings ë·° (ê¸°ì¡´ ìœ ì§€) -->
    <div class="settings-view" id="settingsView">
      <div class="settings-section">
        <h3>è¨€èªè¨­å®š</h3>
        <div class="settings-item">
          <span class="settings-label">è¡¨ç¤ºè¨€èª</span>
          <select id="settingsLang" class="settings-btn">
            <option value="zh">ç®€ä½“ä¸­æ–‡</option>
            <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
            <option value="ko">í•œêµ­ì–´</option>
            <option value="en">English</option>
            <option value="th">à¸ à¸²à¸©à¸²à¹„à¸—à¸¢</option>
          </select>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>è¡¨ç¤ºè¨­å®š</h3>
        <div class="settings-item">
          <span class="settings-label">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
          <button id="settingsTheme" class="settings-btn">ã‚ªãƒ•</button>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
        <div class="settings-item">
          <span class="settings-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¯ãƒ¼ãƒãƒ³</span>
          <button id="clearCache" class="settings-btn">ã‚¯ãƒªã‚¢</button>
        </div>
        <div class="settings-item">
          <span class="settings-label">ä¿å­˜æ¸ˆã¿ã‚¯ãƒ¼ãƒãƒ³</span>
          <button id="clearSaved" class="settings-btn danger">ã™ã¹ã¦å‰Šé™¤</button>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>ã‚µãƒ¼ãƒ“ã‚¹ ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</h3>
        <div class="settings-item">
          <span class="settings-label">ãƒãƒ¼ã‚¸ãƒ§ãƒ³</span>
          <span class="settings-value">2.0.0</span>
        </div>
        <div class="settings-item">
          <span class="settings-label">ãŠå•ã„åˆã‚ã›</span>
          <a href="mailto:support@japankuru.com" class="settings-value" style="color:var(--primary);">info@japankuru.com</a>
        </div>
      </div>
    </div>

    <!-- íˆì–´ë¡œ ì„¹ì…˜ (ê¸°ì¡´ ìœ ì§€) -->
    <section class="hero-section">
      <h1>Make Your Japan Trip More Affordable</h1>
      <p>Get instant discounts at popular stores like Bic Camera and BEAMS. No sign-up required.</p>
      <a href="#couponGrid" class="cta-button">Get Discounts at Popular Stores</a>
    </section>

    <!-- ìœ„ì¹˜ ì—ëŸ¬ í‘œì‹œ -->
    <div class="location-error" id="locationError">
      <strong>Cannot access location</strong>
      <p>Please allow location access in your browser settings.</p>
    </div>

    <!-- ì§€ë„ -->
    <div id="map" aria-label="ã‚¯ãƒ¼ãƒãƒ³ãƒãƒƒãƒ—">
      <div id="mapError">
        <p>åœ°å›³ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ</p>
        <button class="retry-btn" onclick="retryMap()">å†è©¦è¡Œ</button>
      </div>
    </div>
    <div class="nearby-hint" id="nearbyHint">ã€Œè¿‘ãã€ã‚’æŠ¼ã™ã¨ç¾åœ¨åœ°ã«åŸºã¥ã„ã¦ã‚½ãƒ¼ãƒˆã—ã¾ã™ã€‚</div>

    <!-- ì¿ í° ë¦¬ìŠ¤íŠ¸ -->
    <div class="coupon-grid loading" id="couponGrid" aria-label="åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ¼ãƒãƒ³">
      <!-- ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© -->
      <div class="skeleton-card">
        <div class="skeleton skeleton-img"></div>
        <div class="skeleton-body">
          <div class="skeleton skeleton-line title"></div>
          <div class="skeleton skeleton-line desc"></div>
          <div class="skeleton skeleton-line short"></div>
        </div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-img"></div>
        <div class="skeleton-body">
          <div class="skeleton skeleton-line title"></div>
          <div class="skeleton skeleton-line desc"></div>
          <div class="skeleton skeleton-line short"></div>
        </div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-img"></div>
        <div class="skeleton-body">
          <div class="skeleton skeleton-line title"></div>
          <div class="skeleton skeleton-line desc"></div>
          <div class="skeleton skeleton-line short"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ëª¨ë°”ì¼ ìŠ¤ë§ˆíŠ¸ ì¶”ì²œ (ê°œì„ ëœ ë²„ì „) -->
  <div class="float-suggest" id="floatSuggest">
    <span class="suggest-icon">ğŸ’¡</span>
    <span class="suggest-text" id="suggestText">ê²€ìƒ‰í•´ë³´ì„¸ìš”</span>
    <span class="suggest-count" id="suggestCount">6</span>
  </div>

  <!-- í•„í„° íŒ¨ë„ (ëª¨ë°”ì¼ ë°”í…€ì‹œíŠ¸) -->
  <div class="overlay" id="filterOverlay"></div>
  <div class="filter-panel" id="filterPanel">
    <div class="panel-handle"></div>
    <div class="panel-header">
      <h3 id="filterPanelTitle">Filter Options</h3>
      <button class="panel-close" id="filterPanelClose">Ã—</button>
    </div>
    
    <div class="panel-section">
      <h4 data-i18n="region">Region</h4>
      <div class="filter-options" id="regionOptions">
        <button class="filter-option selected" data-region="all">All<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="tokyo">ğŸ—¼ Tokyo<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="osaka">ğŸ¯ Osaka<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="fukuoka">ğŸŒŠ Fukuoka<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="sapporo">â„ï¸ Sapporo<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="okinawa">ğŸï¸ Okinawa<span class="filter-count">0</span></button>
        <button class="filter-option" data-region="others">ğŸ“Œ Others<span class="filter-count">0</span></button>
      </div>
    </div>
    
    <div class="panel-section">
      <h4 data-i18n="category">Category</h4>
      <div class="filter-options" id="categoryOptions">
        <button class="filter-option selected" data-category="all">All</button>
        <button class="filter-option" data-category="electronics">ğŸ”Œ Electronics</button>
        <button class="filter-option" data-category="fashion">ğŸ‘• Fashion</button>
        <button class="filter-option" data-category="dining">ğŸ½ï¸ Dining</button>
        <button class="filter-option" data-category="transport">ğŸš‡ Transport</button>
      </div>
    </div>
  </div>

  <!-- ìƒì„¸ì •ë³´ ì‹œíŠ¸ -->
  <div class="overlay" id="detailOverlay"></div>
  <div class="detail-sheet" id="detailSheet">
    <div class="panel-handle"></div>
    <div class="detail-content">
      <div class="detail-header">
        <div>
          <h2 id="detailTitle">Store Name</h2>
          <div id="detailOffer" style="color:var(--danger);font-size:24px;font-weight:700;">Offer</div>
        </div>
        <button class="panel-close" id="detailClose">Ã—</button>
      </div>
      
      <div class="barcode-section">
        <img id="detailBarcode" class="barcode-img" src="" alt="Barcode">
        <div class="coupon-code" id="detailCode">CODE</div>
      </div>
      
      <div class="detail-actions">
        <button class="action-btn primary" id="detailCopy">
          <span>ğŸ“‹</span>
          <span data-i18n="copyCode">Copy Code</span>
        </button>
        <button class="action-btn secondary" id="detailShare">
          <span>ğŸ“¤</span>
          <span data-i18n="share">Share</span>
        </button>
      </div>
      
      <div id="detailTerms">
        <h4 style="margin-bottom:12px;" data-i18n="termsLabel">Terms & Conditions</h4>
        <ul style="color:var(--muted);font-size:14px;line-height:1.6;" id="detailTermsList">
        </ul>
      </div>
      
      <div id="detailLinks" style="margin-top:20px;">
      </div>
    </div>
  </div>

  <!-- ìŠ¤í¬ë¦°ë¦¬ë” ì•Œë¦¼ ì˜ì—­ -->
  <div id="sr-announcement" aria-live="polite" aria-atomic="true" class="sr-only"></div>

  <!-- ê°œì„ ëœ í† ìŠ¤íŠ¸ -->
  <div class="toast" id="toast" role="alert" aria-live="assertive"></div>

  <!-- ê°œì„ ëœ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ì´ë²¤íŠ¸ ìœ„ì„) -->
  <nav class="bottom-nav" aria-label="ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³" id="navContainer">
    <a href="#" class="nav-item" data-view="home" tabindex="0" aria-selected="true" role="tab">
      <span class="nav-icon-wrapper">
        <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        <svg class="icon-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 7.093v-3.093h-3v-2.093l-7-5.013-7 5.013v2.093h-3v3.093l3 2.143v11.764h14v-11.764l3-2.143zm-12 13.907v-8h4v8h-4z"></path></svg>
      </span>
      <span class="nav-text">Home</span>
    </a>
    <a href="#" class="nav-item" data-view="saved" tabindex="0" aria-selected="false" role="tab">
      <span class="nav-icon-wrapper">
        <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"></path></svg>
        <svg class="icon-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 24l-7-6-7 6v-24h14v24z"></path></svg>
      </span>
      <span class="nav-text">Saved</span>
      <span class="nav-badge" id="navBadge">0</span>
    </a>
    <a href="#" class="nav-item" data-view="map" tabindex="0" aria-selected="false" role="tab">
      <span class="nav-icon-wrapper">
        <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>
        <svg class="icon-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"></path></svg>
      </span>
      <span class="nav-text">Map</span>
    </a>
    <a href="#" class="nav-item" data-view="settings" tabindex="0" aria-selected="false" role="tab">
      <span class="nav-icon-wrapper">
        <svg class="icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        <svg class="icon-filled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.438 11.163l-2.438-1.408v-2.755h-3v-2h-4v2h-3v2.755l-2.438 1.408-.562.915 2.438 1.409v2.849l-2.438 1.409.562.915 2.438-1.408v2.755h3v2h4v-2h3v-2.755l2.438-1.408.562-.915-2.438-1.409v-2.849zm-7.438 2.837c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"></path></svg>
      </span>
      <span class="nav-text">Settings</span>
    </a>
  </nav>

  <script>
    'use strict';

    // ===========================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    // ===========================================
    const Utils = {
      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      },
      
      throttle(func, limit) {
        let inThrottle;
        return function() {
          const args = arguments;
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        };
      },
      
      distance(lat1, lng1, lat2, lng2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLng = (lng2 - lng1) * Math.PI / 180;
        const a = Math.sin(dLat/2) ** 2 + 
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                  Math.sin(dLng/2) ** 2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
      },
      
      formatDate(dateStr) {
        if (dateStr === '9999-12-31') return T[LanguageManager.currentLang].noExpiry || 'æœŸé™ãªã—';
        return dateStr.replace(/-/g, '/');
      },
      
      daysTillExpiry(dateStr) {
        if (dateStr === '9999-12-31') return 999;
        const expiry = new Date(dateStr);
        const today = new Date();
        const days = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
        return days;
      },
      
      // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (ë³´ì•ˆ)
      escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      },
      
      // URL íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸
      updateUrlParam(key, value) {
        const url = new URL(window.location);
        
        // ëª…ì‹œì ì¸ ì²˜ë¦¬
        if (value === null || value === undefined || value === '') {
          url.searchParams.delete(key);
        } else {
          url.searchParams.set(key, value);
        }
        
        window.history.replaceState({}, '', url);
      },
      
      // URL íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
      getUrlParam(key) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(key);
      }
    };

    // ===========================================
    // DOM ìºì‹œ (ì„±ëŠ¥ ìµœì í™”)
    // ===========================================
    const DOMCache = {
      elements: {},
      
      init() {
        this.elements = {
          header: document.querySelector('.header'),
          langBtn: document.getElementById('langBtn'),
          langMenu: document.getElementById('langMenu'),
          searchInput: document.getElementById('searchInput'),
          searchClear: document.getElementById('searchClear'),
          navContainer: document.getElementById('navContainer'),
          couponGrid: document.getElementById('couponGrid'),
          locationError: document.getElementById('locationError'),
          map: document.getElementById('map'),
          mapError: document.getElementById('mapError'),
          nearbyHint: document.getElementById('nearbyHint'),
          toast: document.getElementById('toast'),
          savedCount: document.getElementById('savedCount'),
          navBadge: document.getElementById('navBadge'),
          srAnnouncement: document.getElementById('sr-announcement'),
          themeToggle: document.getElementById('themeToggle'),
          settingsView: document.getElementById('settingsView'),
          settingsLang: document.getElementById('settingsLang'),
          settingsTheme: document.getElementById('settingsTheme'),
          clearCache: document.getElementById('clearCache'),
          clearSaved: document.getElementById('clearSaved'),
          filterContainer: document.getElementById('filterContainer'),
          regionContainer: document.getElementById('regionContainer'),
          sortSelect: document.getElementById('sortSelect'),
          // ìƒˆë¡œ ì¶”ê°€ëœ ìš”ì†Œë“¤
          filterStatusBar: document.querySelector('.filter-status-bar'),
          filterCurrentArea: document.getElementById('filterCurrentArea'),
          filterEditBtn: document.getElementById('filterEditBtn'),
          filterPanel: document.getElementById('filterPanel'),
          filterOverlay: document.getElementById('filterOverlay'),
          filterPanelClose: document.getElementById('filterPanelClose'),
          detailSheet: document.getElementById('detailSheet'),
          detailOverlay: document.getElementById('detailOverlay'),
          detailClose: document.getElementById('detailClose'),
          floatSuggest: document.getElementById('floatSuggest'),
          suggestText: document.getElementById('suggestText'),
          suggestCount: document.getElementById('suggestCount'),
          mobileRegionChip: document.getElementById('mobileRegionChip'),
          mobileCategoryChip: document.getElementById('mobileCategoryChip')
        };
      },
      
      get(key) {
        return this.elements[key];
      }
    };

    // ===========================================
    // í—¤ë” ìŠ¤í¬ë¡¤ ê´€ë¦¬ì
    // ===========================================
    const HeaderManager = {
      lastScroll: 0,
      
      init() {
        window.addEventListener('scroll', Utils.throttle(() => {
          this.handleScroll();
        }, 100));
      },
      
      handleScroll() {
        const header = DOMCache.get('header');
        if (!header) return;
        
        const currentScroll = window.scrollY;
        
        if (currentScroll > this.lastScroll && currentScroll > 60) {
          // ìŠ¤í¬ë¡¤ ë‹¤ìš´ - í—¤ë” ìˆ¨ê¸°ê¸°
          header.classList.add('hidden');
        } else {
          // ìŠ¤í¬ë¡¤ ì—… - í—¤ë” ë³´ì´ê¸°
          header.classList.remove('hidden');
        }
        
        this.lastScroll = currentScroll;
      }
    };

    // ===========================================
    // ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸
    // ===========================================
    const T = {
      zh: {
        cardFlipped: 'å¡ç‰‡å·²ç¿»è½¬',
        cardClosed: 'å¡ç‰‡å·²å…³é—­',
        flipCard: 'ç¿»è½¬å¡ç‰‡',
        coupon: 'ä¼˜æƒ åˆ¸',
        mapRetrying: 'é‡è¯•ä¸­ {current}/{max}...',
        mapLoadFailed: 'åœ°å›¾åŠ è½½å¤±è´¥',
        sharedCoupon: 'å…±äº«çš„ä¼˜æƒ åˆ¸',
        filterAll: 'å…¨éƒ¨',
        filterSaved: 'å·²ä¿å­˜',
        filterElectronics: 'ğŸ”Œ ç”µå™¨',
        filterFashion: 'ğŸ‘• æ—¶å°š',
        filterDining: 'ğŸ½ï¸ ç¾é£Ÿ',
        filterTransport: 'ğŸš‡ äº¤é€š',
        filterNearby: 'ğŸ“ é™„è¿‘',
        noResults: 'æ²¡æœ‰æ‰¾åˆ°ç»“æœ',
        tryAgain: 'è¯·é‡è¯•',
        loading: 'åŠ è½½ä¸­...',
        error: 'å‘ç”Ÿé”™è¯¯',
        pageTitle: 'Japankuru ä¼˜æƒ åˆ¸é’±åŒ…',
        heroTitle: 'è®©æ‚¨çš„æ—¥æœ¬ä¹‹æ—…æ›´å®æƒ ',
        heroDesc: 'åœ¨Bic Cameraã€BEAMSç­‰çƒ­é—¨å•†åº—å³æ—¶è·å¾—æŠ˜æ‰£ã€‚æ— éœ€æ³¨å†Œã€‚',
        ctaButton: 'åœ¨çƒ­é—¨å•†åº—è·å¾—æŠ˜æ‰£',
        searchPlaceholder: 'æŒ‰åº—åæˆ–åœ°åŒºæœç´¢...',
        all: 'å…¨éƒ¨',
        saved: 'å·²ä¿å­˜',
        electronics: 'ğŸ”Œ ç”µå™¨',
        fashion: 'ğŸ‘• æ—¶å°š',
        dining: 'ğŸ½ï¸ ç¾é£Ÿ',
        transport: 'ğŸš‡ äº¤é€š',
        nearby: 'ğŸ“ é™„è¿‘',
        home: 'é¦–é¡µ',
        map: 'åœ°å›¾',
        settings: 'è®¾ç½®',
        languageChanged: 'è¯­è¨€å·²æ›´æ”¹',
        detailShow: 'æŸ¥çœ‹è¯¦æƒ…',
        backToList: 'è¿”å›åˆ—è¡¨',
        backButton: 'â† è¿”å›',
        closeDetail: 'å…³é—­è¯¦æƒ…',
        copyCode: 'å¤åˆ¶ä»£ç ',
        copied: 'å·²å¤åˆ¶',
        codeCopied: 'ä¼˜æƒ åˆ¸ä»£ç å·²å¤åˆ¶ï¼',
        copyFailed: 'å¤åˆ¶å¤±è´¥ã€‚è¯·æ‰‹åŠ¨å¤åˆ¶ã€‚',
        saveCoupon: 'ä¿å­˜ä¼˜æƒ åˆ¸',
        unsaveCoupon: 'å–æ¶ˆä¿å­˜',
        savedCoupon: 'å·²ä¿å­˜',
        unsavedCoupon: 'å·²å–æ¶ˆä¿å­˜',
        locationError: 'æ— æ³•è·å–ä½ç½®',
        locationObtained: 'å·²è·å–ä½ç½®',
        locationDenied: 'ä½ç½®è®¿é—®è¢«æ‹’ç»',
        mapView: 'åœ¨åœ°å›¾ä¸ŠæŸ¥çœ‹',
        mapShown: 'åœ°å›¾å·²æ˜¾ç¤º',
        mapViewTab: 'åœ°å›¾è§†å›¾',
        nearbySort: 'æŒ‰ä½ç½®æ’åº',
        noExpiry: 'æ— æœŸé™',
        store: 'å•†åº—',
        benefit: 'ä¼˜æƒ ',
        expiry: 'æœ‰æ•ˆæœŸ',
        notFound: 'æœªæ‰¾åˆ°ä¼˜æƒ åˆ¸',
        notFoundDesc: 'è¯·å°è¯•æ›´æ”¹æœç´¢æ¡ä»¶',
        suggestions: ['æ¶©è°·', 'æ–°å®¿', 'ç”µå™¨åº—'],
        codeSelected: 'ä»£ç å·²é€‰æ‹©',
        whyThisStore: 'ğŸ’¬ ä¸ºä»€ä¹ˆæ¨èè¿™å®¶åº—ï¼Ÿ',
        daysLeft: 'å‰©ä½™{days}å¤©',
        expiryWarning: 'å³å°†åˆ°æœŸ',
        darkMode: 'æ·±è‰²æ¨¡å¼',
        lightMode: 'æµ…è‰²æ¨¡å¼',
        filterChanged: 'ç­›é€‰æ¡ä»¶å·²æ›´æ”¹',
        focusRestored: 'ç„¦ç‚¹å·²æ¢å¤',
        termsLabel: 'ä½¿ç”¨æ¡æ¬¾',
        terms: ['ä¸å¯ä¸å…¶ä»–ä¼˜æƒ åŒæ—¶ä½¿ç”¨', 'éƒ¨åˆ†å•†å“é™¤å¤–', 'è¯·åœ¨ç»“è´¦å‰å‡ºç¤º', 'æ¯äººé™ç”¨ä¸€æ¬¡'],
        openInGoogleMaps: 'åœ¨Googleåœ°å›¾ä¸­æ‰“å¼€',
        officialWebsite: 'å®˜æ–¹ç½‘ç«™',
        viewSite: 'æŸ¥çœ‹',
        relatedArticle: 'ç›¸å…³æ–‡ç« ',
        readArticle: 'é˜…è¯»æ–‡ç« ',
        errorLoadingCoupons: 'æ— æ³•åŠ è½½ä¼˜æƒ åˆ¸ä¿¡æ¯ã€‚è¯·ç¨åå†è¯•ã€‚',
        cacheCleared: 'ç¼“å­˜å·²æ¸…é™¤',
        savedCouponsCleared: 'æ‰€æœ‰ä¿å­˜çš„ä¼˜æƒ åˆ¸å·²åˆ é™¤',
        confirmClearSaved: 'æ‚¨ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ä¿å­˜çš„ä¼˜æƒ åˆ¸å—ï¼Ÿ',
        shareCoupon: 'åˆ†äº«',
        copySuccess: 'âœ… å·²å¤åˆ¶ï¼',
        termsSummary: '{term}ç­‰ <b>(è¯¦æƒ…è¯·è§èƒŒé¢)</b>',
        sortChanged: 'æ’åºå·²æ›´æ”¹',
        sortBy: 'æ’åº',
        category: 'åˆ†ç±»',
        latest: 'æœ€æ–°',
        highDiscount: 'æŠ˜æ‰£æœ€é«˜',
        byArea: 'æŒ‰åœ°åŒº',
        sortFilter: 'æ’åºÂ·ç­›é€‰',
        region: 'åœ°åŒº',
        filterOptions: 'ç­›é€‰é€‰é¡¹',
        popularRecommend: 'çƒ­é—¨ï¼š{filter}',
        // ì§€ì—­ ì´ë¦„
        tokyo: 'ä¸œäº¬',
        osaka: 'å¤§é˜ª',
        fukuoka: 'ç¦å†ˆ',
        sapporo: 'æœ­å¹Œ',
        okinawa: 'å†²ç»³',
        others: 'å…¶ä»–'
      },
      
      'zh-TW': {
        cardFlipped: 'å¡ç‰‡å·²ç¿»è½‰',
        cardClosed: 'å¡ç‰‡å·²é—œé–‰',
        flipCard: 'ç¿»è½‰å¡ç‰‡',
        coupon: 'å„ªæƒ åˆ¸',
        mapRetrying: 'é‡è©¦ä¸­ {current}/{max}...',
        mapLoadFailed: 'åœ°åœ–è¼‰å…¥å¤±æ•—',
        sharedCoupon: 'å…±äº«çš„å„ªæƒ åˆ¸',
        filterAll: 'å…¨éƒ¨',
        filterSaved: 'å·²ä¿å­˜',
        filterElectronics: 'ğŸ”Œ é›»å™¨',
        filterFashion: 'ğŸ‘• æ™‚å°š',
        filterDining: 'ğŸ½ï¸ ç¾é£Ÿ',
        filterTransport: 'ğŸš‡ äº¤é€š',
        filterNearby: 'ğŸ“ é™„è¿‘',
        noResults: 'æ²’æœ‰æ‰¾åˆ°çµæœ',
        tryAgain: 'è«‹é‡è©¦',
        loading: 'è¼‰å…¥ä¸­...',
        error: 'ç™¼ç”ŸéŒ¯èª¤',
        pageTitle: 'Japankuru å„ªæƒ åˆ¸éŒ¢åŒ…',
        heroTitle: 'è®“æ‚¨çš„æ—¥æœ¬ä¹‹æ—…æ›´å¯¦æƒ ',
        heroDesc: 'åœ¨Bic Cameraã€BEAMSç­‰ç†±é–€å•†åº—å³æ™‚ç²å¾—æŠ˜æ‰£ã€‚ç„¡éœ€è¨»å†Šã€‚',
        ctaButton: 'åœ¨ç†±é–€å•†åº—ç²å¾—æŠ˜æ‰£',
        searchPlaceholder: 'æŒ‰åº—åæˆ–åœ°å€æœå°‹...',
        all: 'å…¨éƒ¨',
        saved: 'å·²ä¿å­˜',
        electronics: 'ğŸ”Œ é›»å™¨',
        fashion: 'ğŸ‘• æ™‚å°š',
        dining: 'ğŸ½ï¸ ç¾é£Ÿ',
        transport: 'ğŸš‡ äº¤é€š',
        nearby: 'ğŸ“ é™„è¿‘',
        home: 'é¦–é ',
        map: 'åœ°åœ–',
        settings: 'è¨­å®š',
        languageChanged: 'èªè¨€å·²æ›´æ”¹',
        detailShow: 'æŸ¥çœ‹è©³æƒ…',
        backToList: 'è¿”å›åˆ—è¡¨',
        backButton: 'â† è¿”å›',
        closeDetail: 'é—œé–‰è©³æƒ…',
        copyCode: 'è¤‡è£½ä»£ç¢¼',
        copied: 'å·²è¤‡è£½',
        codeCopied: 'å„ªæƒ åˆ¸ä»£ç¢¼å·²è¤‡è£½ï¼',
        copyFailed: 'è¤‡è£½å¤±æ•—ã€‚è«‹æ‰‹å‹•è¤‡è£½ã€‚',
        saveCoupon: 'ä¿å­˜å„ªæƒ åˆ¸',
        unsaveCoupon: 'å–æ¶ˆä¿å­˜',
        savedCoupon: 'å·²ä¿å­˜',
        unsavedCoupon: 'å·²å–æ¶ˆä¿å­˜',
        locationError: 'ç„¡æ³•ç²å–ä½ç½®',
        locationObtained: 'å·²ç²å–ä½ç½®',
        locationDenied: 'ä½ç½®è¨ªå•è¢«æ‹’çµ•',
        mapView: 'åœ¨åœ°åœ–ä¸ŠæŸ¥çœ‹',
        mapShown: 'åœ°åœ–å·²é¡¯ç¤º',
        mapViewTab: 'åœ°åœ–è¦–åœ–',
        nearbySort: 'æŒ‰ä½ç½®æ’åº',
        noExpiry: 'ç„¡æœŸé™',
        store: 'å•†åº—',
        benefit: 'å„ªæƒ ',
        expiry: 'æœ‰æ•ˆæœŸ',
        notFound: 'æœªæ‰¾åˆ°å„ªæƒ åˆ¸',
        notFoundDesc: 'è«‹å˜—è©¦æ›´æ”¹æœå°‹æ¢ä»¶',
        suggestions: ['æ¾€è°·', 'æ–°å®¿', 'é›»å™¨åº—'],
        codeSelected: 'ä»£ç¢¼å·²é¸æ“‡',
        whyThisStore: 'ğŸ’¬ ç‚ºä»€éº¼æ¨è–¦é€™å®¶åº—ï¼Ÿ',
        daysLeft: 'å‰©é¤˜{days}å¤©',
        expiryWarning: 'å³å°‡åˆ°æœŸ',
        darkMode: 'æ·±è‰²æ¨¡å¼',
        lightMode: 'æ·ºè‰²æ¨¡å¼',
        filterChanged: 'ç¯©é¸æ¢ä»¶å·²æ›´æ”¹',
        focusRestored: 'ç„¦é»å·²æ¢å¾©',
        termsLabel: 'ä½¿ç”¨æ¢æ¬¾',
        terms: ['ä¸å¯èˆ‡å…¶ä»–å„ªæƒ åŒæ™‚ä½¿ç”¨', 'éƒ¨åˆ†å•†å“é™¤å¤–', 'è«‹åœ¨çµå¸³å‰å‡ºç¤º', 'æ¯äººé™ç”¨ä¸€æ¬¡'],
        openInGoogleMaps: 'åœ¨Googleåœ°åœ–ä¸­é–‹å•Ÿ',
        officialWebsite: 'å®˜æ–¹ç¶²ç«™',
        viewSite: 'æŸ¥çœ‹',
        relatedArticle: 'ç›¸é—œæ–‡ç« ',
        readArticle: 'é–±è®€æ–‡ç« ',
        errorLoadingCoupons: 'ç„¡æ³•è¼‰å…¥å„ªæƒ åˆ¸è³‡è¨Šã€‚è«‹ç¨å¾Œå†è©¦ã€‚',
        cacheCleared: 'å¿«å–å·²æ¸…é™¤',
        savedCouponsCleared: 'æ‰€æœ‰ä¿å­˜çš„å„ªæƒ åˆ¸å·²åˆªé™¤',
        confirmClearSaved: 'æ‚¨ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰ä¿å­˜çš„å„ªæƒ åˆ¸å—ï¼Ÿ',
        shareCoupon: 'åˆ†äº«',
        copySuccess: 'âœ… å·²è¤‡è£½ï¼',
        termsSummary: '{term}ç­‰ <b>(è©³æƒ…è«‹è¦‹èƒŒé¢)</b>',
        sortChanged: 'æ’åºå·²æ›´æ”¹',
        sortBy: 'æ’åº',
        category: 'åˆ†é¡',
        latest: 'æœ€æ–°',
        highDiscount: 'æŠ˜æ‰£æœ€é«˜',
        byArea: 'æŒ‰åœ°å€',
        sortFilter: 'æ’åºÂ·ç¯©é¸',
        region: 'åœ°å€',
        filterOptions: 'ç¯©é¸é¸é …',
        popularRecommend: 'ç†±é–€ï¼š{filter}',
        // ì§€ì—­ ì´ë¦„
        tokyo: 'æ±äº¬',
        osaka: 'å¤§é˜ª',
        fukuoka: 'ç¦å²¡',
        sapporo: 'æœ­å¹Œ',
        okinawa: 'æ²–ç¹©',
        others: 'å…¶ä»–'
      },
      
      ko: {
        cardFlipped: 'ì¹´ë“œê°€ ë’¤ì§‘í˜”ìŠµë‹ˆë‹¤',
        cardClosed: 'ì¹´ë“œê°€ ë‹«í˜”ìŠµë‹ˆë‹¤', 
        flipCard: 'ì¹´ë“œ ë’¤ì§‘ê¸°',
        coupon: 'ì¿ í°',
        mapRetrying: 'ì¬ì‹œë„ ì¤‘ {current}/{max}...',
        mapLoadFailed: 'ì§€ë„ ë¡œë“œ ì‹¤íŒ¨',
        sharedCoupon: 'ê³µìœ ëœ ì¿ í°',
        filterAll: 'ì „ì²´',
        filterSaved: 'ì €ì¥ë¨',
        filterElectronics: 'ğŸ”Œ ê°€ì „',
        filterFashion: 'ğŸ‘• íŒ¨ì…˜',
        filterDining: 'ğŸ½ï¸ ë§›ì§‘',
        filterTransport: 'ğŸš‡ êµí†µ',
        filterNearby: 'ğŸ“ ê·¼ì²˜',
        noResults: 'ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤',
        tryAgain: 'ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”',
        loading: 'ë¡œë”© ì¤‘...',
        error: 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
        pageTitle: 'Japankuru ì¿ í° ì›”ë ›',
        heroTitle: 'ì¼ë³¸ ì—¬í–‰ì´ ë” ì €ë ´í•´ì§‘ë‹ˆë‹¤',
        heroDesc: 'Bic Camera, BEAMS ë“± ì¸ê¸° ë§¤ì¥ì—ì„œ ì¦‰ì‹œ í• ì¸ì„ ë°›ìœ¼ì„¸ìš”. íšŒì›ê°€ì… í•„ìš” ì—†ìŒã€‚',
        ctaButton: 'ì¸ê¸° ë§¤ì¥ì—ì„œ í• ì¸ë°›ê¸°',
        searchPlaceholder: 'ë§¤ì¥ëª…ãƒ»ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰...',
        all: 'ì „ì²´',
        saved: 'ì €ì¥ë¨',
        electronics: 'ğŸ”Œ ê°€ì „',
        fashion: 'ğŸ‘• íŒ¨ì…˜',
        dining: 'ğŸ½ï¸ ë§›ì§‘',
        transport: 'ğŸš‡ êµí†µ',
        nearby: 'ğŸ“ ê·¼ì²˜',
        home: 'í™ˆ',
        map: 'ì§€ë„',
        settings: 'ì„¤ì •',
        languageChanged: 'ì–¸ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤',
        detailShow: 'ìƒì„¸ ë³´ê¸°',
        backToList: 'ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°',
        backButton: 'â† ëŒì•„ê°€ê¸°',
        closeDetail: 'ìƒì„¸ ë‹«ê¸°',
        copyCode: 'ì½”ë“œ ë³µì‚¬',
        copied: 'ë³µì‚¬ë¨',
        codeCopied: 'ì¿ í° ì½”ë“œë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤!',
        copyFailed: 'ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¸¸ê²Œ ëˆŒëŸ¬ì„œ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.',
        saveCoupon: 'ì¿ í° ì €ì¥',
        unsaveCoupon: 'ì¿ í° ì €ì¥ í•´ì œ',
        savedCoupon: 'ì €ì¥í–ˆìŠµë‹ˆë‹¤',
        unsavedCoupon: 'ì €ì¥ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤',
        locationError: 'í˜„ì¬ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
        locationObtained: 'í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤',
        locationDenied: 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤',
        mapView: 'ì§€ë„ì—ì„œ ë³´ê¸°',
        mapShown: 'ì§€ë„ë¥¼ í‘œì‹œí–ˆìŠµë‹ˆë‹¤',
        mapViewTab: 'ì§€ë„ ë³´ê¸°',
        nearbySort: 'í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ì •ë ¬',
        noExpiry: 'ê¸°í•œ ì—†ìŒ',
        store: 'ë§¤ì¥',
        benefit: 'í˜œíƒ',
        expiry: 'ìœ íš¨ê¸°í•œ',
        notFound: 'ì¿ í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
        notFoundDesc: 'ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ë³´ì„¸ìš”',
        suggestions: ['ì‹œë¶€ì•¼', 'ì‹ ì£¼ì¿ ', 'ê°€ì „'],
        codeSelected: 'ì½”ë“œë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤',
        whyThisStore: 'ğŸ’¬ ì™œ ì´ ë§¤ì¥ì¼ê¹Œ?',
        daysLeft: '{days}ì¼ ë‚¨ìŒ',
        expiryWarning: 'ë§Œë£Œ ì„ë°•',
        darkMode: 'ë‹¤í¬ëª¨ë“œ',
        lightMode: 'ë¼ì´íŠ¸ëª¨ë“œ',
        filterChanged: 'í•„í„°ë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤',
        focusRestored: 'í¬ì»¤ìŠ¤ë¥¼ ë³µì›í–ˆìŠµë‹ˆë‹¤',
        termsLabel: 'ì´ìš© ì¡°ê±´',
        terms: ['íƒ€ í• ì¸ê³¼ ì¤‘ë³µ ì‚¬ìš© ë¶ˆê°€', 'ì¼ë¶€ í’ˆëª© ì œì™¸', 'ê³„ì‚° ì „ì— ì œì‹œí•´ì£¼ì„¸ìš”', '1ì¸ 1íšŒ í•œì •'],
        openInGoogleMaps: 'Google Mapsì—ì„œ ì—´ê¸°',
        officialWebsite: 'ê³µì‹ ì›¹ì‚¬ì´íŠ¸',
        viewSite: 'ë³´ê¸°',
        relatedArticle: 'ê´€ë ¨ ê¸°ì‚¬',
        readArticle: 'ê¸°ì‚¬ ì½ê¸°',
        errorLoadingCoupons: 'ì¿ í° ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
        cacheCleared: 'ìºì‹œë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤',
        savedCouponsCleared: 'ì €ì¥ëœ ì¿ í°ì„ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤',
        confirmClearSaved: 'ì •ë§ë¡œ ëª¨ë“  ì €ì¥ëœ ì¿ í°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
        shareCoupon: 'ê³µìœ í•˜ê¸°',
        copySuccess: 'âœ… ë³µì‚¬í–ˆìŠµë‹ˆë‹¤ï¼',
        termsSummary: '{term} ë“± <b>(ë’·ë©´ì—ì„œ ì „ì²´ í™•ì¸)</b>',
        sortChanged: 'ì •ë ¬ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤',
        sortBy: 'ì •ë ¬',
        category: 'ì¹´í…Œê³ ë¦¬',
        latest: 'ìµœì‹  ìˆœ',
        highDiscount: 'í• ì¸ìœ¨ ìˆœ',
        byArea: 'ì§€ì—­ë³„',
        sortFilter: 'ì •ë ¬Â·í•„í„°',
        region: 'ì§€ì—­',
        filterOptions: 'í•„í„° ì˜µì…˜',
        popularRecommend: 'ì¸ê¸°: {filter}',
        // ì§€ì—­ ì´ë¦„
        tokyo: 'ë„ì¿„',
        osaka: 'ì˜¤ì‚¬ì¹´',
        fukuoka: 'í›„ì¿ ì˜¤ì¹´',
        sapporo: 'ì‚¿í¬ë¡œ',
        okinawa: 'ì˜¤í‚¤ë‚˜ì™€',
        others: 'ê¸°íƒ€'
      },
      
      en: {
        cardFlipped: 'Card flipped',
        cardClosed: 'Card closed',
        flipCard: 'Flip card',
        coupon: 'coupon',
        mapRetrying: 'Retrying {current}/{max}...',
        mapLoadFailed: 'Failed to load map',
        sharedCoupon: 'Shared coupon',
        filterAll: 'All',
        filterSaved: 'Saved',
        filterElectronics: 'ğŸ”Œ Electronics',
        filterFashion: 'ğŸ‘• Fashion',
        filterDining: 'ğŸ½ï¸ Dining',
        filterTransport: 'ğŸš‡ Transport',
        filterNearby: 'ğŸ“ Nearby',
        noResults: 'No results found',
        tryAgain: 'Please try again',
        loading: 'Loading...',
        error: 'An error occurred',
        pageTitle: 'Japankuru Coupon Wallet',
        heroTitle: 'Make Your Japan Trip More Affordable',
        heroDesc: 'Get instant discounts at popular stores like Bic Camera and BEAMS. No sign-up required.',
        ctaButton: 'Get Discounts at Popular Stores',
        searchPlaceholder: 'Search by store name or area...',
        all: 'All',
        saved: 'Saved',
        electronics: 'ğŸ”Œ Electronics',
        fashion: 'ğŸ‘• Fashion',
        dining: 'ğŸ½ï¸ Dining',
        transport: 'ğŸš‡ Transport', 
        nearby: 'ğŸ“ Nearby',
        home: 'Home',
        map: 'Map',
        settings: 'Settings',
        languageChanged: 'Language changed',
        detailShow: 'Show Details',
        backToList: 'Back to List',
        backButton: 'â† Back',
        closeDetail: 'Close Details',
        copyCode: 'Copy Code',
        copied: 'Copied',
        codeCopied: 'Coupon code copied!',
        copyFailed: 'Copy failed. Please copy manually.',
        saveCoupon: 'Save Coupon',
        unsaveCoupon: 'Unsave Coupon',
        savedCoupon: 'Saved',
        unsavedCoupon: 'Unsaved',
        locationError: 'Cannot access location',
        locationObtained: 'Location obtained',
        locationDenied: 'Location access denied',
        mapView: 'View on Map',
        mapShown: 'Map displayed',
        mapViewTab: 'Map View',
        nearbySort: 'Sort by location',
        noExpiry: 'No Expiry',
        store: 'Store',
        benefit: 'Benefit',
        expiry: 'Expiry Date',
        notFound: 'No coupons found',
        notFoundDesc: 'Try changing your search criteria',
        suggestions: ['Shibuya', 'Shinjuku', 'Electronics'],
        codeSelected: 'Code selected',
        whyThisStore: 'ğŸ’¬ Why this store?',
        daysLeft: '{days} days left',
        expiryWarning: 'Expiring Soon',
        darkMode: 'Dark Mode',
        lightMode: 'Light Mode',
        filterChanged: 'Filter changed',
        focusRestored: 'Focus restored',
        termsLabel: 'Terms & Conditions',
        terms: ['Cannot be combined with other discounts', 'Some items excluded', 'Please present before payment', 'Limit once per person'],
        openInGoogleMaps: 'Open in Google Maps',
        officialWebsite: 'Official Website',
        viewSite: 'View',
        relatedArticle: 'Related Article',
        readArticle: 'Read Article',
        errorLoadingCoupons: 'Failed to load coupon information. Please try again later.',
        cacheCleared: 'Cache cleared',
        savedCouponsCleared: 'All saved coupons deleted',
        confirmClearSaved: 'Are you sure you want to delete all saved coupons?',
        shareCoupon: 'Share',
        copySuccess: 'âœ… Copied!',
        termsSummary: '{term}, etc. <b>(See back for full details)</b>',
        sortChanged: 'Sort order changed',
        sortBy: 'Sort by',
        category: 'Category',
        latest: 'Latest',
        highDiscount: 'Highest Discount',
        byArea: 'By Area',
        sortFilter: 'SortÂ·Filter',
        region: 'Region',
        filterOptions: 'Filter Options',
        popularRecommend: 'Popular: {filter}',
        // Region names
        tokyo: 'Tokyo',
        osaka: 'Osaka',
        fukuoka: 'Fukuoka',
        sapporo: 'Sapporo',
        okinawa: 'Okinawa',
        others: 'Others'
      },

      th: {
        mapRetrying: 'à¸à¸³à¸¥à¸±à¸‡à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ {current}/{max}...',
        mapLoadFailed: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¹à¸œà¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰',
        sharedCoupon: 'à¸„à¸¹à¸›à¸­à¸‡à¸—à¸µà¹ˆà¹à¸Šà¸£à¹Œ',
        filterAll: 'à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
        filterSaved: 'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§',
        filterElectronics: 'ğŸ”Œ à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ',
        filterFashion: 'ğŸ‘• à¹à¸Ÿà¸Šà¸±à¹ˆà¸™',
        filterDining: 'ğŸ½ï¸ à¸­à¸²à¸«à¸²à¸£',
        filterTransport: 'ğŸš‡ à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡',
        filterNearby: 'ğŸ“ à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡',
        noResults: 'à¹„à¸¡à¹ˆà¸à¸šà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ',
        tryAgain: 'à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡',
        loading: 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...',
        error: 'à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”',
        pageTitle: 'Japankuru Coupon Wallet',
        heroTitle: 'à¸—à¸³à¹ƒà¸«à¹‰à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸›à¸£à¸°à¸«à¸¢à¸±à¸”à¸‚à¸¶à¹‰à¸™',
        heroDesc: 'à¸£à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸—à¸±à¸™à¸—à¸µà¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡à¸­à¸¢à¹ˆà¸²à¸‡ Bic Camera à¹à¸¥à¸° BEAMS à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸',
        ctaButton: 'à¸£à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸—à¸µà¹ˆà¸£à¹‰à¸²à¸™à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡',
        searchPlaceholder: 'à¸„à¹‰à¸™à¸«à¸²à¸•à¸²à¸¡à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™à¸«à¸£à¸·à¸­à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ...',
        all: 'à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
        saved: 'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§', 
        electronics: 'ğŸ”Œ à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ',
        fashion: 'ğŸ‘• à¹à¸Ÿà¸Šà¸±à¹ˆà¸™',
        dining: 'ğŸ½ï¸ à¸­à¸²à¸«à¸²à¸£',
        transport: 'ğŸš‡ à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡',
        nearby: 'ğŸ“ à¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡',
        home: 'à¸«à¸™à¹‰à¸²à¹à¸£à¸',
        map: 'à¹à¸œà¸™à¸—à¸µà¹ˆ',
        settings: 'à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²',
        languageChanged: 'à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ à¸²à¸©à¸²à¹à¸¥à¹‰à¸§',
        detailShow: 'à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”',
        backToList: 'à¸à¸¥à¸±à¸šà¹„à¸›à¸—à¸µà¹ˆà¸£à¸²à¸¢à¸à¸²à¸£',
        backButton: 'â† à¸à¸¥à¸±à¸š',
        closeDetail: 'à¸›à¸´à¸”à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”',
        copyCode: 'à¸„à¸±à¸”à¸¥à¸­à¸à¹‚à¸„à¹‰à¸”',
        copied: 'à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§',
        codeCopied: 'à¸ªà¸³à¹€à¸™à¸²à¹‚à¸„à¹‰à¸”à¸„à¸¹à¸›à¸­à¸‡à¹à¸¥à¹‰à¸§!',
        copyFailed: 'à¸à¸²à¸£à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¸à¸£à¸¸à¸“à¸²à¸„à¸±à¸”à¸¥à¸­à¸à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡',
        saveCoupon: 'à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸¹à¸›à¸­à¸‡',
        unsaveCoupon: 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸',
        savedCoupon: 'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§',
        unsavedCoupon: 'à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§',
        locationError: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹„à¸”à¹‰',
        locationObtained: 'à¹„à¸”à¹‰à¸£à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹à¸¥à¹‰à¸§',
        locationDenied: 'à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸–à¸¹à¸à¸›à¸à¸´à¹€à¸ªà¸˜',
        mapView: 'à¸”à¸¹à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆ',
        mapShown: 'à¹à¸ªà¸”à¸‡à¹à¸œà¸™à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§',
        mapViewTab: 'à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¹à¸œà¸™à¸—à¸µà¹ˆ',
        nearbySort: 'à¸ˆà¸±à¸”à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡',
        noExpiry: 'à¹„à¸¡à¹ˆà¸¡à¸µà¸§à¸±à¸™à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸',
        store: 'à¸£à¹‰à¸²à¸™',
        benefit: 'à¸œà¸¥à¸›à¸£à¸°à¹‚à¸¢à¸Šà¸™à¹Œ',
        expiry: 'à¸§à¸±à¸™à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸',
        notFound: 'à¹„à¸¡à¹ˆà¸à¸šà¸„à¸¹à¸›à¸­à¸‡',
        notFoundDesc: 'à¸¥à¸­à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸à¸“à¸‘à¹Œà¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²',
        suggestions: ['à¸Šà¸´à¸šà¸¹à¸¢à¹ˆà¸²', 'à¸Šà¸´à¸™à¸ˆà¸¹à¸à¸¸', 'à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œ'],
        codeSelected: 'à¹€à¸¥à¸·à¸­à¸à¹‚à¸„à¹‰à¸”à¹à¸¥à¹‰à¸§',
        whyThisStore: 'ğŸ’¬ à¸—à¸³à¹„à¸¡à¸£à¹‰à¸²à¸™à¸™à¸µà¹‰?',
        daysLeft: 'à¹€à¸«à¸¥à¸·à¸­ {days} à¸§à¸±à¸™',
        expiryWarning: 'à¹ƒà¸à¸¥à¹‰à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸',
        darkMode: 'à¹‚à¸«à¸¡à¸”à¸¡à¸·à¸”',
        lightMode: 'à¹‚à¸«à¸¡à¸”à¸ªà¸§à¹ˆà¸²à¸‡',
        filterChanged: 'à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸•à¸±à¸§à¸à¸£à¸­à¸‡à¹à¸¥à¹‰à¸§',
        cardFlipped: 'à¸à¸¥à¸´à¸à¸à¸²à¸£à¹Œà¸”à¹à¸¥à¹‰à¸§',
        cardClosed: 'à¸›à¸´à¸”à¸à¸²à¸£à¹Œà¸”à¹à¸¥à¹‰à¸§',
        flipCard: 'à¸à¸¥à¸´à¸à¸à¸²à¸£à¹Œà¸”',
        coupon: 'à¸„à¸¹à¸›à¸­à¸‡',
        focusRestored: 'à¸„à¸·à¸™à¸„à¹ˆà¸²à¹‚à¸Ÿà¸à¸±à¸ªà¹à¸¥à¹‰à¸§',
        termsLabel: 'à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™',
        terms: ['à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸­à¸·à¹ˆà¸™', 'à¸¢à¸à¹€à¸§à¹‰à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²à¸šà¸²à¸‡à¸£à¸²à¸¢à¸à¸²à¸£', 'à¸à¸£à¸¸à¸“à¸²à¹à¸ªà¸”à¸‡à¸à¹ˆà¸­à¸™à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™', 'à¸ˆà¸³à¸à¸±à¸” 1 à¸„à¸£à¸±à¹‰à¸‡à¸•à¹ˆà¸­à¸„à¸™'],
        openInGoogleMaps: 'à¹€à¸›à¸´à¸”à¹ƒà¸™ Google Maps',
        officialWebsite: 'à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£',
        viewSite: 'à¸”à¸¹',
        relatedArticle: 'à¸šà¸—à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡',
        readArticle: 'à¸­à¹ˆà¸²à¸™à¸šà¸—à¸„à¸§à¸²à¸¡',
        errorLoadingCoupons: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸¹à¸›à¸­à¸‡à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡',
        cacheCleared: 'à¸¥à¹‰à¸²à¸‡à¹à¸„à¸Šà¹à¸¥à¹‰à¸§',
        savedCouponsCleared: 'à¸¥à¸šà¸„à¸¹à¸›à¸­à¸‡à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹à¸¥à¹‰à¸§',
        confirmClearSaved: 'à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸šà¸„à¸¹à¸›à¸­à¸‡à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?',
        shareCoupon: 'à¹à¸Šà¸£à¹Œ',
        copySuccess: 'âœ… à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§ï¼',
        termsSummary: '{term} à¹€à¸›à¹‡à¸™à¸•à¹‰à¸™ <b>(à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸”à¹‰à¸²à¸™à¸«à¸¥à¸±à¸‡)</b>',
        sortChanged: 'à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¹à¸¥à¹‰à¸§',
        sortBy: 'à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡',
        category: 'à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ',
        latest: 'à¸¥à¹ˆà¸²à¸ªà¸¸à¸”',
        highDiscount: 'à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸ªà¸¹à¸‡à¸ªà¸¸à¸”',
        byArea: 'à¸•à¸²à¸¡à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ',
        sortFilter: 'à¹€à¸£à¸µà¸¢à¸‡Â·à¸à¸£à¸­à¸‡',
        region: 'à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ',
        filterOptions: 'à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¸à¸²à¸£à¸à¸£à¸­à¸‡',
        popularRecommend: 'à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡: {filter}',
        // à¸Šà¸·à¹ˆà¸­à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ
        tokyo: 'à¹‚à¸•à¹€à¸à¸µà¸¢à¸§',
        osaka: 'à¹‚à¸­à¸‹à¸²à¸à¹‰à¸²',
        fukuoka: 'à¸Ÿà¸¸à¸à¸¸à¹‚à¸­à¸à¸°',
        sapporo: 'à¸‹à¸±à¸›à¹‚à¸›à¹‚à¸£',
        okinawa: 'à¹‚à¸­à¸à¸´à¸™à¸²à¸§à¹ˆà¸²',
        others: 'à¸­à¸·à¹ˆà¸™à¹†'
      }
    };
    
    // ì•ˆì „í•œ ë²ˆì—­ í—¬í¼ í•¨ìˆ˜
    function t(key, vars = {}) {
      const lang = LanguageManager.currentLang;
      let str = T[lang]?.[key] || T.en?.[key] || key; // fallback chain
      
      Object.entries(vars).forEach(([k, v]) => {
        str = str.replace(new RegExp(`\\{${k}\\}`, 'g'), v);
      });
      
      return str;
    }

    // ===========================================
    // ì–¸ì–´ ê´€ë¦¬ì (ê°œì„ )
    // ===========================================
    const LanguageManager = {
      currentLang: 'en',
      supportedLangs: ['zh', 'zh-TW', 'ko', 'en', 'th'],
      
      init() {
        this.currentLang = this.detectLanguage();
        this.initToggle();
        this.updatePageLanguage();
      },

      detectLanguage() {
        // 1. URL íŒŒë¼ë¯¸í„° í™•ì¸
        const urlLang = Utils.getUrlParam('lang');
        if (urlLang && this.supportedLangs.includes(urlLang)) {
          return urlLang;
        }

        // 2. localStorage í™•ì¸
        const savedLang = localStorage.getItem('preferredLang');
        if (savedLang && this.supportedLangs.includes(savedLang)) {
          return savedLang;
        }

        // 3. ë¸Œë¼ìš°ì € ì–¸ì–´ í™•ì¸
        const browserLang = navigator.language.slice(0, 2);
        if (this.supportedLangs.includes(browserLang)) {
          return browserLang;
        }

        if (navigator.language.toLowerCase().includes('zh-tw') || 
            navigator.language.toLowerCase().includes('zh-hk')) {
          return 'zh-TW';
        }

        return 'en';
      },

      // í†µí•©ëœ ì–¸ì–´ í† ê¸€ ì´ˆê¸°í™” (í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜ í¬í•¨)
      initToggle() {
        const langBtn = DOMCache.get('langBtn');
        const langMenu = DOMCache.get('langMenu');
        
        if (!langBtn || !langMenu) return;

        // ì–¸ì–´ ë²„íŠ¼ í´ë¦­
        langBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleMenu();
        });

        // í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜
        langBtn.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.openMenu();
          }
        });

        // ë©”ë‰´ í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜
        langMenu.addEventListener('keydown', (e) => {
          this.handleMenuKeyboard(e);
        });

        // ë©”ë‰´ í´ë¦­ (ì´ë²¤íŠ¸ ìœ„ì„)
        langMenu.addEventListener('click', (e) => {
          const button = e.target.closest('button[role="menuitem"]');
          if (button) {
            const lang = button.dataset.lang;
            this.setLanguage(lang);
            this.closeMenu();
          }
        });

        // ì™¸ë¶€ í´ë¦­ì‹œ ë©”ë‰´ ë‹«ê¸°
        document.addEventListener('click', () => {
          this.closeMenu();
        });

        // Escape í‚¤ë¡œ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && langMenu.classList.contains('show')) {
            this.closeMenu();
            langBtn.focus();
          }
        });

        // ì´ˆê¸° í™œì„± ë²„íŠ¼ ì„¤ì •
        this.updateActiveMenuItem();
      },

      toggleMenu() {
        const langMenu = DOMCache.get('langMenu');
        if (langMenu.classList.contains('show')) {
          this.closeMenu();
        } else {
          this.openMenu();
        }
      },

      openMenu() {
        const langBtn = DOMCache.get('langBtn');
        const langMenu = DOMCache.get('langMenu');
        
        langMenu.classList.add('show');
        langBtn.setAttribute('aria-expanded', 'true');
        
        // í˜„ì¬ ì–¸ì–´ í•­ëª©ì— í¬ì»¤ìŠ¤
        const activeItem = langMenu.querySelector('[aria-selected="true"]');
        if (activeItem) {
          activeItem.focus();
        }
      },

      closeMenu() {
        const langBtn = DOMCache.get('langBtn');
        const langMenu = DOMCache.get('langMenu');
        
        langMenu.classList.remove('show');
        langBtn.setAttribute('aria-expanded', 'false');
      },

      handleMenuKeyboard(e) {
        const langMenu = DOMCache.get('langMenu');
        const items = Array.from(langMenu.querySelectorAll('button[role="menuitem"]'));
        const currentIndex = items.findIndex(item => item === document.activeElement);

        switch(e.key) {
          case 'ArrowDown':
            e.preventDefault();
            const nextIndex = (currentIndex + 1) % items.length;
            items[nextIndex].focus();
            break;
            
          case 'ArrowUp':
            e.preventDefault();
            const prevIndex = currentIndex <= 0 ? items.length - 1 : currentIndex - 1;
            items[prevIndex].focus();
            break;
            
          case 'Home':
            e.preventDefault();
            items[0].focus();
            break;
            
          case 'End':
            e.preventDefault();
            items[items.length - 1].focus();
            break;
            
          case 'Enter':
          case ' ':
            e.preventDefault();
            document.activeElement.click();
            break;
        }
      },

      setLanguage(lang) {
        if (!this.supportedLangs.includes(lang)) return;
        
        this.currentLang = lang;
        localStorage.setItem('preferredLang', lang);
        Utils.updateUrlParam('lang', lang);
        
        this.updatePageLanguage();
        this.updateActiveMenuItem();
        
        // ì¿ í° ë¦¬ìŠ¤íŠ¸ ì¬ë Œë”ë§
        if (window.app) {
          window.app.render();
          window.app.updateFilterTexts(); // í•„í„° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        }
        
        Toast.show(T[lang].languageChanged || 'ì–¸ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
      },

      updateActiveMenuItem() {
        const langMenu = DOMCache.get('langMenu');
        const langBtn = DOMCache.get('langBtn');
        
        // ë©”ë‰´ ì•„ì´í…œ ì—…ë°ì´íŠ¸
        langMenu.querySelectorAll('button[role="menuitem"]').forEach(btn => {
          const isActive = btn.dataset.lang === this.currentLang;
          btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const langNames = {zh:'ç®€ä½“ä¸­æ–‡','zh-TW':'ç¹é«”ä¸­æ–‡',ko:'í•œêµ­ì–´',en:'English',th:'à¸ à¸²à¸©à¸²à¹„à¸—à¸¢'};
        const langFlags = {zh:'ğŸ‡¨ğŸ‡³','zh-TW':'ğŸ‡¹ğŸ‡¼',ko:'ğŸ‡°ğŸ‡·',en:'ğŸ‡ºğŸ‡¸',th:'ğŸ‡¹ğŸ‡­'};
        
        langBtn.querySelector('.lang-name').textContent = langNames[this.currentLang];
        langBtn.querySelector('.lang-flag').textContent = langFlags[this.currentLang];
      },

      updatePageLanguage() {
        // HTML lang ì†ì„± ì—…ë°ì´íŠ¸
        document.documentElement.lang = this.currentLang;
        
        // Bodyì— ì–¸ì–´ë³„ í´ë˜ìŠ¤ ì¶”ê°€
        document.body.className = document.body.className.replace(/lang-\w+/g, '');
        document.body.classList.add(`lang-${this.currentLang}`);
        
        // í˜ì´ì§€ ì œëª©
        document.title = T[this.currentLang].pageTitle || 'Japankuru ã‚¯ãƒ¼ãƒãƒ³ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ';
        
        // ë„¤ë¹„ê²Œì´ì…˜ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        this.updateNavigation();
        
        // ê¸°íƒ€ UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        this.updateStaticTexts();
      },

      updateNavigation() {
        const navItems = DOMCache.get('navContainer').querySelectorAll('.nav-item');
        const navLabels = ['home', 'saved', 'map', 'settings'];
        
        navItems.forEach((item, index) => {
          const textEl = item.querySelector('.nav-text');
          if (textEl && navLabels[index]) {
            textEl.textContent = T[this.currentLang][navLabels[index]] || '';
          }
        });
      },

      updateStaticTexts() {
        // ê²€ìƒ‰ placeholder
        const searchInput = DOMCache.get('searchInput');
        if (searchInput) {
          searchInput.placeholder = T[this.currentLang].searchPlaceholder || 'åº—åãƒ»ã‚¨ãƒªã‚¢ã§æ¤œç´¢...';
        }

        // íˆì–´ë¡œ ì„¹ì…˜
        const heroTitle = document.querySelector('.hero-section h1');
        const heroDesc = document.querySelector('.hero-section p');
        const ctaBtn = document.querySelector('.cta-button');
        
        if (heroTitle) heroTitle.textContent = T[this.currentLang].heroTitle;
        if (heroDesc) heroDesc.textContent = T[this.currentLang].heroDesc;
        if (ctaBtn) ctaBtn.textContent = T[this.currentLang].ctaButton;
        
        // í•„í„° íŒ¨ë„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const filterPanelTitle = document.getElementById('filterPanelTitle');
        if (filterPanelTitle) {
          filterPanelTitle.textContent = T[this.currentLang].filterOptions || 'Filter Options';
        }
        
        // ëª¨ë“  data-i18n ìš”ì†Œ ì—…ë°ì´íŠ¸
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (T[this.currentLang][key]) {
            el.textContent = T[this.currentLang][key];
          }
        });
      }
    };

    // ì¿ í° í•„ë“œ ë‹¤êµ­ì–´ í—¬í¼ í•¨ìˆ˜
    function getCouponField(coupon, field, fallback = '') {
      const langField = `${field}_${LanguageManager.currentLang.replace('-', '_')}`;
      const enField = `${field}_en`;
      
      // ê° í•„ë“œ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œ íƒ€ì… ì²´í¬
      const getValue = (key) => {
        const val = coupon[key];
        return (typeof val === 'string' || typeof val === 'number') ? String(val) : null;
      };
      
      return getValue(langField) || getValue(enField) || getValue(field) || fallback;
    }

    // ===========================================
    // ì¿ í° ë°ì´í„° ë¡œë”
    // ===========================================
    class CouponLoader {
      constructor(config = {}) {
        this.config = {
          retryAttempts: 3,
          retryDelay: 1000,
          timeout: 10000,
          ...config
        };
      }

      async loadFromAPI() {
        try {
          // WordPress API ì—”ë“œí¬ì¸íŠ¸ ê²°ì •
          let apiUrl;
          
          if (window.wpApiSettings && window.wpApiSettings.root) {
            apiUrl = `${window.wpApiSettings.root}jkwallet/v1/coupons`;
          } else if (window.location.pathname.includes('/wp-admin/') || 
                     window.location.pathname.includes('/wp-content/')) {
            const baseUrl = window.location.origin;
            apiUrl = `${baseUrl}/wp-json/jkwallet/v1/coupons`;
          } else {
            apiUrl = './wp-json/jkwallet/v1/coupons';
          }

          console.log('API ìš”ì²­:', apiUrl);
          
          const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              ...(window.wpApiSettings?.nonce && {
                'X-WP-Nonce': window.wpApiSettings.nonce
              })
            }
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status} ${response.statusText}`);
          }

          const data = await response.json();
          
          if (!Array.isArray(data) || data.length === 0) {
            throw new Error('Invalid API response format');
          }

          this.cacheData(data);
          console.log(`âœ… APIì—ì„œ ${data.length}ê°œ ì¿ í° ë¡œë“œ ì„±ê³µ`);
          
          return data;

        } catch (error) {
          console.warn('ğŸ”„ API ë¡œë“œ ì‹¤íŒ¨, ìºì‹œ/í´ë°± ë°ì´í„° ì‹œë„:', error.message);
          
          // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ì•Œë¦¼
          Toast.show(T[LanguageManager.currentLang].errorLoadingCoupons || 'ã‚¯ãƒ¼ãƒãƒ³æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 3000);
          
          const cached = this.getCachedData();
          if (cached) {
            console.log('ğŸ“¦ ìºì‹œëœ ë°ì´í„° ì‚¬ìš©');
            return cached;
          }
          
          console.log('âš ï¸  í•˜ë“œì½”ë”© ë°ì´í„° ì‚¬ìš©');
          return this.getFallbackData();
        }
      }

      getCachedData() {
        try {
          const cached = localStorage.getItem('cachedCoupons');
          const cacheTime = localStorage.getItem('cacheTime');
          
          if (cached && cacheTime) {
            const age = Date.now() - parseInt(cacheTime);
            const maxAge = 24 * 60 * 60 * 1000; // 24ì‹œê°„
            
            if (age < maxAge) {
              return JSON.parse(cached);
            } else {
              localStorage.removeItem('cachedCoupons');
              localStorage.removeItem('cacheTime');
            }
          }
        } catch (e) {
          console.error('ìºì‹œ ë¡œë“œ ì‹¤íŒ¨:', e);
        }
        return null;
      }

      cacheData(data) {
        try {
          localStorage.setItem('cachedCoupons', JSON.stringify(data));
          localStorage.setItem('cacheTime', Date.now().toString());
          console.log('ğŸ’¿ ë°ì´í„° ìºì‹œ ì €ì¥ ì™„ë£Œ');
        } catch (e) {
          console.warn('ìºì‹œ ì €ì¥ ì‹¤íŒ¨:', e);
        }
      }

      getFallbackData() {
        return [
          { 
            id: 1, 
            region: ['tokyo'], // ì§€ì—­ í•„ë“œ ì¶”ê°€
            store_zh: 'å°å²› x Bic Camera',
            store_zh_TW: 'å°å³¶ x Bic Camera',
            store_ko: 'ì½”ì§€ë§ˆ x ë¹…ì¹´ë©”ë¼',
            store_en: 'Kojima x BicCamera',
            store_th: 'à¹‚à¸„à¸ˆà¸´à¸¡à¸° x à¸šà¸´à¸à¸„à¸²à¹€à¸¡à¸£à¹ˆà¸²',
            offer_ja: 'æœ€å¤§ 17% OFF', 
            offer_ko: 'ìµœëŒ€ 17% í• ì¸',
            offer_en: 'Up to 17% OFF',
            offer_th: 'à¸¥à¸”à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 17%',
            description_ja: 'å…ç¨10% + è¿½åŠ 7%å‰²å¼•ï¼æœ€æ–°ã®é›»å­è£½å“ã‚’å®‰ãã€‚',
            description_ko: 'ë©´ì„¸ 10% + ì¶”ê°€ 7% í• ì¸! ìµœì‹  ì „ìì œí’ˆì„ ì €ë ´í•˜ê²Œ.',
            description_en: 'Tax-free 10% + Additional 7% discount! Latest electronics at great prices.',
            description_th: 'à¸›à¸¥à¸­à¸”à¸ à¸²à¸©à¸µ 10% + à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¹€à¸à¸´à¹ˆà¸¡ 7%! à¸­à¸´à¹€à¸¥à¹‡à¸à¸—à¸£à¸­à¸™à¸´à¸à¸ªà¹Œà¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¹ƒà¸™à¸£à¸²à¸„à¸²à¸”à¸µ',
            category: 'electronics', 
            expiry: '2025-12-31', 
            image: 'https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg',
            code: 'JK-BIC2025', 
            lat: 35.6909, 
            lng: 139.7003, 
            rating: 4.2,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.biccamera.com/',
            article_url: 'https://www.japankuru.com/jp/e1878.html',
            area_ko: 'ì•„í‚¤í•˜ë°”ë¼',
            area_en: 'Akihabara',
            area_zh: 'ç§‹å¶åŸ',
            area_zh_TW: 'ç§‹è‘‰åŸ',
            area_th: 'à¸­à¸²à¸à¸´à¸®à¸²à¸šà¸²à¸£à¸°'
          },
          { 
            id: 2, 
            region: ['tokyo', 'osaka'], // ë³µìˆ˜ ì§€ì—­
            store_zh: 'JINS',
            store_zh_TW: 'JINS',
            store_ko: 'ì§„ìŠ¤',
            store_en: 'JINS',
            store_th: 'à¸ˆà¸´à¸™à¸ªà¹Œ',
            offer_ja: '10% OFF', 
            offer_ko: '10% í• ì¸',
            offer_en: '10% OFF',
            offer_th: 'à¸¥à¸” 10%',
            description_ja: 'å…ç¨+å‰²å¼•ã®ãƒ¡ã‚¬ãƒã€‚',
            description_ko: 'ë©´ì„¸+í• ì¸ ì•ˆê²½.',
            description_en: 'Tax-free + discount glasses.',
            description_th: 'à¹à¸§à¹ˆà¸™à¸•à¸²à¸›à¸¥à¸­à¸”à¸ à¸²à¸©à¸µ+à¸¥à¸”à¸£à¸²à¸„à¸²',
            category: 'fashion', 
            expiry: '2025-02-05', 
            image: 'https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg',
            code: 'JK-JINS2025', 
            lat: 35.6581, 
            lng: 139.6986, 
            rating: 4.1,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.jins.com/jp/',
            article_url: 'https://www.japankuru.com/en/e2290.html',
            area_ko: 'ì‹œë¶€ì•¼',
            area_en: 'Shibuya',
            area_zh: 'æ¶©è°·',
            area_zh_TW: 'æ¾€è°·',
            area_th: 'à¸Šà¸´à¸šà¸¹à¸¢à¹ˆà¸²'
          },
          { 
            id: 3, 
            region: ['tokyo'],
            store_zh: 'BEAMS JAPAN',
            store_zh_TW: 'BEAMS JAPAN',
            store_ko: 'BEAMS JAPAN',
            store_en: 'BEAMS JAPAN',
            store_th: 'à¸šà¸µà¸¡à¸ªà¹Œ à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',
            offer_ja: '5% è¿½åŠ å‰²å¼•', 
            offer_ko: '5% ì¶”ê°€ í• ì¸',
            offer_en: '5% Additional Discount',
            offer_th: 'à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¹€à¸à¸´à¹ˆà¸¡ 5%',
            description_ja: 'ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç™ºä¿¡ã™ã‚‹ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—ã€‚',
            description_ko: 'íŠ¸ë Œë“œë¥¼ ì„ ë„í•˜ëŠ” ì…€ë ‰íŠ¸ìƒµ.',
            description_en: 'Trend-setting select shop.',
            description_th: 'à¸£à¹‰à¸²à¸™à¹€à¸‹à¹€à¸¥à¸à¸•à¹Œà¸—à¸µà¹ˆà¸™à¸³à¹€à¸—à¸£à¸™à¸”à¹Œ',
            category: 'fashion', 
            expiry: '2025-09-30', 
            image: 'https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg',
            code: 'JK-BEAMS25', 
            lat: 35.6702, 
            lng: 139.7073, 
            rating: 4.3,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.beams.co.jp/beamsjapan/',
            article_url: 'https://www.japankuru.com/jp/e2303.html',
            area_ko: 'ì‹ ì£¼ì¿ ',
            area_en: 'Shinjuku',
            area_zh: 'æ–°å®¿',
            area_zh_TW: 'æ–°å®¿',
            area_th: 'à¸Šà¸´à¸™à¸ˆà¸¹à¸à¸¸'
          },
          { 
            id: 4, 
            region: ['tokyo'],
            store_zh: 'æ­¦å£«é¤å…',
            store_zh_TW: 'æ­¦å£«é¤å»³',
            store_ko: 'ì‚¬ë¬´ë¼ì´ ë ˆìŠ¤í† ë‘',
            store_en: 'Samurai Restaurant',
            store_th: 'à¸£à¹‰à¸²à¸™à¸­à¸²à¸«à¸²à¸£à¸‹à¸²à¸¡à¸¹à¹„à¸£',
            offer_ja: 'ãƒ‰ãƒªãƒ³ã‚¯1æ¯ç„¡æ–™', 
            offer_ko: 'ìŒë£Œ 1ì” ë¬´ë£Œ',
            offer_en: '1 Free Drink',
            offer_th: 'à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡à¸Ÿà¸£à¸µ 1 à¹à¸à¹‰à¸§',
            description_ja: 'è¯éº—ãªã‚·ãƒ§ãƒ¼ã¨é£Ÿäº‹ã€‚',
            description_ko: 'í™”ë ¤í•œ ì‡¼ì™€ ì‹ì‚¬.',
            description_en: 'Spectacular show and dining.',
            description_th: 'à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸­à¸¥à¸±à¸‡à¸à¸²à¸£à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£',
            recommendation_ja: 'Japankuruãƒ¬ãƒ“ãƒ¥ãƒ¼4.5ç‚¹ã€æ—…è¡Œè€…ã«ã€Œä¸€åº¦ã¯ä½“é¨“ã™ã¹ãã€ã¨äººæ°—æ€¥ä¸Šæ˜‡ï¼',
            recommendation_ko: 'Japankuru ë¦¬ë·° 4.5ì , ì—¬í–‰ìë“¤ì—ê²Œ "í•œ ë²ˆì€ ê²½í—˜í•´ë´ì•¼ í• " ê³³ìœ¼ë¡œ ì¸ê¸° ê¸‰ìƒìŠ¹!',
            recommendation_en: 'Japankuru review 4.5 stars, rapidly gaining popularity among travelers as a "must-experience" destination!',
            recommendation_th: 'Japankuru à¸£à¸µà¸§à¸´à¸§ 4.5 à¸”à¸²à¸§ à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸§à¸²à¸¡à¸™à¸´à¸¢à¸¡à¸­à¸¢à¹ˆà¸²à¸‡à¸£à¸§à¸”à¹€à¸£à¹‡à¸§à¸ˆà¸²à¸à¸™à¸±à¸à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§à¹ƒà¸™à¸à¸²à¸™à¸°à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ "à¸•à¹‰à¸­à¸‡à¸¥à¸­à¸‡"!',
            category: 'dining', 
            expiry: '2026-03-31', 
            image: 'https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg',
            code: 'JK-SAMURAI', 
            lat: 35.6947, 
            lng: 139.7006, 
            rating: 4.5,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.samurai-restaurant.com/',
            article_url: 'https://www.japankuru.com/jp/e2290.html',
            area_ko: 'ì‹ ì£¼ì¿ ',
            area_en: 'Shinjuku',
            area_zh: 'æ–°å®¿',
            area_zh_TW: 'æ–°å®¿',
            area_th: 'à¸Šà¸´à¸™à¸ˆà¸¹à¸à¸¸'
          },
          { 
            id: 5, 
            region: ['tokyo'],
            store_zh: 'ä¸œæ€¥çº¿',
            store_zh_TW: 'æ±æ€¥ç·š',
            store_ko: 'ë„íì„ ',
            store_en: 'Tokyu Line',
            store_th: 'à¹‚à¸•à¹€à¸à¹‡à¸¢à¸§ à¹„à¸¥à¸™à¹Œ',
            offer_ja: '1æ—¥ä¹—è»Šåˆ¸', 
            offer_ko: '1ì¼ ìŠ¹ì°¨ê¶Œ',
            offer_en: '1-Day Pass',
            offer_th: 'à¸šà¸±à¸•à¸£à¹‚à¸”à¸¢à¸ªà¸²à¸£ 1 à¸§à¸±à¸™',
            description_ja: 'æ±äº¬æ—…è¡Œã®å¿…é ˆã‚¢ã‚¤ãƒ†ãƒ ã€‚',
            description_ko: 'ë„ì¿„ ì—¬í–‰ì˜ í•„ìˆ˜ ì•„ì´í…œ.',
            description_en: 'Essential item for Tokyo travel.',
            description_th: 'à¸ªà¸´à¹ˆà¸‡à¸ˆà¸³à¹€à¸›à¹‡à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¹‚à¸•à¹€à¸à¸µà¸¢à¸§',
            category: 'transport', 
            expiry: '9999-12-31', 
            image: 'https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png',
            code: 'JK-TOKYU', 
            lat: 35.6580, 
            lng: 139.7016, 
            rating: 4.0,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.tokyu.co.jp/',
            area_ko: 'ì‹œë¶€ì•¼',
            area_en: 'Shibuya',
            area_zh: 'æ¶©è°·',
            area_zh_TW: 'æ¾€è°·',
            area_th: 'à¸Šà¸´à¸šà¸¹à¸¢à¹ˆà¸²'
          },
          { 
            id: 6, 
            region: ['osaka', 'fukuoka'],
            store_zh: 'å‹éƒ½å…«å–œ',
            store_zh_TW: 'å‹éƒ½å…«å–œ',
            store_ko: 'ìš”ë„ë°”ì‹œì¹´ë©”ë¼',
            store_en: 'Yodobashi Camera',
            store_th: 'à¹‚à¸¢à¹‚à¸”à¸šà¸²à¸Šà¸´à¸„à¸²à¹€à¸¡à¸£à¹ˆà¸²',
            offer_ja: 'æœ€å¤§ 15% OFF', 
            offer_ko: 'ìµœëŒ€ 15% í• ì¸',
            offer_en: 'Up to 15% OFF',
            offer_th: 'à¸¥à¸”à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 15%',
            description_ja: 'å…ç¨10% + VISAã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã§5%è¿½åŠ å‰²å¼•ï¼',
            description_ko: 'ë©´ì„¸ 10% + VISA ì¹´ë“œ ê²°ì œ ì‹œ 5% ì¶”ê°€ í• ì¸!',
            description_en: 'Tax-free 10% + Additional 5% discount with VISA card payment!',
            description_th: 'à¸›à¸¥à¸­à¸”à¸ à¸²à¸©à¸µ 10% + à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¹€à¸à¸´à¹ˆà¸¡ 5% à¹€à¸¡à¸·à¹ˆà¸­à¸Šà¸³à¸£à¸°à¸”à¹‰à¸§à¸¢à¸šà¸±à¸•à¸£ VISA!',
            category: 'electronics', 
            expiry: '2025-11-30', 
            image: 'https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png',
            code: 'JK-Yodobashi', 
            lat: 35.6938, 
            lng: 139.7706, 
            rating: 4.4,
            terms: ['ä»–ã®å‰²å¼•ã¨ã®ä½µç”¨ä¸å¯', 'ä¸€éƒ¨å•†å“ã‚’é™¤ã', 'ãŠä¼šè¨ˆå‰ã«ã”æç¤ºãã ã•ã„', 'ãŠä¸€äººæ§˜1å›é™ã‚Š'],
            official_url: 'https://www.yodobashi.com/',
            area_ko: 'ì•„í‚¤í•˜ë°”ë¼',
            area_en: 'Akihabara',
            area_zh: 'ç§‹å¶åŸ',
            area_zh_TW: 'ç§‹è‘‰åŸ',
            area_th: 'à¸­à¸²à¸à¸´à¸®à¸²à¸šà¸²à¸£à¸°'
          }
        ];
      }
    }

    // ===========================================
    // í† ìŠ¤íŠ¸ ê´€ë¦¬ì (ê°œì„ )
    // ===========================================
    const Toast = {
      el: null,
      timeout: null,
      queue: [],
      
      init() {
        this.el = DOMCache.get('toast');
      },
      
      show(msg, duration = 2000) {
        // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì·¨ì†Œ
        if (this.timeout) {
          clearTimeout(this.timeout);
          this.el.classList.remove('show');
        }
        
        // ìƒˆ ë©”ì‹œì§€ í‘œì‹œ
        this.el.textContent = msg;
        this.el.classList.add('show');
        
        this.timeout = setTimeout(() => {
          this.el.classList.remove('show');
          this.timeout = null;
        }, duration);
      }
    };

    // ===========================================
    // ì €ì¥ì†Œ ê´€ë¦¬ì
    // ===========================================
    const StorageManager = {
      getSaved() {
        try {
          const saved = localStorage.getItem('savedCoupons');
          return saved ? JSON.parse(saved) : [];
        } catch (e) {
          console.error('ì €ì¥ëœ ì¿ í° ë¡œë“œ ì‹¤íŒ¨:', e);
          return [];
        }
      },
      
      setSaved(data) {
        try {
          localStorage.setItem('savedCoupons', JSON.stringify(data));
        } catch (e) {
          console.error('ì¿ í° ì €ì¥ ì‹¤íŒ¨:', e);
          Toast.show(T[LanguageManager.currentLang].copyFailed || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 3000);
        }
      },
      
      getTheme() {
        return localStorage.getItem('darkMode') === 'true';
      },
      
      setTheme(isDark) {
        localStorage.setItem('darkMode', isDark.toString());
      }
    };

    // ===========================================
    // ìœ„ì¹˜ ê´€ë¦¬ì
    // ===========================================
    const Location = {
      async request() {
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            Toast.show('ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 2000);
            reject(new Error('Geolocation not supported'));
            return;
          }
          
          navigator.geolocation.getCurrentPosition(
            pos => {
              const location = { 
                lat: pos.coords.latitude, 
                lng: pos.coords.longitude 
              };
              Toast.show(T[LanguageManager.currentLang].locationObtained || 'ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¾ã—ãŸ', 1000);
              resolve(location);
            },
            err => {
              Toast.show(T[LanguageManager.currentLang].locationDenied || 'ä½ç½®æƒ…å ±ã®å–å¾—ã‚’æ‹’å¦ã•ã‚Œã¾ã—ãŸ', 2000);
              reject(err);
            },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        });
      },
      
      showError() {
        const errorEl = DOMCache.get('locationError');
        if (errorEl) {
          const lang = LanguageManager.currentLang;
          const strongEl = document.createElement('strong');
          strongEl.textContent = T[lang].locationError || 'ç¾åœ¨åœ°ã‚’ä½¿ç”¨ã§ãã¾ã›ã‚“';
          
          const pEl = document.createElement('p');
          pEl.textContent = 'ä½ç½®æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§è¨±å¯ã—ã¦ãã ã•ã„ã€‚';
          
          errorEl.innerHTML = '';
          errorEl.appendChild(strongEl);
          errorEl.appendChild(pEl);
          errorEl.classList.add('show');
        }
      },
      
      hideError() {
        const errorEl = DOMCache.get('locationError');
        if (errorEl) {
          errorEl.classList.remove('show');
        }
      }
    };

    // ===========================================
    // ì§€ë„ ê´€ë¦¬ì (ì¬ì‹œë„ ë¡œì§ ì¶”ê°€)
    // ===========================================
    const MapManager = {
      mapInstance: null,
      markerGroup: null, 
      leafletLoaded: false,
      initialized: false,
      initPromise: null,
      retryCount: 0,
      maxRetries: 3,
      
      showMap() {
        const mapEl = DOMCache.get('map');
        if (mapEl) {
          mapEl.classList.add('show');
        }
      },
      
      hideMap() {
        const mapEl = DOMCache.get('map');
        if (mapEl) {
          mapEl.classList.remove('show');
        }
      },
      
      async init() {
        if (this.initPromise) {
          return this.initPromise;
        }
        
        if (this.initialized) {
          this.showMap();
          return Promise.resolve();
        }
        
        this.initPromise = this._doInit();
        return this.initPromise;
      },
      
      async _doInit() {
        try {
          this.showMap();
          
          if (!window.L && !this.leafletLoaded) {
            await this.loadLeaflet();
          }
          
          if (!this.mapInstance) {
            const center = window.app?.state.userLocation ? 
              [window.app.state.userLocation.lat, window.app.state.userLocation.lng] : 
              [35.6804, 139.7690];
            
            this.mapInstance = window.mapInstance = L.map('map', { 
              zoomControl: true 
            }).setView(center, 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 19,
              attribution: '&copy; OSM'
            }).addTo(this.mapInstance);
            
            this.hideError();
            this.initialized = true;
            this.retryCount = 0; // ì„±ê³µì‹œ ë¦¬ì…‹
          }
          
          this.renderMarkers();
        } catch (e) {
          this.showError();
          throw e;
        } finally {
          this.initPromise = null;
        }
      },
      
      async loadLeaflet() {
        let attempts = 0;
        
        while (attempts < this.maxRetries) {
          try {
            await this._loadLeafletResources();
            this.leafletLoaded = true;
            this.retryCount = 0; // ì„±ê³µ ì‹œ ë¦¬ì…‹
            return;
          } catch (error) {
            attempts++;
            this.retryCount = attempts;
            
            if (attempts < this.maxRetries) {
              const delay = Math.pow(2, attempts) * 1000;
              Toast.show(
                t('mapRetrying', {current: attempts, max: this.maxRetries}),
                2000
              );
              await new Promise(resolve => setTimeout(resolve, delay));
            }
          }
        }
        
        // ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨
        Toast.show(T[LanguageManager.currentLang].mapLoadFailed || 'Failed to load map', 3000);
        throw new Error('Failed to load Leaflet after all retries');
      },

      async _loadLeafletResources() {
        // CSS ë¡œë“œ
        const css = document.createElement('link');
        css.rel = 'stylesheet';
        css.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
        
        const cssLoaded = new Promise((resolve, reject) => {
          css.onload = resolve;
          css.onerror = reject;
        });
        
        document.head.appendChild(css);
        
        // JS ë¡œë“œ
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
        
        const scriptLoaded = new Promise((resolve, reject) => {
          script.onload = resolve;
          script.onerror = reject;
        });
        
        document.body.appendChild(script);
        
        // ë‘ ë¦¬ì†ŒìŠ¤ ëª¨ë‘ ë¡œë“œ ëŒ€ê¸°
        await Promise.all([cssLoaded, scriptLoaded]);
      },
      
      renderMarkers() {
        if (!this.mapInstance || !this.initialized || !window.app) return;
        
        if (this.markerGroup) {
          this.markerGroup.clearLayers();
        } else {
          this.markerGroup = L.layerGroup().addTo(this.mapInstance);
        }
        
        // ì‚¬ìš©ì ìœ„ì¹˜ í‘œì‹œ
        if (window.app.state.userLocation) {
          L.circleMarker([window.app.state.userLocation.lat, window.app.state.userLocation.lng], {
            radius: 8, 
            fillColor: '#2563eb', 
            color: '#fff', 
            weight: 2, 
            fillOpacity: 1
          }).addTo(this.markerGroup).bindPopup('ç¾åœ¨åœ°');
        }
        
        // ì¿ í° ë§ˆì»¤
        window.app.state.coupons.forEach(c => {
          if (c.lat != null && c.lng != null) {
            const marker = L.marker([c.lat, c.lng]);
            const store = getCouponField(c, 'store');
            const offer = getCouponField(c, 'offer');
            
            let popup = `<strong>${Utils.escapeHtml(store)}</strong><br>${Utils.escapeHtml(offer)}<br>`;
            popup += c.expiry === '9999-12-31' ? 
              (T[LanguageManager.currentLang].noExpiry || 'æœŸé™ãªã—') : 
              c.expiry.replace(/-/g,'/');
            
            if (window.app.state.userLocation) {
              const d = Utils.distance(window.app.state.userLocation.lat, window.app.state.userLocation.lng, c.lat, c.lng);
              popup += `<br>${d < 1 ? Math.round(d * 1000) + 'm' : d.toFixed(1) + 'km'}`;
            }
            
            marker.bindPopup(popup);
            marker.on('click', () => {
              const card = document.querySelector(`[data-id="${c.id}"]`);
              if (card) { 
                card.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                card.focus(); 
              }
            });
            marker.addTo(this.markerGroup);
          }
        });
      },
      
      centerTo(loc) {
        if (this.mapInstance && loc && loc.lat && loc.lng) {
          this.mapInstance.setView([loc.lat, loc.lng], 13);
        }
      },
      
      updateLocation() {
        this.renderMarkers();
        if (window.app?.state.userLocation) {
          this.centerTo(window.app.state.userLocation);
        }
      },
      
      showError() {
        const errorEl = DOMCache.get('mapError');
        if (errorEl) {
          errorEl.style.display = 'block';
        }
      },
      
      hideError() {
        const errorEl = DOMCache.get('mapError');
        if (errorEl) {
          errorEl.style.display = 'none';
        }
      }
    };

    // ===========================================
    // ì´ë¯¸ì§€ ë ˆì´ì§€ ë¡œë” (IntersectionObserver)
    // ===========================================
    const ImageLazyLoader = {
      observer: null,
      
      init() {
        this.observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.classList.add('loaded');
                this.observer.unobserve(img);
              }
            }
          });
        }, {
          rootMargin: '50px 0px',
          threshold: 0.01
        });
      },
      
      observe(img) {
        if (this.observer) {
          this.observer.observe(img);
        }
      },
      
      disconnect() {
        if (this.observer) {
          this.observer.disconnect();
        }
      }
    };

    // ===========================================
    // í¬ì»¤ìŠ¤ ë§¤ë‹ˆì € (ì ‘ê·¼ì„±)
    // ===========================================
    const FocusManager = {
      lastFocusedElement: null,
      
      saveFocus() {
        this.lastFocusedElement = document.activeElement;
      },
      
      restoreFocus() {
        if (this.lastFocusedElement && this.lastFocusedElement.focus) {
          this.lastFocusedElement.focus();
          
          // ìŠ¤í¬ë¦°ë¦¬ë” ì•Œë¦¼
          const srAnnouncement = DOMCache.get('srAnnouncement');
          if (srAnnouncement) {
            srAnnouncement.textContent = T[LanguageManager.currentLang].focusRestored || 'ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¾©å…ƒã—ã¾ã—ãŸ';
          }
        }
      },
      
      trapFocus(container) {
        const focusableElements = container.querySelectorAll(
          'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
        );
        
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];
        
        if (firstFocusable) {
          firstFocusable.focus();
        }
        
        container.addEventListener('keydown', (e) => {
          if (e.key === 'Tab') {
            if (e.shiftKey) {
              if (document.activeElement === firstFocusable) {
                e.preventDefault();
                lastFocusable.focus();
              }
            } else {
              if (document.activeElement === lastFocusable) {
                e.preventDefault();
                firstFocusable.focus();
              }
            }
          }
        });
      }
    };

    // ===========================================
    // ëª¨ë°”ì¼ UI ê´€ë¦¬ì (ìŠ¤ë§ˆíŠ¸ ê°œì„ )
    // ===========================================
    const MobileUIManager = {
      isMobile: window.innerWidth <= 768,
      
      init() {
        this.setupFilterPanel();
        this.setupDetailSheet();
        this.setupFloatingSuggestion();
        this.handleResize();
        
        window.addEventListener('resize', Utils.debounce(() => {
          this.handleResize();
        }, 250));
      },
      
      handleResize() {
        const wasMobile = this.isMobile;
        this.isMobile = window.innerWidth <= 768;
        
        if (wasMobile !== this.isMobile) {
          this.updateUI();
        }
      },
      
      updateUI() {
        const floatSuggest = DOMCache.get('floatSuggest');
        if (floatSuggest) {
          if (this.isMobile) {
            this.updateSmartSuggestion();
          } else {
            floatSuggest.classList.remove('show');
          }
        }
      },
      
      setupFilterPanel() {
        const filterEditBtn = DOMCache.get('filterEditBtn');
        const filterCurrentArea = DOMCache.get('filterCurrentArea');
        const filterPanelClose = DOMCache.get('filterPanelClose');
        const filterOverlay = DOMCache.get('filterOverlay');
        
        // í•„í„° í¸ì§‘ ë²„íŠ¼
        if (filterEditBtn) {
          filterEditBtn.addEventListener('click', () => this.showFilterPanel());
        }
        
        // ìƒíƒœë°” í´ë¦­ìœ¼ë¡œë„ í•„í„° íŒ¨ë„ ì—´ê¸°
        if (filterCurrentArea) {
          filterCurrentArea.addEventListener('click', () => this.showFilterPanel());
        }
        
        if (filterPanelClose) {
          filterPanelClose.addEventListener('click', () => this.hideFilterPanel());
        }
        
        if (filterOverlay) {
          filterOverlay.addEventListener('click', () => this.hideFilterPanel());
        }
        
        // í•„í„° ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('regionOptions')?.addEventListener('click', (e) => {
          const option = e.target.closest('.filter-option');
          if (option) {
            this.selectFilterOption(option, 'region');
          }
        });
        
        document.getElementById('categoryOptions')?.addEventListener('click', (e) => {
          const option = e.target.closest('.filter-option');
          if (option) {
            this.selectFilterOption(option, 'category');
          }
        });
        
        // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜
        this.setupSwipeGesture(DOMCache.get('filterPanel'));
      },
      
      setupDetailSheet() {
        const detailClose = DOMCache.get('detailClose');
        const detailOverlay = DOMCache.get('detailOverlay');
        const detailCopy = document.getElementById('detailCopy');
        const detailShare = document.getElementById('detailShare');
        
        if (detailClose) {
          detailClose.addEventListener('click', () => this.hideDetailSheet());
        }
        
        if (detailOverlay) {
          detailOverlay.addEventListener('click', () => this.hideDetailSheet());
        }
        
        if (detailCopy) {
          detailCopy.addEventListener('click', () => this.copyCode());
        }
        
        if (detailShare) {
          detailShare.addEventListener('click', () => this.shareCode());
        }
        
        // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜
        this.setupSwipeGesture(DOMCache.get('detailSheet'));
      },
      
      setupFloatingSuggestion() {
        const floatSuggest = DOMCache.get('floatSuggest');
        if (floatSuggest) {
          floatSuggest.addEventListener('click', () => {
            this.applySmartRecommendation();
          });
        }
      },
      
      setupSwipeGesture(element) {
        if (!element) return;
        
        let touchStartY = 0;
        let touchEndY = 0;
        
        element.addEventListener('touchstart', (e) => {
          touchStartY = e.changedTouches[0].screenY;
        });
        
        element.addEventListener('touchend', (e) => {
          touchEndY = e.changedTouches[0].screenY;
          if (touchEndY - touchStartY > 50) {
            // ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„
            if (element.id === 'filterPanel') {
              this.hideFilterPanel();
            } else if (element.id === 'detailSheet') {
              this.hideDetailSheet();
            }
          }
        });
      },
      
      showFilterPanel() {
        const filterPanel = DOMCache.get('filterPanel');
        const filterOverlay = DOMCache.get('filterOverlay');
        const floatSuggest = DOMCache.get('floatSuggest');
        
        if (filterPanel) filterPanel.classList.add('show');
        if (filterOverlay) filterOverlay.classList.add('show');
        if (floatSuggest) floatSuggest.classList.remove('show');
        
        FocusManager.saveFocus();
      },
      
      hideFilterPanel() {
        const filterPanel = DOMCache.get('filterPanel');
        const filterOverlay = DOMCache.get('filterOverlay');
        
        if (filterPanel) filterPanel.classList.remove('show');
        if (filterOverlay) filterOverlay.classList.remove('show');
        
        // ìŠ¤ë§ˆíŠ¸ ì œì•ˆ ë‹¤ì‹œ í‘œì‹œ
        if (this.isMobile) {
          setTimeout(() => this.updateSmartSuggestion(), 300);
        }
        
        FocusManager.restoreFocus();
      },
      
      showDetailSheet(couponId) {
        const detailSheet = DOMCache.get('detailSheet');
        const detailOverlay = DOMCache.get('detailOverlay');
        const floatSuggest = DOMCache.get('floatSuggest');
        
        if (!detailSheet || !window.app) return;
        
        const coupon = window.app.state.coupons.find(c => c.id === couponId);
        if (!coupon) return;
        
        // ìƒì„¸ì •ë³´ ì—…ë°ì´íŠ¸
        this.updateDetailContent(coupon);
        
        // í‘œì‹œ
        detailSheet.classList.add('show');
        if (detailOverlay) detailOverlay.classList.add('show');
        if (floatSuggest) floatSuggest.classList.remove('show');
        
        FocusManager.saveFocus();
      },
      
      hideDetailSheet() {
        const detailSheet = DOMCache.get('detailSheet');
        const detailOverlay = DOMCache.get('detailOverlay');
        
        if (detailSheet) detailSheet.classList.remove('show');
        if (detailOverlay) detailOverlay.classList.remove('show');
        
        // ìŠ¤ë§ˆíŠ¸ ì œì•ˆ ë‹¤ì‹œ í‘œì‹œ
        if (this.isMobile) {
          setTimeout(() => this.updateSmartSuggestion(), 300);
        }
        
        FocusManager.restoreFocus();
      },
      
      updateDetailContent(coupon) {
        const store = getCouponField(coupon, 'store');
        const offer = getCouponField(coupon, 'offer');
        
        // ì œëª©ê³¼ í• ì¸ìœ¨
        const titleEl = document.getElementById('detailTitle');
        const offerEl = document.getElementById('detailOffer');
        if (titleEl) titleEl.textContent = store;
        if (offerEl) offerEl.textContent = offer;
        
        // ë°”ì½”ë“œ
        const barcodeEl = document.getElementById('detailBarcode');
        const codeEl = document.getElementById('detailCode');
        if (barcodeEl) {
          barcodeEl.src = `https://barcode.tec-it.com/barcode.ashx?data=${encodeURIComponent(coupon.code)}&code=Code128&dpi=96`;
          barcodeEl.alt = `Barcode for ${coupon.code}`;
        }
        if (codeEl) codeEl.textContent = coupon.code;
        
        // ì´ìš©ì¡°ê±´
        const termsList = document.getElementById('detailTermsList');
        if (termsList) {
          termsList.innerHTML = '';
          const localizedTerms = T[LanguageManager.currentLang]?.terms || coupon.terms;
          localizedTerms.forEach(term => {
            const li = document.createElement('li');
            li.textContent = `â€¢ ${term}`;
            termsList.appendChild(li);
          });
        }
        
        // ë§í¬ë“¤
        const linksEl = document.getElementById('detailLinks');
        if (linksEl) {
          linksEl.innerHTML = '';
          
          if (coupon.lat && coupon.lng) {
            const mapLink = document.createElement('a');
            mapLink.href = `https://www.google.com/maps/search/?api=1&query=${coupon.lat},${coupon.lng}`;
            mapLink.target = '_blank';
            mapLink.rel = 'noopener';
            mapLink.className = 'action-btn secondary';
            mapLink.style.marginBottom = '8px';
            mapLink.innerHTML = `<span>ğŸ“</span><span>${t('openInGoogleMaps')}</span>`;
            linksEl.appendChild(mapLink);
          }
          
          if (coupon.official_url) {
            const siteLink = document.createElement('a');
            siteLink.href = coupon.official_url;
            siteLink.target = '_blank';
            siteLink.rel = 'noopener';
            siteLink.className = 'action-btn secondary';
            siteLink.style.marginBottom = '8px';
            siteLink.innerHTML = `<span>ğŸŒ</span><span>${t('officialWebsite')}</span>`;
            linksEl.appendChild(siteLink);
          }
        }
        
        // í˜„ì¬ ì¿ í° ë°ì´í„° ì €ì¥
        const detailSheet = DOMCache.get('detailSheet');
        detailSheet.dataset.couponId = coupon.id;
        detailSheet.dataset.couponCode = coupon.code;
        detailSheet.dataset.couponName = store;
      },
      
      selectFilterOption(option, type) {
        // ê°™ì€ íƒ€ì…ì˜ ë‹¤ë¥¸ ì˜µì…˜ë“¤ ì„ íƒ í•´ì œ
        option.parentElement.querySelectorAll('.filter-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        option.classList.add('selected');
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸
        if (type === 'region') {
          const region = option.dataset.region || 'all';
          window.app.state.currentRegion = region;
          
          // ëª¨ë°”ì¼ ìƒíƒœë°” ì—…ë°ì´íŠ¸
          const chip = DOMCache.get('mobileRegionChip');
          if (chip) {
            chip.textContent = `ğŸ“ ${option.textContent.replace(/\d+$/, '').trim()}`;
          }
        } else if (type === 'category') {
          const category = option.dataset.category || 'all';
          window.app.state.currentFilter = category;
          
          // ëª¨ë°”ì¼ ìƒíƒœë°” ì—…ë°ì´íŠ¸
          const chip = DOMCache.get('mobileCategoryChip');
          if (chip) {
            chip.textContent = `ğŸ·ï¸ ${option.textContent.trim()}`;
          }
        }
        
        // í•„í„° ì ìš©
        if (window.app) {
          window.app.applyFilters();
        }
        
        // íŒ¨ë„ ë‹«ê¸°
        setTimeout(() => this.hideFilterPanel(), 300);
      },
      
      async copyCode() {
        const detailSheet = DOMCache.get('detailSheet');
        const code = detailSheet?.dataset.couponCode;
        
        if (!code) return;
        
        try {
          await navigator.clipboard.writeText(code);
          
          // ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜
          const btn = document.getElementById('detailCopy');
          if (btn) {
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<span>âœ…</span><span>' + t('copied') + '</span>';
            setTimeout(() => {
              btn.innerHTML = originalHTML;
            }, 1500);
          }
          
          Toast.show(t('codeCopied'));
        } catch (err) {
          Toast.show(t('copyFailed'), 3000);
        }
      },
      
      async shareCode() {
        const detailSheet = DOMCache.get('detailSheet');
        const code = detailSheet?.dataset.couponCode;
        const name = detailSheet?.dataset.couponName;
        
        if (!code || !name) return;
        
        const shareData = {
          title: name,
          text: `${name} - ${t('coupon')}: ${code}`,
          url: window.location.href
        };
        
        try {
          if (navigator.share && this.isMobile) {
            await navigator.share(shareData);
          } else {
            // PCì—ì„œëŠ” ë§í¬ ë³µì‚¬
            const shareText = `${shareData.title}\n${shareData.text}\n${shareData.url}`;
            await navigator.clipboard.writeText(shareText);
            Toast.show(t('copySuccess'));
          }
        } catch (err) {
          if (err.name !== 'AbortError') {
            console.error('Share error:', err);
          }
        }
      },
      
      // ìŠ¤ë§ˆíŠ¸ ì œì•ˆ ì‹œìŠ¤í…œ (ê°œì„ )
      updateSmartSuggestion() {
        if (!this.isMobile || !window.app) return;
        
        const floatSuggest = DOMCache.get('floatSuggest');
        const suggestText = DOMCache.get('suggestText');
        const suggestCount = DOMCache.get('suggestCount');
        
        if (!floatSuggest || !suggestText || !suggestCount) return;
        
        const { currentFilter, currentRegion, saved, filtered } = window.app.state;
        
        // ìƒí™©ë³„ ìŠ¤ë§ˆíŠ¸ ì œì•ˆ ë¡œì§
        let suggestion = null;
        
        // 1. ì €ì¥ëœ ì¿ í°ì´ ìˆëŠ” ê²½ìš°
        if (saved.length > 0 && currentFilter !== 'saved') {
          suggestion = {
            icon: 'â­',
            text: `ì €ì¥ëœ ì¿ í° ${saved.length}ê°œ í™•ì¸`,
            count: saved.length,
            action: 'saved'
          };
        }
        // 2. ì „ì²´ ë³´ê¸°ì—ì„œ ì¸ê¸° ì¡°í•© ì¶”ì²œ
        else if (currentFilter === 'all' && currentRegion === 'all') {
          suggestion = {
            icon: 'ğŸ”¥',
            text: 'ë„ì¿„ ì „ìì œí’ˆ ì¿ í°',
            count: this.getCombinationCount('tokyo', 'electronics'),
            action: 'tokyo-electronics'
          };
        }
        // 3. ì§€ì—­ ì„ íƒ ì‹œ ì¸ê¸° ì¹´í…Œê³ ë¦¬ ì¶”ì²œ
        else if (currentRegion !== 'all' && currentFilter === 'all') {
          const popularCategory = this.getPopularCategoryForRegion(currentRegion);
          if (popularCategory) {
            suggestion = {
              icon: 'ğŸ’¡',
              text: `${t(currentRegion)} ${popularCategory.name}`,
              count: popularCategory.count,
              action: `${currentRegion}-${popularCategory.category}`
            };
          }
        }
        // 4. ê²€ìƒ‰ ì¤‘ì¸ ê²½ìš°
        else if (window.app.state.currentSearch) {
          const searchCount = filtered.length;
          if (searchCount > 0) {
            suggestion = {
              icon: 'ğŸ”',
              text: `"${window.app.state.currentSearch}" ê²€ìƒ‰ê²°ê³¼`,
              count: searchCount,
              action: 'clear-search'
            };
          }
        }
        
        // ì œì•ˆì´ ìˆìœ¼ë©´ í‘œì‹œ
        if (suggestion) {
          suggestText.textContent = suggestion.text;
          suggestCount.textContent = suggestion.count;
          floatSuggest.dataset.action = suggestion.action;
          floatSuggest.classList.add('show');
        } else {
          floatSuggest.classList.remove('show');
        }
      },
      
      getCombinationCount(region, category) {
        if (!window.app) return 0;
        return window.app.state.coupons.filter(c => 
          (c.region?.includes(region) || region === 'all') &&
          (c.category === category || category === 'all')
        ).length;
      },
      
      getPopularCategoryForRegion(region) {
        if (!window.app) return null;
        
        const categories = ['electronics', 'fashion', 'dining', 'transport'];
        const counts = categories.map(cat => ({
          category: cat,
          name: t(cat).replace(/ğŸ”Œ|ğŸ‘•|ğŸ½ï¸|ğŸš‡/, '').trim(),
          count: this.getCombinationCount(region, cat)
        }));
        
        // ê°€ì¥ ë§ì€ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
        return counts.reduce((max, current) => 
          current.count > max.count ? current : max
        );
      },
      
      applySmartRecommendation() {
        const floatSuggest = DOMCache.get('floatSuggest');
        const action = floatSuggest?.dataset.action;
        
        if (!action || !window.app) return;
        
        // ì•¡ì…˜ë³„ ì²˜ë¦¬
        if (action === 'saved') {
          window.app.state.currentFilter = 'saved';
          window.app.applyFilters();
          Toast.show('ì €ì¥ëœ ì¿ í°ì„ í‘œì‹œí•©ë‹ˆë‹¤');
        } else if (action === 'tokyo-electronics') {
          window.app.state.currentRegion = 'tokyo';
          window.app.state.currentFilter = 'electronics';
          window.app.applyFilters();
          window.app.updateFilterTexts();
          Toast.show('ë„ì¿„ ì „ìì œí’ˆ ì¿ í°ì„ í‘œì‹œí•©ë‹ˆë‹¤');
        } else if (action === 'clear-search') {
          const searchInput = DOMCache.get('searchInput');
          if (searchInput) {
            searchInput.value = '';
            window.app.state.currentSearch = '';
            window.app.applyFilters();
          }
        } else if (action.includes('-')) {
          const [region, category] = action.split('-');
          window.app.state.currentRegion = region;
          window.app.state.currentFilter = category;
          window.app.applyFilters();
          window.app.updateFilterTexts();
          Toast.show(`${t(region)} ${t(category)} ì¿ í°ì„ í‘œì‹œí•©ë‹ˆë‹¤`);
        }
        
        // ì œì•ˆ ìˆ¨ê¸°ê¸°
        floatSuggest.classList.remove('show');
        
        // ì¼ì • ì‹œê°„ í›„ ìƒˆë¡œìš´ ì œì•ˆ ì—…ë°ì´íŠ¸
        setTimeout(() => this.updateSmartSuggestion(), 2000);
      }
    };

    // ===========================================
    // ì¹´ë“œ ìƒì„± ë° ê´€ë ¨ í•¨ìˆ˜ë“¤ (í•˜ì´ë¸Œë¦¬ë“œ ë²„ì „)
    // ===========================================
    function createCard(coupon) {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-id', coupon.id);
      card.setAttribute('tabindex', '0');
      
      const store = getCouponField(coupon, 'store');
      const offer = getCouponField(coupon, 'offer');
      
      card.setAttribute('aria-label', `${store}ã®ã‚¯ãƒ¼ãƒãƒ³: ${offer}`);
      card.setAttribute('aria-expanded', 'false');
      
      const cardInner = document.createElement('div');
      cardInner.className = 'card-inner';

      const flipOverlay = document.createElement('div');
      flipOverlay.className = 'card-flip-overlay';
      flipOverlay.setAttribute('role', 'button');
      flipOverlay.setAttribute('aria-label', t('flipCard'));
      flipOverlay.setAttribute('tabindex', '-1');
      
      // ì•ë©´ ìƒì„±
      const cardFront = createCardFront(coupon, store, offer);
      
      // ë’·ë©´ ìƒì„± (PCìš©)
      const cardBack = createCardBack(coupon, store, offer);
      
      cardInner.appendChild(cardFront);
      cardInner.appendChild(cardBack);
      card.appendChild(cardInner);
      card.appendChild(flipOverlay);
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í•˜ì´ë¸Œë¦¬ë“œ)
      setupCardEvents(card, flipOverlay, coupon.id);
      
      return card;
    }

    // ì•ë©´ ìƒì„± í•¨ìˆ˜ (ì§€ì—­ í‘œì‹œ ì¶”ê°€)
    function createCardFront(coupon, store, offer) {
      const cardFront = document.createElement('div');
      cardFront.className = 'card-face card-front';
      cardFront.setAttribute('aria-hidden', 'false');

      // ì´ë¯¸ì§€
      const img = document.createElement('img');
      img.dataset.src = coupon.image;
      img.alt = store;
      img.loading = 'lazy';
      img.className = 'lazy';
      cardFront.appendChild(img);
      ImageLazyLoader.observe(img);

      // í• ì¸ ë°°ì§€
      const offerBadge = document.createElement('div');
      offerBadge.className = 'offer-badge';
      offerBadge.textContent = offer;
      cardFront.appendChild(offerBadge);

      // ì¹´ë“œ ë°”ë””
      const body = document.createElement('div');
      body.className = 'card-body';

      // ë§¤ì¥ëª…
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = store;
      body.appendChild(title);

      // ì„¤ëª…
      const description = getCouponField(coupon, 'description');
      const desc = document.createElement('div');
      desc.className = 'desc';
      desc.textContent = description.length > 50 ? description.substring(0, 50) + '...' : description;
      body.appendChild(desc);

      // ìœ íš¨ê¸°í•œ í‘œì‹œ
      const expiryLine = document.createElement('div');
      expiryLine.className = 'expiry-line';
      
      const daysLeft = Utils.daysTillExpiry(coupon.expiry);
      if (daysLeft === 999) {
        expiryLine.innerHTML = `<span>ğŸ“…</span><span>${T[LanguageManager.currentLang].noExpiry}</span>`;
      } else if (daysLeft <= 7) {
        expiryLine.innerHTML = `<span>â°</span><span class="expiry-danger">${t('daysLeft', {days: daysLeft})}</span>`;
      } else {
        expiryLine.innerHTML = `<span>ğŸ“…</span><span>${coupon.expiry}</span>`;
      }
      body.appendChild(expiryLine);
      
      // ì§€ì—­ í‘œì‹œ (ìƒˆë¡œ ì¶”ê°€)
      if (coupon.region && coupon.region.length > 0) {
        const areaTags = document.createElement('div');
        areaTags.className = 'area-tags';
        
        coupon.region.forEach(region => {
          const tag = document.createElement('span');
          tag.className = 'area-tag';
          tag.textContent = t(region) || region;
          areaTags.appendChild(tag);
        });
        
        body.appendChild(areaTags);
      }

      // ì´ìš©ì¡°ê±´ í…ìŠ¤íŠ¸
      const localizedTerms = T[LanguageManager.currentLang]?.terms;
      if (Array.isArray(localizedTerms) && localizedTerms.length > 0) {
        const termsSummary = document.createElement('div');
        termsSummary.className = 'terms-text';
        termsSummary.style.padding = '0.4rem 0.6rem';
        termsSummary.style.fontSize = '0.7rem';
        termsSummary.style.border = 'none';

        const firstTerm = localizedTerms[0];
        const summaryText = t('termsSummary').replace('{term}', firstTerm);
        termsSummary.innerHTML = `â“˜ ${summaryText}`;

        body.appendChild(termsSummary);
      }

      // ì¶”ì²œ ë¬¸êµ¬ê°€ ìˆìœ¼ë©´ í‘œì‹œ
      const recommendation = getCouponField(coupon, 'recommendation');
      if (recommendation) {
        body.appendChild(createRecommendationSection(recommendation));
      }

      // ìƒì„¸ë³´ê¸° ë²„íŠ¼
      const actionRow = document.createElement('div');
      actionRow.style.cssText = 'display: flex; justify-content: flex-end; margin-top: auto;';
      
      const detailBtn = document.createElement('button');
      detailBtn.className = 'btn btn-show-detail';
      detailBtn.textContent = T[LanguageManager.currentLang].detailShow || 'ìƒì„¸ >';
      detailBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const card = detailBtn.closest('.card');
        showCardDetail(card);
      });
      
      actionRow.appendChild(detailBtn);
      body.appendChild(actionRow);

      cardFront.appendChild(body);
     
      const saveBtn = createSaveButton(coupon.id);
      cardFront.appendChild(saveBtn);

      return cardFront;
    }

    // showCardDetail í•¨ìˆ˜ ì¶”ê°€ (í•˜ì´ë¸Œë¦¬ë“œ ë™ì‘)
    function showCardDetail(card) {
      const couponId = parseInt(card.dataset.id);
      
      if (MobileUIManager.isMobile) {
        // ëª¨ë°”ì¼: ë°”í…€ì‹œíŠ¸
        MobileUIManager.showDetailSheet(couponId);
      } else {
        // PC: ê¸°ì¡´ í”Œë¦½
        flipCard(card, true);
      }
    }

    // ë’·ë©´ ìƒì„± (PCìš©)
    function createCardBack(coupon, store, offer) {
      const cardBack = document.createElement('div');
      cardBack.className = 'card-face card-back';
      cardBack.setAttribute('aria-hidden', 'true');

      const lang = LanguageManager.currentLang;

      // í—¤ë”
      const header = document.createElement('div');
      header.className = 'back-header';
      
      const title = document.createElement('h3');
      title.textContent = store;
      header.appendChild(title);
      
      const closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.textContent = 'âœ•';
      closeBtn.setAttribute('aria-label', T[lang].closeDetail || 'è©³ç´°ã‚’é–‰ã˜ã‚‹');
      closeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const card = e.target.closest('.card');
        flipCard(card, false);
      });
      header.appendChild(closeBtn);
      
      cardBack.appendChild(header);

      // ë°”ì½”ë“œ
      const barcodeSection = document.createElement('div');
      barcodeSection.className = 'barcode-section';
      const barcodeImg = document.createElement('img');
      barcodeImg.src = `https://barcode.tec-it.com/barcode.ashx?data=${encodeURIComponent(coupon.code)}&code=Code128&dpi=96`;
      barcodeImg.alt = `Barcode for ${coupon.code}`;
      barcodeSection.appendChild(barcodeImg);
      cardBack.appendChild(barcodeSection);

      // ì •ë³´ ê·¸ë¦¬ë“œ
      const infoGrid = document.createElement('div');
      infoGrid.className = 'info-grid';

      // ì´ìš©ì¡°ê±´
      const localizedTerms = T[LanguageManager.currentLang]?.terms;
      if (Array.isArray(localizedTerms) && localizedTerms.length > 0) {
          const item = document.createElement('div');
          item.className = 'info-item';

          const labelEl = document.createElement('span');
          labelEl.className = 'info-label';
          labelEl.textContent = t('termsLabel');

          const valueEl = document.createElement('span');
          valueEl.className = 'info-value';

          const ul = document.createElement('ul');
          ul.style.paddingLeft = '1rem';
          ul.style.margin = '0';

          localizedTerms.forEach(term => {
              const li = document.createElement('li');
              li.style.listStyleType = '"â€¢ "';
              li.style.paddingLeft = '0.25rem';
              li.textContent = term;
              ul.appendChild(li);
          });

          valueEl.appendChild(ul);
          item.appendChild(labelEl);
          item.appendChild(valueEl);
          infoGrid.appendChild(item);
      }

      // ë§í¬ë“¤
      if (coupon.article_url) {
          const articleLink = document.createElement('a');
          articleLink.href = coupon.article_url;
          articleLink.target = '_blank';
          articleLink.rel = 'noopener';
          articleLink.textContent = t('readArticle');
          infoGrid.appendChild(createInfoItem(t('relatedArticle'), articleLink.outerHTML));
      }
      
      if (coupon.lat != null && coupon.lng != null) {
        const mapLink = document.createElement('a');
        mapLink.href = `https://www.google.com/maps/search/?api=1&query=${coupon.lat},${coupon.lng}`;
        mapLink.target = '_blank';
        mapLink.rel = 'noopener';
        mapLink.textContent = T[lang].openInGoogleMaps || 'Google Maps';
        infoGrid.appendChild(createInfoItem(T[lang].mapView || 'åœ°å›³', mapLink.outerHTML));
      }

      if (coupon.official_url) {
        const link = document.createElement('a');
        link.href = coupon.official_url;
        link.target = '_blank';
        link.rel = 'noopener';
        link.textContent = T[lang].viewSite || 'è¦‹ã‚‹';
        infoGrid.appendChild(createInfoItem(T[lang].officialWebsite || 'å…¬å¼ã‚µã‚¤ãƒˆ', link.outerHTML));
      }

      cardBack.appendChild(infoGrid);

      // ê³µìœ  ë²„íŠ¼
      const shareBtn = createShareButton(coupon);
      cardBack.appendChild(shareBtn);

      return cardBack;
    }

    // ì •ë³´ ì•„ì´í…œ ìƒì„±
    function createInfoItem(label, value) {
      const item = document.createElement('div');
      item.className = 'info-item';
      
      const labelEl = document.createElement('span');
      labelEl.className = 'info-label';
      labelEl.textContent = label;
      
      const valueEl = document.createElement('span');
      valueEl.className = 'info-value';
      
      // ì•ˆì „í•œ HTML ì²˜ë¦¬
      if (typeof value === 'string') {
        // ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë§í¬ íŒ¨í„´ë§Œ í—ˆìš©
        if (value.match(/^<a\s+href="https?:\/\/[^"]+"\s*(target="_blank"\s*)?(rel="noopener"\s*)?>[\s\S]+<\/a>$/)) {
          // ë§í¬ë§Œ í—ˆìš©í•˜ë˜, ì¶”ê°€ ê²€ì¦
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = value;
          const link = tempDiv.querySelector('a');
          if (link && link.href && link.textContent) {
            const safeLink = document.createElement('a');
            safeLink.href = link.href;
            safeLink.target = '_blank';
            safeLink.rel = 'noopener';
            safeLink.textContent = link.textContent;
            valueEl.appendChild(safeLink);
          } else {
            valueEl.textContent = value;
          }
        } else {
          valueEl.textContent = value;
        }
      } else {
        valueEl.textContent = String(value);
      }
      
      item.appendChild(labelEl);
      item.appendChild(valueEl);
      return item;
    }

    function createRecommendationSection(recommendation) {
      const recWrapper = document.createElement('div');
      recWrapper.className = 'recommendation-wrapper';
      
      const recBtn = document.createElement('button');
      recBtn.className = 'btn btn-sm recommendation-btn';
      recBtn.textContent = T[LanguageManager.currentLang].whyThisStore || 'ğŸ’¬ ãªãœã“ã®åº—ï¼Ÿ';

      const bubble = document.createElement('div');
      bubble.className = 'speech-bubble';
      bubble.textContent = recommendation;
      
      // ì˜¤ë²„ë ˆì´ ìƒì„±
      let overlay = null;
      
      // íˆ´íŒ í‘œì‹œ í•¨ìˆ˜
      const showTooltip = () => {
        bubble.classList.add('show');
        
        // ëª¨ë°”ì¼ì—ì„œë§Œ ì˜¤ë²„ë ˆì´ í‘œì‹œ
        if ('ontouchstart' in window || window.innerWidth <= 768) {
          if (!overlay) {
            overlay = document.createElement('div');
            overlay.className = 'speech-bubble-overlay';
            document.body.appendChild(overlay);
          }
          overlay.classList.add('show');
          
          // ì˜¤ë²„ë ˆì´ í´ë¦­ì‹œ ë‹«ê¸°
          overlay.addEventListener('click', hideTooltip, { once: true });
        }
      };
      
      // íˆ´íŒ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
      const hideTooltip = () => {
        bubble.classList.remove('show');
        if (overlay) {
          overlay.classList.remove('show');
          setTimeout(() => {
            overlay?.remove();
            overlay = null;
          }, 300);
        }
      };
      
      // PC: ë§ˆìš°ìŠ¤ í˜¸ë²„ ì´ë²¤íŠ¸
      recBtn.addEventListener('mouseenter', (e) => {
        // í„°ì¹˜ ë””ë°”ì´ìŠ¤ê°€ ì•„ë‹ˆê³  í™”ë©´ì´ í° ê²½ìš°ì—ë§Œ
        if (!('ontouchstart' in window) && window.innerWidth > 768) {
          showTooltip();
        }
      });
      
      recBtn.addEventListener('mouseleave', (e) => {
        // í„°ì¹˜ ë””ë°”ì´ìŠ¤ê°€ ì•„ë‹ˆê³  í™”ë©´ì´ í° ê²½ìš°ì—ë§Œ
        if (!('ontouchstart' in window) && window.innerWidth > 768) {
          hideTooltip();
        }
      });
      
      // ëª¨ë°”ì¼: í´ë¦­ ì´ë²¤íŠ¸
      recBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        
        // í„°ì¹˜ ë””ë°”ì´ìŠ¤ì´ê±°ë‚˜ ì‘ì€ í™”ë©´ì—ì„œë§Œ
        if ('ontouchstart' in window || window.innerWidth <= 768) {
          if (bubble.classList.contains('show')) {
            hideTooltip();
          } else {
            showTooltip();
          }
        }
      });
      
      // ë§í’ì„  ìì²´ í´ë¦­ì‹œ (ëª¨ë°”ì¼ì—ì„œ X ë²„íŠ¼ ì—­í• )
      bubble.addEventListener('click', (e) => {
        if ('ontouchstart' in window || window.innerWidth <= 768) {
          // ::before ê°€ìƒ ìš”ì†Œ(X ë²„íŠ¼) ì˜ì—­ í´ë¦­ ê°ì§€
          const rect = bubble.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          // ìš°ìƒë‹¨ 24x24 ì˜ì—­ í´ë¦­ì‹œ
          if (x > rect.width - 40 && y < 40) {
            e.stopPropagation();
            hideTooltip();
          }
        }
      });

      recWrapper.appendChild(recBtn);
      recWrapper.appendChild(bubble);
      
      return recWrapper;
    }

    function createSaveButton(couponId) {
      const saveBtn = document.createElement('button');
      saveBtn.className = 'save';
      const isSaved = window.app?.state.saved.includes(couponId);
      saveBtn.setAttribute('aria-label', isSaved ? 
        (T[LanguageManager.currentLang].unsaveCoupon || 'ã‚¯ãƒ¼ãƒãƒ³ã®ä¿å­˜ã‚’è§£é™¤') : 
        (T[LanguageManager.currentLang].saveCoupon || 'ã‚¯ãƒ¼ãƒãƒ³ã‚’ä¿å­˜'));
      saveBtn.textContent = isSaved ? 'â­' : 'â˜†';
      if (isSaved) saveBtn.classList.add('saved');
      
      saveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggleSave(couponId, saveBtn);
      });
      
      return saveBtn;
    }

    function createShareButton(coupon) {
      const shareBtn = document.createElement('button');
      shareBtn.className = 'share-btn';
      const lang = LanguageManager.currentLang;
      
      const span = document.createElement('span');
      span.textContent = `ğŸ“¤ ${T[lang].shareCoupon || 'å…±æœ‰ã™ã‚‹'}`;
      shareBtn.appendChild(span);
      
      shareBtn.addEventListener('click', async (e) => {
        e.stopPropagation();
        
        // ê³µìœ  ë°ì´í„° ì¤€ë¹„
        const store = getCouponField(coupon, 'store');
        const offer = getCouponField(coupon, 'offer');
        const description = getCouponField(coupon, 'description');
        
        // ê³µìœ ìš© URL (íŠ¹ì • ì¿ í°ìœ¼ë¡œ ë°”ë¡œ ì´ë™)
        const shareUrl = `${window.location.origin}${window.location.pathname}?coupon=${coupon.id}&lang=${lang}`;
        
        const shareData = {
          title: `${store} - ${offer}`,
          text: `${store}ã§${offer}ï¼\n${description}\n\nã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰: ${coupon.code}`,
          url: shareUrl
        };
        
        try {
          // ëª¨ë°”ì¼ ì²´í¬
          const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
          
          if (navigator.share && isMobile) {
            await navigator.share(shareData);
            Toast.show('å…±æœ‰ã—ã¾ã—ãŸ', 1500);
          } else {
            // PCë‚˜ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ëŠ” í´ë¦½ë³´ë“œì— ë³µì‚¬
            const shareText = `${shareData.title}\n${shareData.text}\n${shareData.url}`;
            await copyToClipboard(shareText);
            Toast.show('å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 2000);
          }
        } catch (err) {
          if (err.name !== 'AbortError') {
            console.error('å…±æœ‰ã‚¨ãƒ©ãƒ¼:', err);
            Toast.show('å…±æœ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', 2000);
          }
        }
      });
      
      return shareBtn;
    }

    // ì¹´ë“œ í”Œë¦½ ì• ë‹ˆë©”ì´ì…˜
    function flipCard(card, show = true) {
      const cardFront = card.querySelector('.card-front');
      const cardBack = card.querySelector('.card-back');
      
      if (!cardFront || !cardBack) {
        console.error('Card elements not found');
        return;
      }
      
      // ìƒíƒœë¥¼ í•œ ë²ˆì— ê´€ë¦¬
      if (show) {
        // ì—´ê¸° ìƒíƒœ - ëª¨ë“  ì†ì„±ì„ í•œ ë²ˆì—
        card.classList.add('flipped');
        card.setAttribute('aria-expanded', 'true');
        cardFront.setAttribute('aria-hidden', 'true');
        cardBack.setAttribute('aria-hidden', 'false');
        
        // í¬ì»¤ìŠ¤ ê´€ë¦¬
        setTimeout(() => {
          const closeBtn = cardBack.querySelector('.close-btn');
          if (closeBtn) {
            closeBtn.focus();
            announceToScreenReader(t('cardFlipped'));
          }
        }, 300);
      } else {
        // ë‹«ê¸° ìƒíƒœ - ëª¨ë“  ì†ì„±ì„ í•œ ë²ˆì—
        card.classList.remove('flipped');
        card.setAttribute('aria-expanded', 'false');
        cardFront.setAttribute('aria-hidden', 'false');
        cardBack.setAttribute('aria-hidden', 'true');
        
        FocusManager.restoreFocus();
        announceToScreenReader(t('cardClosed'));
      }
    }

    function announceToScreenReader(message) {
      const srAnnouncement = DOMCache.get('srAnnouncement');
      if (srAnnouncement) {
        srAnnouncement.textContent = '';
        setTimeout(() => {
          srAnnouncement.textContent = message;
        }, 100);
      }
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        try {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          textArea.style.cssText = 'position:fixed;left:-999999px;';
          document.body.appendChild(textArea);
          textArea.select();
          const success = document.execCommand('copy');
          document.body.removeChild(textArea);
          return success;
        } catch {
          return false;
        }
      }
    }

    function setupCardEvents(card, flipOverlay, couponId) {
      // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
      card.addEventListener('click', (e) => {
        // í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œë“¤
        if (e.target.closest('button, a, .save, .share-btn, .copy-btn, .btn-show-detail, .recommendation-btn, .speech-bubble')) {
          return;
        }
        
        // ëª¨ë°”ì¼ê³¼ PC ë¶„ê¸°
        if (MobileUIManager.isMobile) {
          MobileUIManager.showDetailSheet(couponId);
        } else {
          const isFlipped = card.classList.contains('flipped');
          flipCard(card, !isFlipped);
        }
      });
      
      // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
      card.addEventListener('keydown', (e) => {
        if ((e.key === 'Enter' || e.key === ' ') && e.target === card) {
          e.preventDefault();
          
          if (MobileUIManager.isMobile) {
            MobileUIManager.showDetailSheet(couponId);
          } else {
            const isFlipped = card.classList.contains('flipped');
            flipCard(card, !isFlipped);
          }
        }
        
        if (e.key === 'Escape' && card.classList.contains('flipped')) {
          e.preventDefault();
          flipCard(card, false);
        }
      });
    }

    // ì €ì¥ í† ê¸€
    function toggleSave(id, btn) {
      if (!window.app) return;
      
      const lang = LanguageManager.currentLang;
      
      if (window.app.state.saved.includes(id)) {
        window.app.state.saved = window.app.state.saved.filter(x => x !== id);
        Toast.show(T[lang].unsavedCoupon || 'ä¿å­˜ã‚’è§£é™¤ã—ã¾ã—ãŸ');
        
        // saved í•„í„° ì¤‘ì´ë©´ ë°”ë¡œ ì¬ì ìš©
        if (window.app.state.currentFilter === 'saved') {
          window.app.applyFilters();
        }
      } else {
        window.app.state.saved.push(id);
        Toast.show(T[lang].savedCoupon || 'ä¿å­˜ã—ã¾ã—ãŸ');
      }
      
      // ëª¨ë“  ë™ì¼í•œ ì¿ í°ì˜ ì €ì¥ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      const card = document.querySelector(`[data-id="${id}"]`);
      if (card) {
        const saveBtns = card.querySelectorAll('.save');
        const isSaved = window.app.state.saved.includes(id);
        
        saveBtns.forEach(saveBtn => {
          saveBtn.textContent = isSaved ? 'â­' : 'â˜†';
          if (isSaved) {
            saveBtn.classList.add('saved');
            saveBtn.setAttribute('aria-label', T[lang].unsaveCoupon || 'ã‚¯ãƒ¼ãƒãƒ³ã®ä¿å­˜ã‚’è§£é™¤');
          } else {
            saveBtn.classList.remove('saved');
            saveBtn.setAttribute('aria-label', T[lang].saveCoupon || 'ã‚¯ãƒ¼ãƒãƒ³ã‚’ä¿å­˜');
          }
        });
      }
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
      StorageManager.setSaved(window.app.state.saved);
      
      // ì €ì¥ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
      window.app.updateSavedCount();
    }

    // ===========================================
    // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤ (í•˜ì´ë¸Œë¦¬ë“œ ë²„ì „)
    // ===========================================
    class JKWalletApp {
        parseDiscount(offerText) {
            if (!offerText) return 0;
            const match = offerText.match(/(\d+)%/);
            return match ? parseInt(match[1], 10) : 0;
        } 
        
      constructor() {
        this.state = {
            coupons: [],
            filtered: [],
            saved: [],
            userLocation: null,
            currentFilter: 'all',     // ì¹´í…Œê³ ë¦¬ í•„í„°
            currentRegion: 'all',     // ì§€ì—­ í•„í„° (ìƒˆë¡œ ì¶”ê°€)
            currentSort: 'latest',    // ì •ë ¬
            currentSearch: '',
            currentView: 'home',
            isLoading: true,
            hasError: false
        };
        
        this.config = {
          api: {
            retryAttempts: 3,
            retryDelay: 1000,
            timeout: 10000
          },
          performance: {
            pageSize: 20,
            renderThrottle: 16,
            searchDebounce: 300
          }
        };

        // ë°”ì¸ë”©
        this.handleSearch = Utils.debounce(this.handleSearch.bind(this), this.config.performance.searchDebounce);
        this.handleResize = Utils.throttle(this.handleResize.bind(this), 250);
      }

      // ì´ˆê¸°í™” ì‹œí€€ìŠ¤
      async init() {
        try {
          // 1. DOM ìºì‹œ ì´ˆê¸°í™”
          DOMCache.init();
          
          // 2. ìœ í‹¸ë¦¬í‹° ì´ˆê¸°í™”
          Toast.init();
          ImageLazyLoader.init();
          HeaderManager.init();
          MobileUIManager.init(); // ëª¨ë°”ì¼ UI ë§¤ë‹ˆì € ì¶”ê°€
          
          // 3. ì–¸ì–´ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
          LanguageManager.init();
          
          // 4. URL ìƒíƒœ ë³µì›
          this.restoreUrlState();
          
          // 5. í…Œë§ˆ ë¡œë“œ
          this.loadTheme();
          
          // 6. ë°ì´í„° ë¡œë“œ (ë³‘ë ¬)
          const [coupons, saved] = await Promise.all([
            this.loadCoupons(),
            this.loadSavedCoupons()
          ]);
          
          this.state.coupons = coupons;
          this.state.saved = saved;
          this.state.filtered = [...coupons];
          
          // 7. UI ì´ˆê¸°í™”
          this.setupUI();
          
          // 8. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
          this.setupEventListeners();
          
          // 9. ì´ˆê¸° ë Œë”ë§
          this.state.isLoading = false;
          this.render();
          
          // 10. ì €ì¥ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
          this.updateSavedCount();
          
          // 11. í•„í„° ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
          this.updateFilterCounts();
          
          // 12. ëª¨ë°”ì¼ ì¶”ì²œ ì—…ë°ì´íŠ¸
          MobileUIManager.updateSuggestion();
          
          console.log('âœ… JK Wallet ì´ˆê¸°í™” ì™„ë£Œ');
          
        } catch (error) {
          this.handleInitError(error);
        }
      }

      restoreUrlState() {
        // URLì—ì„œ ìƒíƒœ ë³µì›
        const filter = Utils.getUrlParam('filter');
        if (filter && ['all', 'saved', 'electronics', 'fashion', 'dining', 'transport', 'nearby'].includes(filter)) {
          this.state.currentFilter = filter;
        }
        
        const region = Utils.getUrlParam('region');
        if (region && ['all', 'tokyo', 'osaka', 'fukuoka', 'sapporo', 'okinawa', 'others'].includes(region)) {
          this.state.currentRegion = region;
        }
        
        const search = Utils.getUrlParam('q');
        if (search) {
          this.state.currentSearch = search;
          const searchInput = DOMCache.get('searchInput');
          if (searchInput) searchInput.value = search;
        }

        const couponId = Utils.getUrlParam('coupon');
        if (couponId) {
          // MutationObserverë¡œ ì¹´ë“œ ìƒì„± ê°ì§€
          const observer = new MutationObserver((mutations, obs) => {
            const card = document.querySelector(`[data-id="${couponId}"]`);
            if (card) {
              obs.disconnect(); // ê´€ì°° ì¤‘ì§€
              card.scrollIntoView({ behavior: 'smooth', block: 'center' });
              
              // ëª¨ë°”ì¼ê³¼ PC ë¶„ê¸°
              if (MobileUIManager.isMobile) {
                setTimeout(() => {
                  MobileUIManager.showDetailSheet(parseInt(couponId));
                }, 500);
              } else {
                flipCard(card, true);
              }
              
              Toast.show(T[LanguageManager.currentLang].sharedCoupon || 'Shared coupon', 2000);
            }
          });
          
          // ì¿ í° ê·¸ë¦¬ë“œ ê´€ì°° ì‹œì‘
          const grid = DOMCache.get('couponGrid');
          if (grid) {
            observer.observe(grid, { childList: true, subtree: true });
            
            // íƒ€ì„ì•„ì›ƒ ì„¤ì • (5ì´ˆ í›„ ê´€ì°° ì¤‘ì§€)
            setTimeout(() => observer.disconnect(), 5000);
          }
        }
      }

      async loadCoupons() {
        const loader = new CouponLoader(this.config.api);
        return await loader.loadFromAPI();
      }

      async loadSavedCoupons() {
        return StorageManager.getSaved();
      }

      loadTheme() {
        const isDark = StorageManager.getTheme();
        if (isDark) document.body.classList.add('dark-mode');
      }

      setupUI() {
        // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • (ì´ë²¤íŠ¸ ìœ„ì„)
        this.setupNavigation();
        
        // ê²€ìƒ‰ ì„¤ì •
        this.setupSearch();
        
        // ì¶”ì²œ ê²€ìƒ‰ì–´ ì´ë²¤íŠ¸ ìœ„ì„
        this.setupSuggestions();

        // PC í•„í„° ì„¤ì •
        this.setupFilterAndSortControls();
      }

      setupEventListeners() {
        // í…Œë§ˆ í† ê¸€
        DOMCache.get('themeToggle')?.addEventListener('click', () => {
          this.toggleTheme();
        });
        
        // Settings ì´ë²¤íŠ¸ (Settings ë·°ê°€ ìˆì„ ë•Œë§Œ)
        const settingsLang = DOMCache.get('settingsLang');
        if (settingsLang) {
          settingsLang.addEventListener('change', (e) => {
            LanguageManager.setLanguage(e.target.value);
          });
        }
        
        const settingsTheme = DOMCache.get('settingsTheme');
        if (settingsTheme) {
          settingsTheme.addEventListener('click', () => {
            this.toggleTheme();
            settingsTheme.textContent = document.body.classList.contains('dark-mode') ? 
              T[LanguageManager.currentLang].darkMode : T[LanguageManager.currentLang].lightMode;
          });
        }
        
        const clearCache = DOMCache.get('clearCache');
        if (clearCache) {
          clearCache.addEventListener('click', () => {
            localStorage.removeItem('cachedCoupons');
            localStorage.removeItem('cacheTime');
            Toast.show(T[LanguageManager.currentLang].cacheCleared || 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
          });
        }
        
        const clearSaved = DOMCache.get('clearSaved');
        if (clearSaved) {
          clearSaved.addEventListener('click', () => {
            const confirmMsg = T[LanguageManager.currentLang].confirmClearSaved || 'æœ¬å½“ã«ã™ã¹ã¦ã®ä¿å­˜æ¸ˆã¿ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ';
            if (confirm(confirmMsg)) {
              this.state.saved = [];
              StorageManager.setSaved([]);
              this.updateSavedCount();
              if (this.state.currentFilter === 'saved') {
                this.applyFilters();
              }
              Toast.show(T[LanguageManager.currentLang].savedCouponsCleared || 'ä¿å­˜æ¸ˆã¿ã‚¯ãƒ¼ãƒãƒ³ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã—ãŸ');
            }
          });
        }
        
        // ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
        window.addEventListener('resize', this.handleResize);
      }

      setupFilterAndSortControls() {
        const filterContainer = DOMCache.get('filterContainer');
        const regionContainer = DOMCache.get('regionContainer');
        const sortSelect = DOMCache.get('sortSelect');

        // PC í•„í„° í´ë¦­ ì´ë²¤íŠ¸ (ì¹´í…Œê³ ë¦¬)
        if (filterContainer) {
            filterContainer.addEventListener('click', (e) => {
                const pill = e.target.closest('.pill');
                if (!pill) return;

                // UI ì—…ë°ì´íŠ¸
                filterContainer.querySelectorAll('.pill').forEach(p => p.setAttribute('aria-selected', 'false'));
                pill.setAttribute('aria-selected', 'true');

                // ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©
                const filterValue = pill.dataset.filter;
                this.state.currentFilter = filterValue;
                
                this.applyFilters();
            });
        }

        // PC ì§€ì—­ í•„í„° í´ë¦­ ì´ë²¤íŠ¸
        if (regionContainer) {
            regionContainer.addEventListener('click', (e) => {
                const pill = e.target.closest('.pill');
                if (!pill) return;

                // UI ì—…ë°ì´íŠ¸
                regionContainer.querySelectorAll('.pill').forEach(p => p.setAttribute('aria-selected', 'false'));
                pill.setAttribute('aria-selected', 'true');

                // ì§€ì—­ í•„í„° ì ìš©
                const regionValue = pill.dataset.filter;
                this.state.currentRegion = regionValue;
                
                this.applyFilters();
            });
        }

        // ì •ë ¬ ë³€ê²½ ì´ë²¤íŠ¸
        if (sortSelect) {
            sortSelect.addEventListener('change', (e) => {
                this.state.currentSort = e.target.value;
                this.applyFilters();
                Toast.show(t('sortChanged') || 'ì •ë ¬ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }
      }

      setupNavigation() {
        const navContainer = DOMCache.get('navContainer');
        
        // ì´ë²¤íŠ¸ ìœ„ì„
        navContainer.addEventListener('click', async (e) => {
          e.preventDefault();
          const navItem = e.target.closest('.nav-item');
          if (navItem) {
            const view = navItem.dataset.view;
            await this.setView(view);
          }
        });
      }

      setupSearch() {
        const searchInput = DOMCache.get('searchInput');
        const searchClear = DOMCache.get('searchClear');
        
        if (searchInput) {
          searchInput.addEventListener('input', this.handleSearch);
        }
        
        if (searchClear) {
          searchClear.addEventListener('click', () => {
            searchInput.value = '';
            this.handleSearch({target: searchInput});
          });
        }
      }

      setupSuggestions() {
        // ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ë™ì  suggestion-chip ì²˜ë¦¬
        document.addEventListener('click', (e) => {
          const chip = e.target.closest('.suggestion-chip');
          if (chip) {
            const suggestion = chip.dataset.suggestion;
            if (suggestion) {
              const searchInput = DOMCache.get('searchInput');
              searchInput.value = suggestion;
              searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
          }
        });
      }

      async setFilter(filter) {
        if (this.state.isLoading) return;
        
        const prevFilter = this.state.currentFilter;
        this.state.currentFilter = filter;
        
        // URL ì—…ë°ì´íŠ¸
        Utils.updateUrlParam('filter', filter === 'all' ? null : filter);
        
        try {
          // nearby í•„í„° íŠ¹ë³„ ì²˜ë¦¬
          if (filter === 'nearby') {
            if (!this.state.userLocation) {
              await this.requestLocation();
            }
            await MapManager.init();
            MapManager.centerTo(this.state.userLocation);
            this.showNearbyHint();
          } else {
            this.hideNearbyHint();
            if (filter === 'all' || filter === 'saved') {
              MapManager.hideMap();
            }
          }
          
          this.applyFilters();
          
        } catch (error) {
          // ì‹¤íŒ¨ì‹œ ì´ì „ í•„í„°ë¡œ ë³µì›
          this.state.currentFilter = prevFilter;
          
          if (filter === 'nearby') {
            Location.showError();
          }
        }
      }

      async setView(view) {
        if (this.state.currentView === view) return;
        
        // ë„¤ë¹„ê²Œì´ì…˜ UI ì—…ë°ì´íŠ¸
        const navContainer = DOMCache.get('navContainer');
        navContainer.querySelectorAll('.nav-item').forEach(item => {
          const isActive = item.dataset.view === view;
          item.setAttribute('aria-selected', isActive ? 'true' : 'false');
          if (isActive) {
            item.classList.add('active');
          } else {
            item.classList.remove('active');
          }
        });
        
        this.state.currentView = view;
        
        // ë·°ë³„ ì²˜ë¦¬
        switch(view) {
          case 'home':
            this.hideSettings();
            await this.setFilter('all');
            MapManager.hideMap();
            break;
            
          case 'saved':
            this.hideSettings();
            await this.setFilter('saved');
            MapManager.hideMap();
            break;
            
          case 'map':
            this.hideSettings();
            await MapManager.init();
            MapManager.showMap();
            if (this.state.userLocation) {
              MapManager.centerTo(this.state.userLocation);
            }
            this.showNearbyHint();
            Toast.show(T[LanguageManager.currentLang].mapViewTab || 'ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼');
            break;
            
          case 'settings':
            this.showSettings();
            break;
        }
      }

      handleSearch(e) {
        this.state.currentSearch = e.target.value.trim();
        
        // ê²€ìƒ‰ í´ë¦¬ì–´ ë²„íŠ¼ í‘œì‹œ
        const searchClear = DOMCache.get('searchClear');
        if (searchClear) {
          searchClear.classList.toggle('show', this.state.currentSearch.length > 0);
        }
        
        // URL ì—…ë°ì´íŠ¸
        Utils.updateUrlParam('q', this.state.currentSearch || null);
        
        this.applyFilters();
      }

      applyFilters() {
        if (this.state.isLoading) return;

        let processedCoupons = [...this.state.coupons];

        // --- 1ë‹¨ê³„: ì§€ì—­ í•„í„°ë§ ---
        if (this.state.currentRegion !== 'all') {
            processedCoupons = processedCoupons.filter(c => 
                c.region && c.region.includes(this.state.currentRegion)
            );
        }

        // --- 2ë‹¨ê³„: ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ---
        if (this.state.currentFilter !== 'all') {
            if (this.state.currentFilter === 'saved') {
                processedCoupons = processedCoupons.filter(c => this.state.saved.includes(c.id));
            } else if (this.state.currentFilter === 'nearby') {
                // 'ê·¼ì²˜'ëŠ” ì •ë ¬ì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” í•„í„°ë§í•˜ì§€ ì•ŠìŒ
            } else {
                // ì¼ë°˜ ì¹´í…Œê³ ë¦¬ í•„í„°
                processedCoupons = processedCoupons.filter(c => c.category === this.state.currentFilter);
            }
        }

        // --- 3ë‹¨ê³„: ê²€ìƒ‰ì–´ í•„í„°ë§ ---
        if (this.state.currentSearch) {
            const query = this.state.currentSearch.toLowerCase();
            processedCoupons = processedCoupons.filter(c => {
                const store = getCouponField(c, 'store').toLowerCase();
                const description = getCouponField(c, 'description').toLowerCase();
                const area = getCouponField(c, 'area', '').toLowerCase();
                return store.includes(query) || description.includes(query) || area.includes(query);
            });
        }

        // --- 4ë‹¨ê³„: ì •ë ¬ ì ìš© ---
        switch (this.state.currentSort) {
            case 'high_discount':
                processedCoupons.sort((a, b) => {
                    const discountA = this.parseDiscount(getCouponField(a, 'offer'));
                    const discountB = this.parseDiscount(getCouponField(b, 'offer'));
                    return discountB - discountA;
                });
                break;
            case 'latest':
                processedCoupons.sort((a, b) => (b.id || 0) - (a.id || 0));
                break;
            case 'by_area':
                processedCoupons.sort((a, b) => {
                    const areaA = getCouponField(a, 'area', '');
                    const areaB = getCouponField(b, 'area', '');
                    return areaA.localeCompare(areaB, LanguageManager.currentLang);
                });
                break;
        }
        
        // --- 'ê·¼ì²˜' í•„í„°ëŠ” í•­ìƒ ë§ˆì§€ë§‰ì— íŠ¹ë³„ ì •ë ¬ ---
        if (this.state.currentFilter === 'nearby' && this.state.userLocation) {
            processedCoupons.sort((a, b) => {
                const distA = Utils.distance(this.state.userLocation.lat, this.state.userLocation.lng, a.lat, a.lng);
                const distB = Utils.distance(this.state.userLocation.lat, this.state.userLocation.lng, b.lat, b.lng);
                return distA - distB;
            });
        }

        this.state.filtered = processedCoupons;
        this.render();
      }

      render() {
        this.renderCoupons();
        this.updateUI();
      }

      renderCoupons() {
        const grid = DOMCache.get('couponGrid');
        if (!grid) return;
        
        // ë¡œë”© ìƒíƒœ ì œê±°
        grid.classList.remove('loading');
        
        grid.innerHTML = '';
        
        if (this.state.filtered.length === 0) {
          this.renderNoResults();
          return;
        }
        
        const fragment = document.createDocumentFragment();
        this.state.filtered.forEach(coupon => {
          fragment.appendChild(createCard(coupon));
        });
        
        grid.appendChild(fragment);
      }

      renderNoResults() {
        const grid = DOMCache.get('couponGrid');
        const lang = LanguageManager.currentLang;
        const suggestions = T[lang].suggestions || ['æ¸‹è°·', 'æ–°å®¿', 'é›»æ°—å±‹'];
        
        const noResults = document.createElement('div');
        noResults.className = 'no-results';
        
        const icon = document.createElement('div');
        icon.className = 'no-results-icon';
        icon.textContent = 'ğŸ”';
        
        const title = document.createElement('div');
        title.className = 'no-results-title';
        title.textContent = T[lang].notFound || 'ã‚¯ãƒ¼ãƒãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
        
        const desc = document.createElement('div');
        desc.className = 'no-results-desc';
        desc.textContent = T[lang].notFoundDesc || 'æ¤œç´¢æ¡ä»¶ã‚’å¤‰ãˆã¦ãã ã•ã„';
        
        const chips = document.createElement('div');
        chips.className = 'suggestion-chips';
        
        // ì•ˆì „í•œ suggestion chip ìƒì„±
        suggestions.forEach(s => {
          const chip = document.createElement('button');
          chip.className = 'suggestion-chip';
          chip.dataset.suggestion = s;
          chip.textContent = s;
          chips.appendChild(chip);
        });
        
        noResults.appendChild(icon);
        noResults.appendChild(title);
        noResults.appendChild(desc);
        noResults.appendChild(chips);
        
        grid.appendChild(noResults);
      }

      updateUI() {
        // ì§€ë„ ë§ˆì»¤ ì—…ë°ì´íŠ¸
        if (window.mapInstance) {
          MapManager.renderMarkers();
        }
        
        // ëª¨ë°”ì¼ ì¶”ì²œ ì—…ë°ì´íŠ¸
        MobileUIManager.updateSuggestion();
      }

      updateSavedCount() {
        const count = this.state.saved.length;
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë±ƒì§€
        const navBadge = DOMCache.get('navBadge');
        if (navBadge) {
          navBadge.textContent = count;
          navBadge.classList.toggle('show', count > 0);
        }
        
        // í•„í„°ì˜ saved ì¹´ìš´íŠ¸
        const savedCount = DOMCache.get('savedCount');
        if (savedCount) {
          savedCount.textContent = count;
          savedCount.classList.toggle('show', count > 0);
        }
      }

      updateFilterCounts() {
        // ì§€ì—­ë³„ ì¹´ìš´íŠ¸
        const regionCounts = {};
        regionCounts.all = this.state.coupons.length;
        
        this.state.coupons.forEach(coupon => {
          coupon.region?.forEach(region => {
            regionCounts[region] = (regionCounts[region] || 0) + 1;
          });
        });
        
        // ì¹´í…Œê³ ë¦¬ë³„ ì¹´ìš´íŠ¸
        const categoryCounts = {};
        categoryCounts.all = this.state.coupons.length;
        
        this.state.coupons.forEach(coupon => {
          if (coupon.category) {
            categoryCounts[coupon.category] = (categoryCounts[coupon.category] || 0) + 1;
          }
        });
        
        // ëª¨ë°”ì¼ í•„í„° íŒ¨ë„ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        document.querySelectorAll('#regionOptions .filter-option').forEach(option => {
          const region = option.dataset.region;
          const countEl = option.querySelector('.filter-count');
          if (countEl && regionCounts[region] !== undefined) {
            countEl.textContent = regionCounts[region];
          }
        });
        
        document.querySelectorAll('#categoryOptions .filter-option').forEach(option => {
          const category = option.dataset.category;
          const countEl = option.querySelector('.filter-count');
          if (countEl && categoryCounts[category] !== undefined) {
            countEl.textContent = categoryCounts[category];
          }
        });
      }

      updateFilterTexts() {
        // ëª¨ë°”ì¼ í•„í„° ìƒíƒœë°” í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const regionChip = DOMCache.get('mobileRegionChip');
        const categoryChip = DOMCache.get('mobileCategoryChip');
        
        if (regionChip) {
          const regionName = this.state.currentRegion === 'all' ? 
            t('all') : t(this.state.currentRegion);
          regionChip.textContent = `ğŸ“ ${regionName}`;
        }
        
        if (categoryChip) {
          let categoryName = t('all');
          if (this.state.currentFilter !== 'all') {
            const categoryMap = {
              'electronics': t('electronics'),
              'fashion': t('fashion'),
              'dining': t('dining'),
              'transport': t('transport'),
              'saved': t('saved'),
              'nearby': t('nearby')
            };
            categoryName = categoryMap[this.state.currentFilter] || this.state.currentFilter;
          }
          categoryChip.textContent = `ğŸ·ï¸ ${categoryName}`;
        }
      }

      async requestLocation() {
        if (this.state.isLoading) return;
        
        this.state.isLoading = true;
        
        try {
          this.state.userLocation = await Location.request();
          Location.hideError();
          
          // ì§€ë„ ì—…ë°ì´íŠ¸
          if (window.mapInstance) {
            MapManager.updateLocation();
          }
          
          // nearby í•„í„°ê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì¬ì •ë ¬
          if (this.state.currentFilter === 'nearby') {
            this.applyFilters();
          }
          
        } catch (error) {
          Location.showError();
        } finally {
          this.state.isLoading = false;
        }
      }

      toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        StorageManager.setTheme(isDark);
        
        const lang = LanguageManager.currentLang;
        Toast.show(isDark ? T[lang].darkMode : T[lang].lightMode, 1000);
      }

      // ì—ëŸ¬ ì²˜ë¦¬
      handleInitError(error) {
        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        this.state.hasError = true;
        this.showErrorState(error);
      }

      // UI ìƒíƒœ ê´€ë¦¬
      showLoadingState() {
        document.body.classList.add('loading');
      }

      hideLoadingState() {
        document.body.classList.remove('loading');
      }

      showErrorState(error) {
        const grid = DOMCache.get('couponGrid');
        if (grid) {
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = 'grid-column:1/-1;text-align:center;padding:2rem;';
          
          const title = document.createElement('h2');
          title.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤';
          
          const desc = document.createElement('p');
          desc.textContent = error.message;
          
          const retryBtn = document.createElement('button');
          retryBtn.className = 'btn btn-primary';
          retryBtn.textContent = 'ìƒˆë¡œê³ ì¹¨';
          retryBtn.onclick = () => location.reload();
          
          errorDiv.appendChild(title);
          errorDiv.appendChild(desc);
          errorDiv.appendChild(retryBtn);
          
          grid.innerHTML = '';
          grid.appendChild(errorDiv);
        }
      }

      showNearbyHint() {
        const hint = DOMCache.get('nearbyHint');
        if (hint) hint.classList.add('show');
      }

      hideNearbyHint() {
        const hint = DOMCache.get('nearbyHint');
        if (hint) hint.classList.remove('show');
      }

      showSettings() {
        // ì¿ í° ê·¸ë¦¬ë“œ ìˆ¨ê¸°ê¸°
        const grid = DOMCache.get('couponGrid');
        const settingsView = DOMCache.get('settingsView');
        
        if (grid) grid.style.display = 'none';
        if (settingsView) {
          settingsView.classList.add('show');
          
          // í˜„ì¬ ì„¤ì • ìƒíƒœ ì—…ë°ì´íŠ¸
          const settingsLang = DOMCache.get('settingsLang');
          if (settingsLang) {
            settingsLang.value = LanguageManager.currentLang;
          }
          
          const settingsTheme = DOMCache.get('settingsTheme');
          if (settingsTheme) {
            settingsTheme.textContent = document.body.classList.contains('dark-mode') ? 
              T[LanguageManager.currentLang].darkMode : T[LanguageManager.currentLang].lightMode;
          }
        }
        
        // ì§€ë„ ìˆ¨ê¸°ê¸°
        MapManager.hideMap();
        
        // ê²€ìƒ‰/í•„í„° ë°” ìˆ¨ê¸°ê¸°
        const searchFilterBar = document.querySelector('.search-filter-bar');
        if (searchFilterBar) searchFilterBar.style.display = 'none';
        
        // ëª¨ë°”ì¼ í•„í„° ìƒíƒœë°” ìˆ¨ê¸°ê¸°
        const filterStatusBar = DOMCache.get('filterStatusBar');
        if (filterStatusBar) filterStatusBar.style.display = 'none';
      }
      
      hideSettings() {
        const grid = DOMCache.get('couponGrid');
        const settingsView = DOMCache.get('settingsView');
        const searchFilterBar = document.querySelector('.search-filter-bar');
        const filterStatusBar = DOMCache.get('filterStatusBar');
        
        if (grid) grid.style.display = '';
        if (settingsView) settingsView.classList.remove('show');
        if (searchFilterBar) searchFilterBar.style.display = '';
        if (filterStatusBar && MobileUIManager.isMobile) filterStatusBar.style.display = 'flex';
      }

      // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      handleResize() {
        // ë°˜ì‘í˜• ì²˜ë¦¬
      }
    }

    // ===========================================
    // ì „ì—­ í•¨ìˆ˜ë“¤ (í˜¸í™˜ì„±)
    // ===========================================
    window.retryMap = () => MapManager.init();
    window.getCouponField = getCouponField;
    window.showCardDetail = showCardDetail;

    // ===========================================
    // ì´ˆê¸°í™”
    // ===========================================
    let app;

    document.addEventListener('DOMContentLoaded', async () => {
      app = new JKWalletApp();
      window.app = app; // ì „ì—­ ì ‘ê·¼ìš©
      await app.init();
    });

    // ===========================================
    // Service Worker ë“±ë¡ (PWA ì§€ì›)
    // ===========================================
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(err => {
          console.log('ServiceWorker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
