<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japankuru クーポンページ (最終統合版)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <style>
    /* --- 기본 & 테마 설정 --- */
    :root {
  --primary-color: #007bff;
  --danger-color: #d90429;
  --save-color: #ffc107;
  --dark-blue: #1a2c4e;
  --card-bg: #fff;
  --light-gray: #f0f2f5;
  --border-color: #d1d9e6;
  --tag-bg: #e7f1ff;
  --tag-color: #004aad;
  --tag-border: #b3d4ff;
  --subtle-text: #666;
  --flip-btn-bg: #e9ecef;
  --flip-btn-color: #555;
}
body.dark-mode {
  --light-gray: #121212;
  --card-bg: #1e1e1e;
  --dark-blue: #2c3e50;
  --border-color: #444;
  --tag-bg: #2a3a5e;
  --tag-color: #a7c5ff;
  --tag-border: #3f517a;
  --subtle-text: #aaa;
  --flip-btn-bg: #343a40;
  --flip-btn-color: #f1f3f5;
}

/* --------------------------------------------------
   RESET & BASE TYPOGRAPHY
-------------------------------------------------- */
body {
  background: #f5f6fa;
  color: #222;
  font-family: 'SF Pro Display', 'Noto Sans JP', 'Helvetica Neue', Arial, sans-serif;
  letter-spacing: 0.02em;
  font-size: 17px;
}
a { color: inherit; text-decoration: none; }
a:hover { text-decoration: underline; }

/* --------------------------------------------------
   HEADER / HERO SECTION
-------------------------------------------------- */
.site-header-hero {
  position: relative;
  background-image: linear-gradient(rgba(26,44,78,0.68), rgba(26,44,78,0.75)), url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?auto=format&fit=crop&w=2070&q=80');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  color: #fff;
  text-align: center;
  padding: 28px 10px 96px 10px;
  box-shadow: 0 2px 28px 0 rgba(30,50,90,0.04);
  overflow: hidden;
}
.nav-row, .nav-container {
  max-width: 1200px; margin: 0 auto; display: flex;
  justify-content: space-between; align-items: center; position: relative; z-index: 2;
}
.nav-logo-link img { height: 35px; display: block; filter: brightness(0) invert(1);}
.theme-switcher { display: flex; align-items: center; gap: 8px; color: white;}
.theme-toggle { width: 40px; height: 20px; background:rgba(255,255,255,0.4); border-radius: 10px; position: relative; cursor:pointer;}
.theme-toggle::before { content: ''; position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top:2px; left:2px; transition:transform 0.3s;}
body.dark-mode .theme-toggle::before { transform: translateX(20px);}
.hero-content {
  margin-top: 60px;
  background: rgba(255,255,255,0.11);
  border-radius: 32px;
  padding: 34px 34px 30px 34px;
  box-shadow: 0 8px 28px rgba(0,20,60,0.10);
  display: inline-block;
  position: relative;
  z-index: 2;
  animation: fadeInUp .9s cubic-bezier(.22,.68,.38,1.08);
}
.hero-content h1 {
  font-family: 'SF Pro Display', 'Noto Serif JP', serif;
  font-size: 2.9em; font-weight: 900; margin: 24px 0 10px 0;
  letter-spacing: 0.05em; line-height: 1.12; color: #fff;
  text-shadow: 0 3px 18px rgba(24, 24, 48, 0.24);
  animation: heroPop .8s .13s cubic-bezier(.27,.95,.51,1.3) backwards;
}
.hero-content b { color: #ffc107; }
.hero-sub { font-size: 1.15em; margin-top: 10px; opacity:.98; }
.hero-sub .sparkle { animation: sparkleAnim 2.3s infinite; display:inline-block; }
@keyframes sparkleAnim { 0%{opacity:0.2} 48%{opacity:1;} 100%{opacity:0.2;} }
@keyframes heroPop {
  from { opacity:.3; transform: scale(.95);}
  to { opacity:1; transform: scale(1);}
}
@keyframes fadeInUp { 0%{opacity:0;transform:translateY(22px);} 100%{opacity:1;transform:translateY(0);} }
.hero-content .hero-coupon-badge {
  display: inline-block;
  background: linear-gradient(90deg,#ffc107 0%,#ff5858 100%);
  color: #fff; border-radius: 16px; padding: 5px 22px; margin-bottom: 8px;
  font-size: 19px; font-weight: 800; letter-spacing: .02em;
  box-shadow: 0 2px 12px rgba(255,96,40,0.15);
  transform: rotate(-4deg); margin-right: 12px;
  animation: badgeSlide .7s .15s cubic-bezier(.5,1.7,.7,1.1) backwards;
}
@keyframes badgeSlide {
  from { transform: translateX(-120px) scale(.98) rotate(-7deg); opacity: 0;}
  to   { transform: translateX(0) scale(1) rotate(-4deg); opacity: 1;}
}
.hero-search-form {
  margin-top: 25px;
  position: relative;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.hero-search-form input {
  width: 100%;
  padding: 20px 60px 20px 25px;
  font-size: 18px;
  border-radius: 50px;
  border: 1px solid rgba(255,255,255,0.2);
  background-color: rgba(255, 255, 255, 0.95);
  color: #333;
  box-sizing: border-box;
  box-shadow: 0 1.5px 10px rgba(20,50,100,0.10);
}
.hero-search-form .search-icon {
  position: absolute;
  right: 25px;
  top:50%;
  transform:translateY(-50%);
  font-size: 20px;
  color: #888;
}
body.dark-mode {
  --light-gray: #121212;
  --card-bg: #1e1e1e;
  --dark-blue: #e1e9f4; /* 더 밝은 색으로 변경하여 대비 확보 */
  /* ... 나머지 변수 ... */
}
/* --------------------------------------------------
   PICKUP SPECIAL COUPON AREA
-------------------------------------------------- */
.pickup-special-section {
  padding: 60px 20px;
  max-width: 1200px;
  margin: 0 auto;
}
.pickup-title-wrapper {
  text-align: center;
  margin-bottom: 40px;
}
.pickup-title {
  font-family: 'Noto Serif JP', serif;
  font-size: 2.5em;
  font-weight: 900;
  color: var(--dark-blue);
  margin: 0 0 10px 0;
  letter-spacing: 0.02em;
  position: relative;
  padding-bottom: 20px;
}
.pickup-title::after {
  content: '';
  position: absolute;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  width: 70px;
  height: 4px;
  background: linear-gradient(90deg, #ffc107, #ff8c2f);
  border-radius: 2px;
}
body.dark-mode .pickup-title { color: #fff; }
.pickup-subtitle {
  font-size: 1.1em;
  color: var(--subtle-text);
  max-width: 600px;
  margin: 0 auto;
}
.pickup-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  grid-template-rows: auto auto;
  gap: 25px;
}
.pickup-card {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  color: #fff;
  box-shadow: 0 8px 28px rgba(30, 50, 90, 0.18);
  transition: transform 0.3s cubic-bezier(.22,.68,.38,1.08), box-shadow 0.3s ease;
  cursor: pointer;
}
.pickup-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 14px 36px rgba(40, 60, 120, 0.22);
}
.pickup-card img {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; object-fit: cover;
  transition: transform 0.4s ease;
}
.pickup-card:hover img { transform: scale(1.05); }
.pickup-overlay {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  background: linear-gradient(180deg, rgba(0,0,0,0) 20%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.8) 100%);
  z-index: 1;
}
.pickup-card:hover .pickup-overlay {
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.15) 0%, rgba(0, 0, 0, 0.5) 40%, rgba(0, 0, 0, 0.9) 100%);
}
.pickup-content {
  position: relative; z-index: 2;
  padding: 25px; display: flex; flex-direction: column;
  justify-content: flex-end; height: 100%;
  box-sizing: border-box; text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}
.pickup-badge {
  display: inline-block; align-self: flex-start;
  padding: 6px 14px; border-radius: 14px;
  font-size: 13px; font-weight: 700; margin-bottom: 12px;
  background-color: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
  background: #f7f8fa;
  color: #0066ff;
  border: 1.2px solid #d0e2ff;
  border-radius: 30px;
  font-weight: 700;
}
.pickup-badge.best-pick { background: linear-gradient(90deg, #ffc107, #ff8c2f); color: #fff; }
.pickup-badge.hot-pick { background: linear-gradient(90deg,#ff2f63 0%,#ff8c2f 100%); color: #fff; }
.pickup-card h3, .pickup-card h4 { margin: 0 0 5px 0; font-weight: 800; line-height: 1.3; }
.main-pick .pickup-content h3 { font-size: 2em; }
.sub-pick .pickup-content h4 { font-size: 1.4em; }
.pickup-offer { margin: 0 0 15px 0; font-size: 1.1em; opacity: 0.9; }
.pickup-btn {
  color: #fff; text-decoration: none; font-weight: 700;
  align-self: flex-start; background: rgba(255,255,255,0.25);
  padding: 8px 18px; border-radius: 20px; transition: background-color 0.2s;
}
.pickup-btn:hover { background: rgba(255,255,255,0.4); }
.main-pick { grid-column: 1 / 2; grid-row: 1 / 3; min-height: 500px; }
.sub-pick { grid-column: 2 / 3; }
@media (max-width: 900px) {
  .pickup-grid { grid-template-columns: 1fr; }
  .main-pick, .sub-pick { grid-column: 1 / -1; }
  .main-pick { min-height: 400px; }
  .sub-pick { min-height: 250px; }
}
@media (max-width: 600px) { .pickup-title { font-size: 2em; } }

/* --------------------------------------------------
   카드/쿠폰 공통 (리스트/상세/플립)
-------------------------------------------------- */
.coupon-card-scene { width: 320px; max-width:100vw; aspect-ratio: 2/3.7; perspective: 1000px; border-radius: 20px; border: 1.5px solid #e5eaf2;}
body.dark-mode .coupon-card-scene { border: 1.5px solid #364366; }
.coupon-card { width: 100%; height: 100%; position: relative; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; box-shadow: 0 8px 24px rgba(30,40,90,0.14), 0 1.5px 8px rgba(30,40,90,0.07);}
.coupon-card:hover {
  box-shadow: 0 14px 36px rgba(40,60,120,0.18), 0 2px 12px rgba(40,60,120,0.10);
  transform: translateY(-2px) scale(1.025);
}
.coupon-card {
  transform-style: preserve-3d;
}
.card-face--front,
.card-face--back {
  backface-visibility: hidden;
}
.coupon-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 32px 24px;
}
.filter-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
}

.coupon-card:active { filter: brightness(.95); }
.coupon-card-scene.is-flipped .coupon-card { transform: rotateY(180deg); box-shadow: 0 14px 48px rgba(60,100,220,0.16);}
.coupon-card-scene.is-expired { opacity: 0.6; filter: grayscale(80%);}
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: linear-gradient(135deg, var(--card-bg) 85%, #f5f7fa 100%); border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); display: flex; flex-direction: column; overflow: hidden; transition: box-shadow .5s cubic-bezier(.22,.61,.36,1);}
body.dark-mode .card-face { background: linear-gradient(135deg, var(--card-bg) 85%, #22262d 100%);}
.card-face--back { transform: rotateY(180deg); padding: 20px; justify-content: space-between;}
.card-face--front:hover .card-image-wrapper img { transform: scale(1.05); }
.card-face--back, .card-face--front { transition: filter .6s cubic-bezier(.44,1.42,.58,1);}
.card-image-wrapper { width: 100%; aspect-ratio: 4/3; position: relative; overflow: hidden; background: #eee; flex-shrink: 0;}
.card-image-wrapper img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; transition: transform 0.4s ease;}
.card-image-wrapper::after {
  content: "";
  position: absolute; left: 0; top: 0; width: 100%; height: 100%;
  background: linear-gradient(120deg, rgba(0,0,0,0.12) 20%, rgba(20,100,220,0.13) 100%);
  opacity: .72; pointer-events: none; transition: opacity .3s;
}
.card-face--front:hover .card-image-wrapper::after { opacity: .32; }
.card-content { padding: 20px; text-align: center; flex-grow:1; display:flex; flex-direction:column;}
.card-store-name { font-size: 20px; font-weight: bold; margin: 0 0 10px 0; }
.card-offer { font-size: 32px; font-weight: 800; color: var(--danger-color); margin: 0 0 15px 0; }
.card-description { font-size: 15px; color: var(--subtle-text); margin: 0 0 15px 0; flex-grow: 1;}
.card-tags { margin-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;}
.tag {
  background: var(--tag-bg); color: var(--tag-color); border: 1px solid var(--tag-border); font-size: 13px;
  font-weight: 600; padding: 4px 10px; border-radius: 12px; border-width: 2px; letter-spacing: .01em;
}
.expiring-badge { position: absolute; top: 15px; right: -15px; background-color: #e74c3c; color: white; padding: 5px 30px; font-size: 14px; font-weight: bold; transform: rotate(45deg); z-index: 6; opacity: 0; transition: opacity .3s; pointer-events: none;
  background: linear-gradient(90deg, #ff2f63 0%, #ff8c2f 100%);
  box-shadow: 0 2px 8px rgba(255,30,70,0.14);
  animation: badgeShake .6s infinite alternate;
}
.coupon-card-scene.is-expiring .expiring-badge { opacity: 1; }
@keyframes badgeShake { 0% { transform: rotate(42deg) scale(1);} 70% { transform: rotate(48deg) scale(1.08);} 100% { transform: rotate(45deg) scale(1);} }
.card-expiry { font-size: 14px; font-weight: 600; color: var(--subtle-text); margin-top: 10px;}
.card-cta-button {
  border-radius: 18px;
  background: linear-gradient(90deg, #278cff 0%, #004aad 100%);
  box-shadow: 0 2px 6px rgba(40,80,220,0.12);
  font-size: 20px;
  font-weight: 900;
  padding: 17px 0;
  letter-spacing: 0.01em;
  transition: background .18s;
  display: flex; align-items: center; justify-content: center; gap: 10px; color: #fff; text-align: center; text-decoration: none; margin-top: auto;
}
.card-cta-button:hover { background: linear-gradient(90deg, #185abc 0%, #278cff 100%); opacity: .93; }
.save-btn { position: absolute; top: 10px; right: 10px; z-index: 5; background: rgba(0,0,0,0.4); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;}
.save-btn.is-saved { background: var(--save-color); color: white;}
.coupon-card-scene .save-btn.is-saved ~ .coupon-card { box-shadow: 0 0 0 3px #ffd75699; }
.distance-badge {
  position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
  z-index: 10; background: rgba(0,0,0,0.7); color: #fff; border-radius: 20px;
  padding: 6px 18px; font-size: 15px; font-weight: 700; box-shadow: 0 2px 8px rgba(0,0,0,0.1); letter-spacing: 0.02em;
}
.card-category-icon { position: absolute; top: 10px; left: 10px; z-index: 5; background: rgba(0,0,0,0.4); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; }
.back-qr-code { text-align: center; margin-bottom: 10px;}
.back-qr-code img { max-width: 120px; border-radius: 8px;}
.back-map-wrapper { width: 100%; aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; margin-bottom: 10px;}
.back-map-wrapper iframe { width: 100%; height: 100%; border: 0;}
body.dark-mode .back-map-wrapper iframe { filter: invert(1) hue-rotate(200deg) brightness(0.9) contrast(1.2);}
.back-section { margin-bottom: 10px; text-align: left;}
.back-section h4 { font-size: 13px; color: #999; margin: 0 0 5px 0; text-transform: uppercase; border-bottom: 1px solid var(--border-color); padding-bottom: 3px;}
.back-info-list { list-style: none; padding: 0; margin: 0; font-size: 14px; color: var(--subtle-text);}
.back-info-list li { margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; }
.back-info-list a { color: var(--primary-color); text-decoration: none; font-weight: bold; margin-left: 5px; white-space: nowrap; }
.details-link-wrapper { margin-top: 15px; text-align: right;}
.details-link { font-size: 14px; font-weight: bold; color: var(--primary-color); text-decoration: none; }
.back-actions { display: flex; gap: 10px; margin-top: auto; }
.action-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer;}
.share-btn { background: #ffc107; color: #333;}
.flip-back-btn { background: var(--flip-btn-bg); color: var(--flip-btn-color);}
body.dark-mode { background: linear-gradient(135deg, #181c27 0%, #27324a 100%);}
@media (max-width: 600px) {
  .coupon-card-scene { margin-bottom: 24px; }

  .list-title { font-size: 1.5em; }
}
.coupon-card {
  width: 100%; height: 100%;
  position: relative;
  cursor: pointer;
  transition: transform 0.8s;
  transform-style: preserve-3d;
  box-shadow: 0 8px 24px rgba(30,40,90,0.14), 0 1.5px 8px rgba(30,40,90,0.07);
}
/* hover, is-flipped 등은 별도 */
.coupon-card:hover { /* … */ }
.coupon-card-scene.is-flipped .coupon-card {
  transform: rotateY(180deg);
}
.card-face {
  position: absolute;
  width: 100%; height: 100%;
  backface-visibility: hidden;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  display: flex; flex-direction: column;
  overflow: hidden;
  transition: box-shadow .5s cubic-bezier(.22,.61,.36,1);
  /* background 는 변수 기반으로 하나만 */
  background: linear-gradient(135deg, var(--card-bg) 85%, #f5f7fa 100%);
}
.card-face--back { transform: rotateY(180deg); }

/* すべての画面幅でカテゴリエリアを中央寄せに */
.filter-sort-wrapper {
  display: flex;           /* 横並び */
  flex-wrap: wrap;         /* 複数行に折り返し */
  justify-content: center; /* 中央寄せ */
  gap: 10px 16px;          /* ボタン間の余白（お好みで調整） */
  margin-top: 12px;        /* 上段（周辺／保存済み）との隙間 */
  align-self: stretch;
    /* 1) 부모 너비 꽉 채우기 */
    width: 100% !important;
  /* 2) flex 아이템으로 늘어나기 */
  flex: 1 1 auto !important;
  /* 3) 부모의 align-items:center 에도 가로 폭을 유지하게 */
  align-self: stretch !important;
}

/* 上段のボタン群と分離するため、controls-container の設定はそのまま残しつつ… */
.controls-container {
  display: flex;
  flex-direction: column;  /* 上段と下段を縦積みに */
  align-items: stretch;     /* 子要素(filter-sort-wrapper)を横いっぱいに広げる */
  gap: 16px;               /* 上段⇔下段の距離 */
  margin-bottom: 40px;
}

/* --------------------------------------------------
   CONDITION BAR & FILTER/SORT
-------------------------------------------------- */
.cond-bar {
  display: flex; flex-wrap: wrap; gap: 15px;
  background: #f8fafc; color: #31547e;
  border-radius: 10px; padding: 10px 24px;
  margin: 20px 0 18px 0; font-size: 15px; align-items: center;
}
.cond-bar b, .cond-bar .active { color: var(--primary-color);}
.cond-bar .reset-btn { margin-left: 10px; background: var(--primary-color); color: #fff; border: none; border-radius: 20px; padding: 5px 18px; font-size: 15px; cursor: pointer;}

.filter-group { display: flex; gap: 10px; flex-wrap: wrap; align-items: center;}
.filter-group + .filter-group::before { content: '|'; color: #d1d9e6; margin-right: 10px; }
.filter-btn {
  background-color: var(--card-bg); border: 1px solid var(--border-color);
  border-radius: 20px; padding: 10px 20px; font-size: 16px; font-weight: 600;
  color: var(--text-color); cursor: pointer; transition: all 0.3s ease; display: flex; gap: 8px; align-items: center;
}
.filter-btn .count { font-size: 14px; color: #888; }
.filter-btn.active {
  background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color);
}
.filter-btn.active .count { color: rgba(255,255,255,0.8); }
body.dark-mode .filter-btn { color: #eee; background: var(--card-bg); border-color: var(--border-color);}
body.dark-mode .filter-btn.active { color: #fff; background: var(--primary-color); border-color: var(--primary-color);}
.sort-controls select {
  padding: 10px 15px; border-radius: 20px; border: 1px solid var(--border-color);
  background: var(--card-bg); color: var(--text-color); font-size: 16px; font-weight: 600; cursor: pointer;
}
.view-switcher { display: flex; background-color: var(--border-color); border-radius: 20px; padding: 4px; align-self: center;}
.view-btn {
  border: none; background-color: transparent; padding: 6px 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer;
  display: flex; align-items: center; gap: 8px; color: var(--subtle-text); transition: all 0.3s;
}
.view-btn.active {
  background-color: var(--card-bg); color: var(--primary-color);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
/* --- SWIPER SLIDE 너비/패딩/오버플로우 --- */
.coupon-container {
  overflow-x: auto;
  padding-bottom: 90px;
}
.swiper {
  width: 100% !important;
  padding-bottom: 50px !important;
  overflow: visible !important;
  /*display: flex;*/
  justify-content: center;
  touch-action: pan-y;
}
.swiper-wrapper {
  padding: 0 !important;
}
.swiper-slide {
  flex-shrink: 0;
  width: 300px;
  display: flex;
  justify-content: center;
}

body {
  margin-bottom: 100px;
}
.site-footer {
  margin-top: 70px;
}
.swiper-button-prev, .swiper-button-next {
  z-index: 10;
  top: 45%;
  transform: translateY(-50%);
}
/* Swiper invisible */
.swiper-slide.swiper-slide-invisible {
  visibility: hidden !important;
  pointer-events: none !important;
  opacity: 0 !important;
  width: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
}
html, body {
  overflow-x: hidden;
}

/* --------------------------------------------------
   LIST TITLE
-------------------------------------------------- */
.list-title-wrapper { text-align: center; margin-bottom: 30px; }
.list-title {
  display: inline-block; padding: 12px 30px; background-color: var(--card-bg);
  color: var(--dark-blue); font-size: 1.8em; font-weight: 800; border-radius: 30px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); letter-spacing: 0.03em;
}
body.dark-mode .list-title { color: var(--dark-blue);}
@media (max-width: 600px) { .list-title { font-size: 1.5em; } }

/* --------------------------------------------------
   MINI FEATURE (THEMED) SECTION
-------------------------------------------------- */
.themed-feature-section { max-width: 1200px; margin: 40px auto; padding: 40px 20px; background-color: var(--card-bg); border-radius: 20px;}
body.dark-mode .themed-feature-section { background-color: #272e3a; }
.themed-title { text-align: center; margin-bottom: 30px; }
.themed-title h4 {
  font-family: 'Noto Serif JP', serif;
  font-size: 2em; font-weight: 700; color: var(--dark-blue); margin: 0 0 10px 0;
}
.themed-title h4 span {
  font-size: 0.6em; font-weight: 700; color: #fff;
  background: var(--danger-color); padding: 4px 10px; border-radius: 12px; margin-right: 10px; vertical-align: middle;
}
.themed-title p { font-size: 1.1em; color: var(--subtle-text);}
.themed-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
.themed-card {
  display: block; text-decoration: none; border-radius: 15px; overflow: hidden;
  position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.themed-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
.themed-card img { width: 100%; height: 200px; object-fit: cover; }
.themed-card-content {
  position: absolute; bottom: 0; left: 0; right: 0; padding: 15px; color: #fff;
  background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
}
.themed-card-content h5 { margin: 0 0 2px 0; font-size: 1.2em; font-weight: 700; }
.themed-card-content p { margin: 0; font-size: 0.9em; opacity: 0.9; }
.themed-article-link {
  display: inline-block; margin-top: 15px; font-size: 1em; font-weight: 700; color: var(--primary-color); text-decoration: none;
  background-color: var(--tag-bg); padding: 8px 18px; border-radius: 20px; border: 1px solid var(--tag-border); transition: all 0.2s ease;
}
.themed-article-link:hover { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }

/* --------------------------------------------------
   에디터 코멘트
-------------------------------------------------- */
.editor-comment {
  background-color: rgba(0, 0, 0, 0.2); border-left: 4px solid var(--save-color);
  padding: 12px 15px; margin: 5px 0 20px 0; border-radius: 0 8px 8px 0; text-align: left;
}
.editor-comment i { margin-right: 8px; color: var(--save-color);}
.editor-comment span { font-size: 14px; line-height: 1.6; opacity: 0.95;}
.editor-comment b { font-weight: 800; }

/* --------------------------------------------------
   MAP / LEAFLET STYLE
-------------------------------------------------- */
#map-container { width: 100%; height: 600px; border-radius: 15px; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);}
.leaflet-popup-content-wrapper { border-radius: 8px; }
.leaflet-popup-content { margin: 10px; text-align: center;}
.leaflet-popup-content h4 { margin: 0 0 5px 0; font-size: 16px;}
.leaflet-popup-content p { margin: 0; color: var(--danger-color); font-weight: bold; }
body.dark-mode .back-map-wrapper iframe { filter: invert(1) hue-rotate(200deg) brightness(0.9) contrast(1.2);}

/* --------------------------------------------------
   FOOTER
-------------------------------------------------- */
.site-footer { background-color: var(--dark-blue); color: rgba(255, 255, 255, 0.7); padding: 50px 20px;}
.footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
.footer-logo img { filter: brightness(0) invert(1) opacity(0.7); height: 30px;}
.footer-about { max-width: 600px; margin: 20px auto; line-height: 1.6; }
.footer-links { margin: 20px 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; list-style: none; padding: 0;}
.footer-links a { color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 14px;}
.footer-links a:hover { color: #fff; }
.footer-copyright { font-size: 13px; margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 30px; }

/* --------------------------------------------------
   EMPTY STATE, TOAST NOTIFY, 기타
-------------------------------------------------- */
.empty-state { width: 100%; text-align: center; padding: 80px 20px; background: var(--card-bg); border-radius: 15px; margin-top:20px; display: none;}
.empty-state.show { display: block;}
.empty-state .fa-ghost { font-size: 48px; margin-bottom: 20px; color: #999;}
.empty-state h3 { font-size: 24px; color: var(--text-color);}
.empty-state p { font-size: 16px; color: var(--subtle-text); margin-bottom: 25px;}
.empty-state .reset-btn { background: var(--primary-color); color: #fff; border: none; border-radius: 20px; padding: 10px 25px; font-size: 16px; cursor: pointer;}
.toast-notification {
  position: fixed; bottom: 20px; right: 20px; background: var(--dark-blue); color: white; padding: 15px 25px;
  border-radius: 8px; z-index: 1001; opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(20px);
  display: flex; align-items: center; gap: 10px;
}
.toast-notification.show { opacity: 1; transform: translateY(0);}


/* 만약 좌/우에 기본 패딩이 있다면 제거 */
.swiper {
  padding-left: 0 !important;
  padding-right: 0 !important;
}


  </style>
</head>
<body>
    <header class="site-header-hero">
        <div class="nav-row">
            <a href="#" class="nav-logo-link">
              <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru Logo">
            </a>
            <div class="theme-switcher">
              <i class="fa-solid fa-sun"></i>
              <div class="theme-toggle"></div>
              <i class="fa-solid fa-moon"></i>
            </div>
          </div>

     
  <div class="hero-content">
    <h1>JAPANKURU <b>Special Coupon</b></h1>
    <div class="hero-search-form">
      <input type="search" id="coupon-search" placeholder="店名、地域、キーワードで検索 (例: 新宿、ラーメン)">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
    </div>
    <div class="hero-sub">
      <span>訪日観光の最新クーポン情報まとめ <span class="sparkle">✨</span></span>
    </div>
  </div>
</header>

      
    <div class="list-title-wrapper">
      <h2 class="list-title">🎟️ 全クーポンリストから探す</h2>
    </div>
    <div class="interaction-notice">💡 <b>ヒント:</b> 各カードをクリックすると、裏面の詳細情報とGoogleマップが確認できます！</div>
      <!-- [NEW] 조건바(필터/검색/정렬 상태표시) -->
      <div class="cond-bar" id="cond-bar" style="display:none;"></div>
      <div class="controls-container">
        <div class="view-switcher">
          <button class="view-btn active" data-view="list"><i class="fa-solid fa-list"></i> リスト</button>
          <button class="view-btn" data-view="map"><i class="fa-solid fa-map-location-dot"></i> 地図</button>
        </div>
      
        <div class="filter-sort-wrapper">
          <div class="filter-group">
            <button class="filter-btn" data-filter="nearby"><i class="fa-solid fa-location-arrow"></i> 周辺</button>
            <button class="filter-btn" data-filter="saved"><i class="fa-solid fa-star"></i> 保存済み <span class="count"></span></button>
          </div>
          <div class="filter-group">
            <button class="filter-btn active" data-filter="all"><i class="fa-solid fa-border-all"></i> すべて表示 <span class="count"></span></button>
            <button class="filter-btn" data-filter="electronics"><i class="fa-solid fa-laptop"></i> 家電 <span class="count"></span></button>
            <button class="filter-btn" data-filter="fashion"><i class="fa-solid fa-shirt"></i> ファッション <span class="count"></span></button>
            <button class="filter-btn" data-filter="dining"><i class="fa-solid fa-utensils"></i> グルメ <span class="count"></span></button>
            <button class="filter-btn" data-filter="transport"><i class="fa-solid fa-train-subway"></i> 交通 <span class="count"></span></button>
          </div>
          <div class="sort-controls">
            <select id="sort-select">
              <option value="default">標準の並び順</option>
              <option value="expiry">有効期限が近い順</option>
              <option value="discount">割引率の高い順</option>
            </select>
          </div>
        </div>
      </div>
      <div class="empty-state">
        <i class="fa-solid fa-ghost"></i>
        <h3>該当するクーポンが見つかりませんでした。</h3>
        <p>他の検索キーワードや条件をお試しください。</p>
        <button class="reset-btn">フィルター初期化</button>
      </div>
      <div id="map-container" style="display: none;"></div>
    <div class="swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide" data-original-order="1">
          <div class="coupon-card-scene" data-coupon-id="1" data-category="electronics" data-expiry="2025-12-31" data-lat="35.6908" data-lon="139.7028">
            <div class="expiring-badge">間もなく終了</div>
            <div class="card-category-icon"></div>
            <div class="distance-badge" style="display: none;"></div>
            <button class="save-btn"><i class="fa-regular fa-star"></i></button>
            <div class="coupon-card">
              <div class="card-face card-face--front">
                <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="KOJIMA Coupon"></div>
                <div class="card-content">
                  <h3 class="card-store-name">コジマ x ビックカメラ</h3>
                  <p class="card-offer">最大 17% OFF</p>
                  <p class="card-description">免税10% + 追加7%割引！最新の電子製品を安く手に入れよう。</p>
                  <div class="card-tags"><span class="tag">#新宿</span> <span class="tag">#免税</span> <span class="tag">#家電</span></div>
                  <p class="card-expiry">🕒 有効期間: 2025.12.31</p>
                </div>
                <div class="card-cta-button">✂️ クーポン裏面を見る</div>
              </div>
              <div class="card-face card-face--back">
                <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BIC2025" alt="QR Code"></div>
                <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T92"></iframe></div>
                <div class="back-section">
                  <h4>関連情報</h4>
                  <ul class="back-info-list">
                    <li><span>📍 住所: 東京都新宿区新宿3-29-1</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T93" target="_blank" rel="noopener noreferrer">経路案内</a></li>
                    <li><span>⏰ 営業時間: 毎日 10:00 - 22:00</span></li>
                    <li><span>✨ ヒント: 8階のゲームコーナーは人気！</span></li>
                  </ul>
                </div>
                <div class="details-link-wrapper"><a href="https://www.japankuru.com/en/shopping/e4200/" class="details-link" target="_blank">詳細情報を見る →</a></div>
                <div class="back-actions">
                  <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                  <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" data-original-order="2">
          <div class="coupon-card-scene" data-coupon-id="2" data-category="fashion" data-expiry="2025-07-30" data-lat="35.6603" data-lon="139.6983">
             <div class="expiring-badge">間もなく終了</div>
            <div class="card-category-icon"></div>
            <div class="distance-badge" style="display: none;"></div>
            <button class="save-btn"><i class="fa-regular fa-star"></i></button>
            <div class="coupon-card">
              <div class="card-face card-face--front">
                <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="JINS Coupon"></div>
                <div class="card-content">
                  <h3 class="card-store-name">JINS</h3>
                  <p class="card-offer">10% OFF</p>
                  <p class="card-description">日本の代表的なメガネブランドJINS！おしゃれなメガネを免税+割引で。</p>
                  <div class="card-tags"><span class="tag">#渋谷</span> <span class="tag">#メガネ</span></div>
                  <p class="card-expiry">🕒 有効期間: 2025.07.30</p>
                </div>
                <div class="card-cta-button">✂️ クーポン裏面を見る</div>
              </div>
              <div class="card-face card-face--back">
                <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-JINS2025" alt="QR Code"></div>
                <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T94"></iframe></div>
                <div class="back-section">
                  <h4>関連情報</h4>
                  <ul class="back-info-list">
                    <li><span>📍 住所: 東京都渋谷区宇田川町31-1</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T95" target="_blank" rel="noopener noreferrer">経路案内</a></li>
                    <li><span>⏰ 営業時間: 毎日 11:00 - 21:00</span></li>
                    <li><span>✨ ヒント: 最短30分で完成！</span></li>
                  </ul>
                </div>
                <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                <div class="back-actions">
                  <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                  <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="swiper-slide" data-original-order="3">
            <div class="coupon-card-scene" data-coupon-id="3" data-category="fashion" data-expiry="2025-09-30" data-lat="35.6705" data-lon="139.7073">
                <div class="expiring-badge">間もなく終了</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/img/img2024011517461371466800.jpg" alt="BEAMS Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">BEAMS JAPAN</h3>
                            <p class="card-offer">5% 追加割引</p>
                            <p class="card-description">日本の最新トレンドを発信するセレクトショップBEAMSで特別なアイテムを。</p>
                            <div class="card-tags"><span class="tag">#原宿</span><span class="tag">#ファッション</span></div>
                            <p class="card-expiry">🕒 有効期間: 2025.09.30</p>
                        </div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                       <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BEAMS25" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T96"></iframe></div>
                        <div class="back-section">
                          <h4>関連情報</h4>
                          <ul class="back-info-list">
                            <li><span>📍 住所: 東京都渋谷区神宮前3-24-7</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T97" target="_blank" rel="noopener noreferrer">経路案内</a></li>
                            <li><span>⏰ 営業時間: 毎日 11:00 - 20:00</span></li>
                            <li><span>✨ ヒント: 日本限定コラボ商品を探してみて。</span></li>
                          </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="4">
            <div class="coupon-card-scene" data-coupon-id="4" data-category="dining" data-expiry="2026-03-31" data-lat="35.6970" data-lon="139.7001">
                <div class="expiring-badge">間もなく終了</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="Samurai Restaurant Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">サムライレストラン</h3>
                            <p class="card-offer">ドリンク1杯無料</p>
                            <p class="card-description">華麗なショーと共に楽しむ特別な食事！クーポン提示でドリンクをゲット。</p>
                            <div class="card-tags"><span class="tag">#新宿</span><span class="tag">#エンタメ</span></div>
                            <p class="card-expiry">🕒 有効期間: 2026.03.31</p>
                        </div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                       <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-SAMURAI" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T98"></iframe></div>
                        <div class="back-section">
                            <h4>関連情報</h4>
                            <ul class="back-info-list">
                                <li><span>📍 住所: 東京都新宿区歌舞伎町2-45-8</span><a href="https://maps.app.goo.gl/wJkL8c2q8BwH8a8T99" target="_blank" rel="noopener noreferrer">経路案内</a></li>
                                <li><span>⏰ 営業時間: 毎日 18:00 - 23:30</span></li>
                                <li><span>✨ ヒント: 公演時間の30分前に到着がおすすめ！</span></li>
                            </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="5">
            <div class="coupon-card-scene" data-coupon-id="5" data-category="transport" data-expiry="9999-12-31" data-lat="35.6580" data-lon="139.7016">
                <div class="expiring-badge">間もなく終了</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png" alt="Tokyu Line Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">東急線</h3>
                            <p class="card-offer">1日乗車券</p>
                            <p class="card-description">東京旅行の必須アイテム！渋谷、自由が丘などを巡る東急線の1日乗車券。</p>
                            <div class="card-tags"><span class="tag">#渋谷</span><span class="tag">#交通</span><span class="tag">#乗り放題</span></div>
                            <p class="card-expiry">✅ 常時イベント</p>
                        </div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-TOKYU" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp0"></iframe></div>
                        <div class="back-section">
                            <h4>関連情報</h4>
                            <ul class="back-info-list">
                                <li><span>📍 交換場所: 渋谷駅など東急線の主要駅窓口</span></li>
                                <li><span>⏰ 利用時間: 始発から終電まで</span></li>
                                <li><span>✨ ヒント: 下北沢、自由が丘への旅行時に特に便利！</span></li>
                            </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="swiper-slide" data-original-order="6">
            <div class="coupon-card-scene" data-coupon-id="6" data-category="electronics" data-expiry="2025-11-30" data-lat="35.6984" data-lon="139.7745">
                <div class="expiring-badge">間もなく終了</div>
                <div class="card-category-icon"></div>
                <div class="distance-badge" style="display: none;"></div>
                <button class="save-btn"><i class="fa-regular fa-star"></i></button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png" alt="Yodobashi Camera Coupon"></div>
                        <div class="card-content">
                            <h3 class="card-store-name">ヨドバシカメラ</h3>
                            <p class="card-offer">最大 15% OFF</p>
                            <p class="card-description">免税10% + VISAカード決済で5%追加割引！カメラ、家電、ゲームまで。</p>
                            <div class="card-tags"><span class="tag">#秋葉原</span><span class="tag">#免税</span><span class="tag">#ゲーム</span></div>
                            <p class="card-expiry">🕒 有効期間: 2025.11.30</p>
                        </div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-Yodobashi" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe loading="lazy" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp1"></iframe></div>
                        <div class="back-section">
                          <h4>関連情報</h4>
                          <ul class="back-info-list">
                            <li><span>📍 住所: 東京都千代田区神田花岡町1-1</span><a href="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.838384232375!2d139.6957246152583!3d35.66033498019999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188ca883442169%3A0xb3e0a1b3a1a396b2!2sJINS%20Shibuya%20Store!5e0!3m2!1sen!2sjp!4v1689745501103!5m2!1sen!2sjp2" target="_blank" rel="noopener noreferrer">経路案内</a></li>
                            <li><span>⏰ 営業時間: 毎日 09:30 - 22:00</span></li>
                            <li><span>✨ ヒント: フィギュアやアニメグッズは6階に集結！</span></li>
                          </ul>
                        </div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions">
                            <button class="action-btn share-btn"><i class="fa-solid fa-share-nodes"></i> 共有</button>
                            <button class="action-btn flip-back-btn"><i class="fa-solid fa-rotate-left"></i> 表面へ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>

  <section class="pickup-special-section">
    <div class="pickup-title-wrapper">
      <h2 class="pickup-title">🔥 Editor's Pick / 今週の特別セレクション</h2>
      <p class="pickup-subtitle">ジャパングル編集部が厳選した、今週最高のクーポンをお見逃しなく！</p>
    </div>
    <div class="pickup-grid">
      <div class="pickup-card main-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="メイン推薦クーポンイメージ" loading="eager" 
        fetchpriority="high">>
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge best-pick">🌟 BEST PICK</span>
          <h3>コジマ x ビックカメラ</h3>
          <p class="pickup-offer">税抜価格から最大7%追加割引</p>
          <div class="editor-comment">
            <i class="fa-solid fa-pen-nib"></i>
            <span><b>Editor's Tip:</b> 最新のノイズキャンセリングヘッドホンは、日本の店舗が世界で最も早く、そして安く手に入るチャンスです！</span>
          </div>
          <a href="#coupon-1" class="pickup-btn">今すぐチェック &rarr;</a>
        </div>
      </div>
  
      <div class="pickup-card sub-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="サブ推薦1イメージ">
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge">🔥 HOT</span>
          <h4>サムライレストラン</h4>
          <p class="pickup-offer">ウェルカムドリンク1杯無料</p>
          <a href="#coupon-4" class="pickup-btn">詳しく見る &rarr;</a>
        </div>
      </div>
  
      <div class="pickup-card sub-pick">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="サブ推薦2イメージ">
        <div class="pickup-overlay"></div>
        <div class="pickup-content">
          <span class="pickup-badge">✅ MUST-HAVE</span>
          <h4>JINS メガネ</h4>
          <p class="pickup-offer">免税 + 10%追加割引</p>
          <a href="#coupon-2" class="pickup-btn">詳しく見る &rarr;</a>
        </div>
      </div>
    </div>
  </section>


  <section class="themed-feature-section">
    <div class="themed-title">
      <h4><span>SPECIAL</span>夏の終わりのマストバイ</h4>
      <p>秋のトレンドを先取りするファッション・ビューティーアイテムをチェック！</p>
      <a href="/articles/summer-end-must-buy" class="themed-article-link">特集記事全体を見る &rarr;</a>
    </div>
    <div class="themed-grid">
      <a href="#coupon-id-for-item1" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2025/06/Canmake_Summer_Thumbnail02-1536x864.jpg" alt="아이템 1">
        <div class="themed-card-content">
          <h5>秋色コスメ</h5>
          <p>今だけの限定カラー</p>
        </div>
      </a>
      <a href="#coupon-id-for-item2" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2025/05/Vivienne-Westwood_CC32-800x533.jpg" alt="아이템 2">
        <div class="themed-card-content">
          <h5>軽量ジャケット</h5>
          <p>朝晩の気温差に</p>
        </div>
      </a>
      <a href="https://www.japankuru.com/ko/shopping/108691/" class="themed-card">
        <img src="https://japankuru.com/gld-kanri/data/uploads/2024/08/CONVERSE_CC08-1536x1024.jpg" alt="아이템 3">
        <div class="themed-card-content">
          <h5>新作スニーカー</h5>
          <p>旅の必須アイテム</p>
        </div>
      </a>
    </div>
  </section>

  <footer class="site-footer">
    <div class="footer-content">
      <a href="#" class="footer-logo">
        <img src="https://japankuru.com/gld-kanri/data/themes/japankuru/assets/images/logo.svg" alt="Japankuru Logo">
      </a>
      <p class="footer-about">日本のすべてを深く、面白く。Japankuruと共にする特別な旅行。</p>
      <ul class="footer-links">
        <li><a href="#">会社紹介</a></li>
        <li><a href="#">すべてのクーポン</a></li>
        <li><a href="#">お問い合わせ</a></li>
        <li><a href="#">プライバシーポリシー</a></li>
      </ul>
      <div style="margin-top:22px;">
        <a href="#"><img src="https://scdn.line-apps.com/n/line_add_friends/btn/ja.png" alt="Line" style="height:30px;vertical-align:middle;"></a>
        <span style="font-size:15px;margin-left:10px;">公式LINEで最新クーポン配信中！</span>
      </div>
      <div class="footer-copyright">© 2025 Japankuru. All Rights Reserved.</div>
    </div>
  </footer>
  <div id="toast" class="toast-notification"></div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- DOM 객체 ---
    const dom = {
      swiper: document.querySelector('.swiper'),
      swiperWrapper: document.querySelector('.swiper-wrapper'),
      controlsContainer: document.querySelector('.controls-container'),
      sortSelect: document.getElementById('sort-select'),
      searchInput: document.getElementById('coupon-search'),
      condBar: document.getElementById('cond-bar'),
      emptyState: document.querySelector('.empty-state'),
      themeToggle: document.querySelector('.theme-toggle'),
      allSlides: Array.from(document.querySelectorAll('.swiper-slide')),
      resetBtn: document.querySelector('.empty-state .reset-btn'),
      viewSwitcher: document.querySelector('.view-switcher'),
      mapContainer: document.getElementById('map-container'),
      swiperPagination: document.querySelector('.swiper-pagination'),
      swiperPrev: document.querySelector('.swiper-button-prev'),
      swiperNext: document.querySelector('.swiper-button-next'),
    };
    const state = {
      swiper: null,
      savedCouponIds: [],
      userLocation: null,
      map: null,
      mapMarkers: [],
      currentView: 'list',
      categoryIcons: {
        electronics: 'fa-solid fa-laptop',
        fashion: 'fa-solid fa-shirt',
        dining: 'fa-solid fa-utensils',
        transport: 'fa-solid fa-train-subway',
        default: 'fa-solid fa-tags'
      }
    };
  
// --- Swiper 초기화 ---
function initSwiper() {
// initSwiper() 안에서
state.swiper = new Swiper(dom.swiper, {
  // ① centeredSlides: true 유지
  centeredSlides: true,
  // ② slidesPerView: 기본값 1
  slidesPerView: 1,
  spaceBetween: 20,
  grabCursor: true,
  watchOverflow: true,
  pagination: { el: '.swiper-pagination', clickable: true },
  navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
  breakpoints: {
    // 모바일/태블릿에서도 한 장씩
    768: {
      slidesPerView: 1,
      spaceBetween: 20,
      centeredSlides: true,
    },
    // 데스크탑은 한 번에 세 장씩
    1024: {
      slidesPerView: 3,
      spaceBetween: 24,
      centeredSlides: true,
    }
  }
});
}

  
    // --- 지도 초기화 ---
    function initMap() {
      if (!dom.mapContainer) return;
      state.map = L.map(dom.mapContainer).setView([35.6895, 139.6917], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19, attribution: '© OpenStreetMap'
      }).addTo(state.map);
    }
  
    // --- 마커 동기화 ---
    function updateMapMarkers(visibleCards) {
      if (!state.map) return;
      state.mapMarkers.forEach(marker => marker.remove());
      state.mapMarkers = [];
      if (visibleCards.length === 0) return;
      const bounds = [];
      visibleCards.forEach(card => {
        const lat = card.dataset.lat, lon = card.dataset.lon;
        if (!lat || !lon) return;
        const marker = L.marker([parseFloat(lat), parseFloat(lon)]).addTo(state.map);
        bounds.push([parseFloat(lat), parseFloat(lon)]);
        const popupContent = `<h4>${card.querySelector('.card-store-name').textContent}</h4><p>${card.querySelector('.card-offer').textContent}</p>`;
        marker.bindPopup(popupContent);
        state.mapMarkers.push(marker);
      });
      if (bounds.length > 0) state.map.fitBounds(bounds, { padding: [50, 50] });
    }
  
    // --- 카드 세팅(저장, 플립, 공유, 아이콘) ---
    function setupCards() {
  dom.allSlides.forEach(slide => {
    const card = slide.querySelector('.coupon-card-scene');
    const cardElem = slide.querySelector('.coupon-card');
    // …saveBtn, shareBtn 설정 생략…

    // 카드 플립 (단, 뒤집기 해제 버튼/저장/공유는 제외)
    cardElem.onclick = e => {
      // 1) 저장 버튼, 2) 표면으로 버튼, 3) 공유 버튼 클릭 시엔 무시
      if (
           e.target.closest('.save-btn')   ||
           e.target.closest('.flip-back-btn') ||
           e.target.closest('.share-btn')
         ) {
        return;
      }
      card.classList.toggle('is-flipped');
    };

    // 뒷면 '표면으로' 버튼
    const flipBackBtn = slide.querySelector('.flip-back-btn');
    if (flipBackBtn) {
      flipBackBtn.innerHTML = '<i class="fa-solid fa-arrow-left"></i> 表面へ';
      flipBackBtn.onclick = e => {
        e.stopPropagation();
        card.classList.remove('is-flipped');
      }
    }
  
        // 공유 버튼
        const shareBtn = slide.querySelector('.share-btn');
        if (shareBtn) {
          shareBtn.innerHTML = '<i class="fa-solid fa-share-nodes"></i> 共有';
          shareBtn.onclick = async e => {
            e.stopPropagation();
            const title = card.querySelector('.card-store-name').textContent;
            const text = card.querySelector('.card-offer').textContent + ' ' + card.querySelector('.card-description').textContent;
            const url = location.href.split('#')[0] + '#coupon-' + card.dataset.couponId;
            if (navigator.share) {
              try {
                await navigator.share({ title, text, url });
                showToast('共有しました！');
              } catch {
                showToast('共有をキャンセルしました。');
              }
            } else {
              try {
                await navigator.clipboard.writeText(url);
                showToast('クーポンURLをコピーしました！');
              } catch {
                prompt('このURLをコピーして共有してください:', url);
              }
            }
          };
        }
  
        // 카테고리 아이콘
        const categoryIcon = slide.querySelector('.card-category-icon');
        if (categoryIcon) {
          const category = card.dataset.category;
          const iconClass = state.categoryIcons[category] || state.categoryIcons.default;
          categoryIcon.innerHTML = `<i class="${iconClass}"></i>`;
        }
      });
      updateSaveButtonsVisuals();
    }
  
    // 저장 버튼 시각화
    function updateSaveButtonsVisuals() {
      dom.allSlides.forEach(slide => {
        const card = slide.querySelector('.coupon-card-scene');
        const saveBtn = slide.querySelector('.save-btn');
        const couponId = card.dataset.couponId;
        if (state.savedCouponIds.includes(couponId)) {
          saveBtn.classList.add('is-saved');
          saveBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
        } else {
          saveBtn.classList.remove('is-saved');
          saveBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
        }
      });
    }
  
    // 저장/해제
    function toggleSaveCoupon(couponId) {
      const idx = state.savedCouponIds.indexOf(couponId);
      let msg = '';
      if (idx === -1) {
        state.savedCouponIds.push(couponId);
        msg = '保存済みに追加しました！';
      } else {
        state.savedCouponIds.splice(idx, 1);
        msg = '保存済みから削除しました。';
      }
      localStorage.setItem('japankuruSavedCoupons', JSON.stringify(state.savedCouponIds));
      updateSaveButtonsVisuals();
      updateFilterCounts();
      showToast(msg);
      updateView();
      // フィルター／ソート→再描画部分の最後に入れる
state.swiper.update();
state.swiper.slideTo(0, 0);
    }
  
    // --- 주변(거리순) 정렬 + 거리 뱃지 ---
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180, dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    function filterNearby() {
      if (!navigator.geolocation) {
        alert('お使いのブラウザは位置情報機能に対応していません。');
        return;
      }
      navigator.geolocation.getCurrentPosition(position => {
        const userLat = position.coords.latitude, userLon = position.coords.longitude;
        state.userLocation = [userLat, userLon];
        dom.allSlides.forEach(slide => {
          const card = slide.querySelector('.coupon-card-scene');
          const lat = parseFloat(card.dataset.lat), lon = parseFloat(card.dataset.lon);
          let distance = lat && lon ? calculateDistance(userLat, userLon, lat, lon) : 9999;
          card.dataset.distance = distance;
          // 거리 뱃지
          let distBadge = slide.querySelector('.distance-badge');
          if (!distBadge) {
            distBadge = document.createElement('div');
            distBadge.className = 'distance-badge';
            card.querySelector('.card-image-wrapper').appendChild(distBadge);
          }
          distBadge.textContent = `約${distance.toFixed(1)}km`;
          distBadge.style.display = '';
        });
        // 거리순 정렬
        dom.allSlides.sort((a, b) => {
          return (parseFloat(a.querySelector('.coupon-card-scene').dataset.distance) -
                  parseFloat(b.querySelector('.coupon-card-scene').dataset.distance));
        }).forEach(slide => dom.swiperWrapper.appendChild(slide));
        updateView();
      }, () => {
        alert('位置情報の取得に失敗しました。設定を確認してください。');
      });
    }
  
    // --- 필터 카운트 ---
// --- 필터 카운트 함수 교체
function updateFilterCounts() {
  dom.controlsContainer.querySelectorAll('.filter-btn').forEach(btn => {
    const filter = btn.dataset.filter;
    let count = 0;
    if (filter === 'all') {
      count = dom.allSlides.length;
    } else if (filter === 'saved') {
      count = dom.allSlides.filter(slide =>
        state.savedCouponIds.includes(slide.querySelector('.coupon-card-scene').dataset.couponId)
      ).length;
    } else if (filter === 'nearby') {
      count = dom.allSlides.length;
    } else {
      // 카테고리 필터일 때
      count = dom.allSlides.filter(slide =>
        slide.querySelector('.coupon-card-scene').dataset.category === filter
      ).length;
    }
    let cnt = btn.querySelector('.count');
    if (!cnt) {
      cnt = document.createElement('span');
      cnt.className = 'count';
      btn.appendChild(cnt);
    }
    cnt.textContent = ` (${count})`;
  });
}

    // --- 검색창: input/엔터/버튼 ---
    function setupSearchInput() {
      dom.searchInput.addEventListener('input', updateView);
      dom.searchInput.addEventListener('keydown', e => {
        if (e.key === 'Enter') updateView();
      });
      const searchBtn = document.querySelector('.hero-search-form button,.hero-search-form .search-icon');
      if (searchBtn) searchBtn.onclick = () => updateView();
    }
  
// --- 카드 목록/지도 필터링 & 정렬 ---
  function updateView() {
  const allSlides  = state.masterSlides;
  const activeBtn  = dom.controlsContainer.querySelector('.filter-btn.active');
  if (!activeBtn) return;
  const filter     = activeBtn.dataset.filter;
  const term       = dom.searchInput.value.trim().toLowerCase();
  const sortBy     = dom.sortSelect.value;

  // 1) 필터링
  let filtered = allSlides.filter(slide => {
    const c = slide.querySelector('.coupon-card-scene');
    if (term && !c.textContent.toLowerCase().includes(term)) return false;
    if (filter === 'saved'   && !state.savedCouponIds.includes(c.dataset.couponId)) return false;
    if (filter !== 'all' &&
        filter !== 'saved' &&
        filter !== 'nearby' &&
        c.dataset.category !== filter) return false;
    return true;
  });

  // 2) 정렬
  if (sortBy === 'expiry') {
    filtered.sort((a,b) =>
      a.querySelector('.coupon-card-scene').dataset.expiry
        .localeCompare(b.querySelector('.coupon-card-scene').dataset.expiry)
    );
  } else if (sortBy === 'discount') {
    const num = el => +(el.querySelector('.card-offer').textContent.match(/(\d+)/)||[0,0])[1];
    filtered.sort((a,b)=> num(b)-num(a));
  } else if (filter === 'nearby') {
    filtered.sort((a,b)=>{
      const da = +a.querySelector('.coupon-card-scene').dataset.distance||0;
      const db = +b.querySelector('.coupon-card-scene').dataset.distance||0;
      return da - db;
    });
  } else {
    filtered.sort((a,b)=> a.dataset.originalOrder - b.dataset.originalOrder);
  }

  // 3) Swiper 교체
  state.swiper.removeAllSlides();
  filtered.forEach(slide => {
    state.swiper.appendSlide(slide);
  });
  state.swiper.update();
  if (filtered.length) {
    state.swiper.slideTo(0, 0);
  }

  // 4) 빈 상태, 카운트, 지도 마커
  dom.emptyState.classList.toggle('show', filtered.length === 0);
  updateFilterCounts();
  if (state.currentView === 'map') {
    const cards = filtered.map(s => s.querySelector('.coupon-card-scene'));
    updateMapMarkers(cards);
  }
  // 5) 카드 내 버튼(저장/플립/공유) 이벤트 재설정
  setupCards();
}


    // --- 기타 유틸 ---
    function showToast(message) {
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.className = 'toast-notification';
        document.body.appendChild(toast);
      }
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1600);
    }
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('japankuruTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }
  
    // --- 이벤트 바인딩 ---
    function bindEventListeners() {
      // 뷰 전환
      dom.viewSwitcher.addEventListener('click', (e) => {
        const target = e.target.closest('.view-btn');
        if (!target || target.classList.contains('active')) return;
        dom.viewSwitcher.querySelector('.active').classList.remove('active');
        target.classList.add('active');
        state.currentView = target.dataset.view;
        const isMapView = state.currentView === 'map';
        dom.swiper.style.display = isMapView ? 'none' : 'block';
        dom.mapContainer.style.display = isMapView ? 'block' : 'none';
        dom.controlsContainer.style.marginBottom = isMapView ? '20px' : '40px';
        if (isMapView) {
          state.map.invalidateSize();
          updateView();
        }
      });
  
      // 필터 버튼
      
dom.controlsContainer.addEventListener('click', e => {
  const target = e.target.closest('.filter-btn');
  if (target && !target.classList.contains('active')) {
    // 기존 active 해제 (모든 필터)
    dom.controlsContainer.querySelectorAll('.filter-btn.active').forEach(btn => btn.classList.remove('active'));
    // 선택된 것만 active
    target.classList.add('active');
    // 주변필터는 별도
    if (target.dataset.filter === 'nearby') filterNearby();
    else updateView();
  }
});

  
      setupSearchInput();
  
      dom.sortSelect.addEventListener('change', updateView);
      dom.themeToggle.addEventListener('click', toggleTheme);
  
      // 조건 리셋
      const resetLogic = () => {
  dom.searchInput.value = '';
  dom.controlsContainer.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  dom.controlsContainer.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
  dom.sortSelect.value = 'default';
  updateView();
};

      dom.condBar && dom.condBar.addEventListener('click', e => { if (e.target.classList.contains('reset-btn')) resetLogic(); });
      dom.resetBtn && dom.resetBtn.addEventListener('click', resetLogic);
    }
  
    // --- 초기화 ---
    function init() {
      state.masterSlides = Array.from(document.querySelectorAll('.swiper-slide'));
      state.savedCouponIds = JSON.parse(localStorage.getItem('japankuruSavedCoupons') || '[]');
      if (localStorage.getItem('japankuruTheme') === 'dark') document.body.classList.add('dark-mode');
      initSwiper();
      initMap();
      updateFilterCounts();
      bindEventListeners();
      updateView();
      // distance-badge를 card-image-wrapper로 이동(최초 1회)
      document.querySelectorAll('.coupon-card-scene').forEach(card => {
        const imgWrap = card.querySelector('.card-image-wrapper');
        const dist = card.querySelector('.distance-badge');
        if (imgWrap && dist && dist.parentNode !== imgWrap) {
          imgWrap.appendChild(dist);
        }
      });
    }

// 2, 3번을 한 번에!
function scrollToCouponList() {
  document.querySelector('.coupon-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
}
function hideSpecialSections() {
  document.querySelector('.pickup-special-section').style.display = 'none';
  document.querySelector('.themed-feature-section').style.display = 'none';
}
function showSpecialSections() {
  document.querySelector('.pickup-special-section').style.display = '';
  document.querySelector('.themed-feature-section').style.display = '';
}
function onSearchInputChange() {
  const searchTerm = dom.searchInput.value.trim();
  if (searchTerm) {
    hideSpecialSections();
    scrollToCouponList();
  } else {
    showSpecialSections();
  }
  updateView();
}
dom.searchInput.addEventListener('input', onSearchInputChange);


    init();
  });
  </script>
  
</body>
</html>
